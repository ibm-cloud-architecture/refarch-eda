<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Spring Cloud and Spring Cloud Stream quick techno overview"><meta name=author content="Jerome Boyer"><link href=https://ibm-cloud-architecture.github.com/refarch-eda/technology/spring/ rel=canonical><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.1"><title>Spring Cloud and Spring Cloud Stream - IBM Automation - Event-driven Solution - Sharing knowledge</title><link rel=stylesheet href=../../assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cbb835fc.min.css><meta name=theme-color content=#000000><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#spring-cloud class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="IBM Automation - Event-driven Solution - Sharing knowledge" class="md-header__button md-logo" aria-label="IBM Automation - Event-driven Solution - Sharing knowledge" data-md-component=logo> <img src=../../images/es-icon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> IBM Automation - Event-driven Solution - Sharing knowledge </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Spring Cloud and Spring Cloud Stream </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ibm-cloud-architecture/refarch-eda title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> ibm-cloud-architecture/refarch-eda </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="IBM Automation - Event-driven Solution - Sharing knowledge" class="md-nav__button md-logo" aria-label="IBM Automation - Event-driven Solution - Sharing knowledge" data-md-component=logo> <img src=../../images/es-icon.png alt=logo> </a> IBM Automation - Event-driven Solution - Sharing knowledge </label> <div class=md-nav__source> <a href=https://github.com/ibm-cloud-architecture/refarch-eda title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> ibm-cloud-architecture/refarch-eda </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../news/ class=md-nav__link> What's new </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Introduction <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Introduction data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Introduction </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../introduction/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../introduction/reference-architecture/ class=md-nav__link> Reference Architecture </a> </li> <li class=md-nav__item> <a href=../../introduction/usecases/ class=md-nav__link> Business Use Cases </a> </li> <li class=md-nav__item> <a href=../../introduction/target-audiences/ class=md-nav__link> Target Audiences </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Learning Journey <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Learning Journey" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Learning Journey </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../journey/101/ class=md-nav__link> Get started (101 content) </a> </li> <li class=md-nav__item> <a href=../../journey/201/ class=md-nav__link> Deeper dive (201 content) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Concepts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Concepts data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../concepts/terms-and-definitions/ class=md-nav__link> Terms & Definitions </a> </li> <li class=md-nav__item> <a href=../../concepts/integration/ class=md-nav__link> Agile Integration </a> </li> <li class=md-nav__item> <a href=../../concepts/events-versus-messages/ class=md-nav__link> Event streaming versus Queuing </a> </li> <li class=md-nav__item> <a href=../../concepts/fit-to-purpose/ class=md-nav__link> Fit for purpose </a> </li> <li class=md-nav__item> <a href=../../concepts/model/ class=md-nav__link> Devising the data models </a> </li> <li class=md-nav__item> <a href=../../concepts/flow-architectures/ class=md-nav__link> Flow Architecture </a> </li> <li class=md-nav__item> <a href=../../concepts/service-mesh/ class=md-nav__link> Service mesh </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Advantages of EDA <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Advantages of EDA" data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Advantages of EDA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advantages/microservice/ class=md-nav__link> Microservice decoupling </a> </li> <li class=md-nav__item> <a href=../../advantages/reactive/ class=md-nav__link> Reactive systems </a> </li> <li class=md-nav__item> <a href=../../advantages/resiliency/ class=md-nav__link> Resiliency </a> </li> <li class=md-nav__item> <a href=../../advantages/scalability/ class=md-nav__link> Scalability </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Patterns in EDA <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Patterns in EDA" data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Patterns in EDA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../patterns/intro/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../patterns/event-sourcing/ class=md-nav__link> Event Sourcing </a> </li> <li class=md-nav__item> <a href=../../patterns/cqrs/ class=md-nav__link> CQRS </a> </li> <li class=md-nav__item> <a href=../../patterns/saga/ class=md-nav__link> Saga </a> </li> <li class=md-nav__item> <a href=../../patterns/dlq/ class=md-nav__link> Dead Letter Queue </a> </li> <li class=md-nav__item> <a href=../../patterns/topic-replication/ class=md-nav__link> Topic Replication </a> </li> <li class=md-nav__item> <a href=../../patterns/data-pipeline/ class=md-nav__link> Data Intensive App </a> </li> <li class=md-nav__item> <a href=../../patterns/realtime-analytics/ class=md-nav__link> Near real-time analytics </a> </li> <li class=md-nav__item> <a href=../../patterns/api-mgt/ class=md-nav__link> API management </a> </li> <li class=md-nav__item> <a href=../../patterns/cep/ class=md-nav__link> Situational decision </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Methodology <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Methodology data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Methodology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../methodology/event-storming/ class=md-nav__link> Event Storming </a> </li> <li class=md-nav__item> <a href=../../methodology/domain-driven-design/ class=md-nav__link> Domain-Driven Design </a> </li> <li class=md-nav__item> <a href=../../methodology/data-intensive/ class=md-nav__link> Data Intensive App Development </a> </li> <li class=md-nav__item> <a href=../../methodology/data-lineage/ class=md-nav__link> Data lineage </a> </li> <li class=md-nav__item> <a href=../../methodology/governance/ class=md-nav__link> Governance </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9 checked> <label class=md-nav__link for=__nav_9> Technology <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Technology data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Technology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../kafka-overview/ class=md-nav__link> Kafka Overview </a> </li> <li class=md-nav__item> <a href=../event-streams/ class=md-nav__link> Event Streams </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/eda-tech-academy/demo/ class=md-nav__link> Event Streams Demo Script </a> </li> <li class=md-nav__item> <a href=../faq/ class=md-nav__link> Kafka FAQ </a> </li> <li class=md-nav__item> <a href=../mq/ class=md-nav__link> MQ in EDA context </a> </li> <li class=md-nav__item> <a href=../kafka-producers/ class=md-nav__link> Kafka Producers </a> </li> <li class=md-nav__item> <a href=../kafka-consumers/ class=md-nav__link> Kafka Consumers </a> </li> <li class=md-nav__item> <a href=../avro-schemas/ class=md-nav__link> Avro Schema </a> </li> <li class=md-nav__item> <a href=../advanced-kafka/ class=md-nav__link> Advanced Concepts </a> </li> <li class=md-nav__item> <a href=../kafka-streams/ class=md-nav__link> Kafka Streams </a> </li> <li class=md-nav__item> <a href=../kafka-connect/ class=md-nav__link> Kafka Connect </a> </li> <li class=md-nav__item> <a href=../event-streams/es-maas/security/ class=md-nav__link> Kafka security </a> </li> <li class=md-nav__item> <a href=../kafka-monitoring/ class=md-nav__link> Kafka Monitoring </a> </li> <li class=md-nav__item> <a href=../kafka-mirrormaker/ class=md-nav__link> Mirror Maker 2 </a> </li> <li class=md-nav__item> <a href=../security/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../flink/ class=md-nav__link> Apache Flink </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Spring cloud <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Spring cloud </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#spring-cloud class=md-nav__link> Spring Cloud </a> <nav class=md-nav aria-label="Spring Cloud"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#getting-started class=md-nav__link> Getting started </a> </li> <li class=md-nav__item> <a href=#spring-cloud-config class=md-nav__link> Spring Cloud config </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#spring-cloud-stream class=md-nav__link> Spring Cloud Stream </a> <nav class=md-nav aria-label="Spring Cloud Stream"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example-of-kafka-binding class=md-nav__link> Example of Kafka binding </a> </li> <li class=md-nav__item> <a href=#consuming-message class=md-nav__link> Consuming message </a> </li> <li class=md-nav__item> <a href=#kafka-spring-cloud-stream-app-basic class=md-nav__link> Kafka spring cloud stream app basic </a> </li> <li class=md-nav__item> <a href=#avro-serialization class=md-nav__link> Avro serialization </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10 type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10> Use Cases <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Use Cases" data-md-level=1> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Use Cases </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../use-cases/gitops/ class=md-nav__link> Event-driven solution GitOps </a> </li> <li class=md-nav__item> <a href=../event-streams/es-cp4i/ class=md-nav__link> Deploy Event-Streams </a> </li> <li class=md-nav__item> <a href=../../use-cases/connect-s3/ class=md-nav__link> Kafka Connect - S3 </a> </li> <li class=md-nav__item> <a href=../../use-cases/connect-cos/ class=md-nav__link> Kafka Connect - COS </a> </li> <li class=md-nav__item> <a href=../../use-cases/connect-jdbc/ class=md-nav__link> Kafka Connect - jdbc </a> </li> <li class=md-nav__item> <a href=../../use-cases/connect-mq/ class=md-nav__link> Kafka Connect - MQ </a> </li> <li class=md-nav__item> <a href=../../use-cases/connect-rabbitmq/ class=md-nav__link> Kafka Connect - Rabbitmq </a> </li> <li class=md-nav__item> <a href=../../use-cases/kafka-streams/ class=md-nav__link> Kafka Streams labs </a> </li> <li class=md-nav__item> <a href=../../use-cases/db2-debezium/ class=md-nav__link> DB2 - CDC Debezium - Outbox </a> </li> <li class=md-nav__item> <a href=../../use-cases/kafka-mm2/ class=md-nav__link> Mirror maker 2 labs </a> </li> <li class=md-nav__item> <a href=../../use-cases/schema-registry-on-cloud/ class=md-nav__link> Schema registry ES on Cloud </a> </li> <li class=md-nav__item> <a href=../../use-cases/schema-registry-on-ocp/ class=md-nav__link> Schema registry </a> </li> <li class=md-nav__item> <a href=../../use-cases/monitoring-on-cloud/ class=md-nav__link> Monitoring ES on Cloud </a> </li> <li class=md-nav__item> <a href=../../use-cases/monitoring-on-ocp/ class=md-nav__link> Monitoring ES </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11 type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11> Scenarios <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Scenarios data-md-level=1> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Scenarios </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../scenarios/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/refarch-kc/ class=md-nav__link> Reefer Shipment Solution </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/vaccine-solution-main/ class=md-nav__link> Vaccine at Scale </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/eda-rt-inventory-gitops class=md-nav__link> Near real-time Inventory </a> </li> <li class=md-nav__item> <a href=../../scenarios/saga-orchestration/ class=md-nav__link> SAGA with MQ Orchestration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../additional-reading/ class=md-nav__link> Additional reading </a> </li> <li class=md-nav__item> <a href=../../contribute/ class=md-nav__link> Contribute to this Site </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#spring-cloud class=md-nav__link> Spring Cloud </a> <nav class=md-nav aria-label="Spring Cloud"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#getting-started class=md-nav__link> Getting started </a> </li> <li class=md-nav__item> <a href=#spring-cloud-config class=md-nav__link> Spring Cloud config </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#spring-cloud-stream class=md-nav__link> Spring Cloud Stream </a> <nav class=md-nav aria-label="Spring Cloud Stream"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example-of-kafka-binding class=md-nav__link> Example of Kafka binding </a> </li> <li class=md-nav__item> <a href=#consuming-message class=md-nav__link> Consuming message </a> </li> <li class=md-nav__item> <a href=#kafka-spring-cloud-stream-app-basic class=md-nav__link> Kafka spring cloud stream app basic </a> </li> <li class=md-nav__item> <a href=#avro-serialization class=md-nav__link> Avro serialization </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ibm-cloud-architecture/refarch-eda/edit/master/docs/technology/spring/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1>Spring cloud</h1> <p><strong>Audience</strong>: Developers</p> <h2 id=spring-cloud>Spring Cloud<a class=headerlink href=#spring-cloud title="Permanent link">&para;</a></h2> <p><a href=https://spring.io/projects/spring-cloud>Spring Cloud</a> is based on Spring boot programming model but focusing on cloud native deployment and distributed computing. As other spring boot app it includes jetty or tomcat, health checks, metrics... It supports the following patterns:</p> <ul> <li>Distributed/versioned <a href=https://spring.io/projects/spring-cloud-config>configuration</a>: externalize config in distributed system with config server.</li> <li>Service registration and discovery: uses Netflix Eureka, Apache Zookeeper or Consul to keep service information. </li> <li>Routing: supports HTTP (Open Feign or Netflix Ribbon for load balancing) and messaging (RabbitMQ and Kafka)</li> <li>Service-to-service calls: Sptring Cloud Gateway and Netflix Zuul is used</li> <li>Load balancing</li> <li>Circuit Breakers: based on Netflix Hystrix: if the request fails for n time, the circuit open. </li> <li>Global locks</li> <li>Leadership election and cluster state</li> <li>Distributed messaging</li> </ul> <p>It also supports pipelines for ci/cd and contract testing for interface validation. </p> <h3 id=getting-started>Getting started<a class=headerlink href=#getting-started title="Permanent link">&para;</a></h3> <p>Use <a href=https://start.spring.io/ >start.spring.io</a> to create the application starting code using Kafka, Actuator, Cloud Stream or add the Spring Cloud BOM to your maven <code>pom.xml</code> file. See <a href=https://spring.io/projects/spring-cloud>the Adding Spring Cloud To An Existing Spring Boot Application section.</a></p> <p>As most of the microservices expose REST resource, we may need to add the starter web:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nt>&lt;dependency&gt;</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>    <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>    <span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-web<span class=nt>&lt;/artifactId&gt;</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=nt>&lt;/dependency&gt;</span>
</code></pre></div> <p>We also need to install the <a href=https://cloud.spring.io/spring-cloud-cli/ >Spring Cloud CLI</a>.</p> <p>Then add the Spring cloud starter as dependency. When using config server, we need to add the config client. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nt>&lt;dependency&gt;</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>    <span class=nt>&lt;groupId&gt;</span>org.springframework.cloud<span class=nt>&lt;/groupId&gt;</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>    <span class=nt>&lt;artifactId&gt;</span>spring-cloud-conflig-client<span class=nt>&lt;/artifactId&gt;</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=nt>&lt;/dependency&gt;</span>
</code></pre></div> <p>For centralized tracing uses, starter-sleuth, and zipkin.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nt>&lt;dependency&gt;</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>    <span class=nt>&lt;groupId&gt;</span>org.springframework.cloud<span class=nt>&lt;/groupId&gt;</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>    <span class=nt>&lt;artifactId&gt;</span>spring-cloud-starter-sleuth<span class=nt>&lt;/artifactId&gt;</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=nt>&lt;/dependency&gt;</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=nt>&lt;dependency&gt;</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>    <span class=nt>&lt;groupId&gt;</span>org.springframework.cloud<span class=nt>&lt;/groupId&gt;</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>    <span class=nt>&lt;artifactId&gt;</span>spring-cloud-starter-zipkin<span class=nt>&lt;/artifactId&gt;</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=nt>&lt;/dependency&gt;</span>
</code></pre></div> <p>For service discovery add netflix-eureka-client.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nt>&lt;dependency&gt;</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>    <span class=nt>&lt;groupId&gt;</span>org.springframework.cloud<span class=nt>&lt;/groupId&gt;</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>    <span class=nt>&lt;artifactId&gt;</span>spring-cloud-starter-eureka<span class=nt>&lt;/artifactId&gt;</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=nt>&lt;/dependency&gt;</span>
</code></pre></div> <p>Using the Spring Cloud CLI we can get the service registry, config server, central tracing started in one command:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>spring cloud eureka configserver zipkin
</code></pre></div> <h3 id=spring-cloud-config>Spring Cloud config<a class=headerlink href=#spring-cloud-config title="Permanent link">&para;</a></h3> <p>Use the concept of Config Server you have a central place to manage external properties for applications across all environments. As an application moves through the deployment pipeline from dev to test and into production you can manage the configuration between those environments and be certain that applications have everything they need to run when they migrate. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=w>  </span><span class=nd>@Value</span><span class=p>(</span><span class=s>&quot;${config.in.topic}&quot;</span><span class=p>)</span><span class=w></span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>  </span><span class=n>String</span><span class=w> </span><span class=n>topicName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;orders&quot;</span><span class=p>;</span><span class=w></span>
</code></pre></div> <p>The value of the <code>config.in.topic</code> comes from local configuration or remote config server. The config server will serve content from a git. See <a href=https://github.com/spring-cloud-samples/configserver>this sample</a> for such server.</p> <h2 id=spring-cloud-stream>Spring Cloud Stream<a class=headerlink href=#spring-cloud-stream title="Permanent link">&para;</a></h2> <p><a href=https://spring.io/projects/spring-cloud-stream>Spring Cloud Stream</a> is a framework for building highly scalable event-driven microservices connected with shared messaging systems. It unifies lots of popular messaging platforms behind one easy to use API including RabbitMQ, Apache Kafka, Amazon Kinesis, Google PubSub, Solace PubSub+, Azure Event Hubs, and Apache RocketMQ. </p> <p>Spring Cloud Stream is an abstraction that uses the following important concepts to supporet middleware encapsulation: <strong>destination binders</strong> (integration with messaging systems like Kafka or RabbitMQ), <strong>destination bindings</strong> (bridge code to external systems) and <strong>message</strong> (canonical data model to communicate between producer and consumer). </p> <p>As other Spring boot application, it uses extrernal properties to manage most of the configuration of the binders and binding.</p> <p><a href=https://spring.io/projects/spring-cloud-stream-applications>Spring Cloud Stream Applications</a> are standalone executable applications that communicate over messaging middleware such as Apache Kafka and RabbitMQ. The app is using uber-jars to get the minimal required library and code The following diagram illustrates those concepts for a Spring cloud app:</p> <p><img alt src=images/spring-stream-app.png></p> <p><strong>Attention</strong> Spring Cloud Stream is not Kafka Streams or Kafka API, it is similar but it represents another abstraction. From a Kafka developer's point of view, it does not seem relevant, as why not using Kafka API and Kafka Streams API, but this is a way to encapsulate any middleware supporting pub/sub and queueing. It may be more comparable to Microprofile reactive messaging specifications and APIs, but not compatible with it. For example binding can be compared to channel of the microprofile reactive messaging constructs.</p> <p>So the development decision will be around middleware abstraction and the way to simplify going from one middleware to another. Now with Kafka, because of its long retention time, it means we can have any type of consumers to read the messages at any time. Those consumers may use Kafka API (Python app or nodejs apps), in this case using the Kafka API within the Spring boot application is a better approach, as the way the abstraction is used may not be fully compatible to any Kafka consumer types.</p> <p>With Kafka based application the best practice is also to define the message structure, using Avro or Protbuf, and use schema registry to ensure compatibility management between applications. To support that Spring Cloud Stream support using native (to the middleware) serialization, which in the case of Kafka could be any serdes APIs or avro API. We will cover that <a href=#avro-serialization>in later section</a>.</p> <h3 id=example-of-kafka-binding>Example of Kafka binding<a class=headerlink href=#example-of-kafka-binding title="Permanent link">&para;</a></h3> <p>The <a href=https://github.com/ibm-cloud-architecture/eda-quickstarts/tree/main/spring-cloud-stream>order service spring cloud template</a> is a simple example of order service that exposes CRUD operations on the Order entity via a controller. Instead of writing to a database, this service immediately generates a message to Kafka and then the repository class consumes the message to get the data to write to the database. This is a simple way to implement 'transaction' by using the Append log of Kafka partition as a transaction log.</p> <p><img alt src=images/spring-orderms-app.png></p> <p>The way to generate code from a POST or an internal processing is to use <a href=https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/function/StreamBridge.java>StreamBridge</a>, which exposes a send function to send the record.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=w>    </span><span class=nd>@Autowired</span><span class=w></span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>StreamBridge</span><span class=w> </span><span class=n>streamBridge</span><span class=p>;</span><span class=w></span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Order</span><span class=w> </span><span class=nf>processANewOrder</span><span class=p>(</span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>        </span><span class=n>order</span><span class=p>.</span><span class=na>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>OPEN</span><span class=p>;</span><span class=w></span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=w>        </span><span class=n>order</span><span class=p>.</span><span class=na>orderID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w></span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>        </span><span class=n>order</span><span class=p>.</span><span class=na>creationDate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDate</span><span class=p>.</span><span class=na>now</span><span class=p>();</span><span class=w></span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>        </span><span class=n>streamBridge</span><span class=p>.</span><span class=na>send</span><span class=p>(</span><span class=n>BINDING_NAME</span><span class=p>,</span><span class=w> </span><span class=n>order</span><span class=p>);</span><span class=w></span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>order</span><span class=p>;</span><span class=w></span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>    </span><span class=p>}</span><span class=w></span>
</code></pre></div> <p>As a good practice is to send a Kafka Record with a Key, which is specialy needed when sending messages to a multi partition topic: The messages with the same key will always go to the same partition. If the partition key is not present, messages will be partitioned in round-robin fashion. Spring Cloud Stream is little bit confusing as it created two concepts for partitioning: the partitionKey and the message key. The partition key is the way to support the same mechanism as Kafka is doing but for other middleware. So for Kafka we do not need to use partitionKey, but then it is important to use the message key construct. As Kafka is evolving on the partition allocation, it is recommended to do not interfere with Kafka mechanims and use the following approach:</p> <ul> <li> <p>Provide the message key as a SpEL expression property for example in the header: </p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=na>spring.cloud.stream.bindings.&lt;binding-name&gt;.producer.message-key-expression</span><span class=o>:</span><span class=w> </span><span class=s>headers[&#39;messageKey&#39;]</span><span class=w></span>
</code></pre></div> </li> <li> <p>Then in your application, when publishing the message, add a header called <code>kafka_messagekey</code> with the value set from the attribute to use as key. Spring Cloud Stream will use the value for this header to assign it to the Kafka record Key:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=w> </span><span class=n>Message</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=n>toSend</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MessageBuilder</span><span class=p>.</span><span class=na>withPayload</span><span class=p>(</span><span class=n>order</span><span class=p>)</span><span class=w></span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=w>        </span><span class=p>.</span><span class=na>setHeader</span><span class=p>(</span><span class=n>KafkaHeaders</span><span class=p>.</span><span class=na>MESSAGE_KEY</span><span class=p>,</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>customerID</span><span class=p>.</span><span class=na>getBytes</span><span class=p>())</span><span class=w></span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>        </span><span class=p>.</span><span class=na>setHeader</span><span class=p>(</span><span class=n>MessageHeaders</span><span class=p>.</span><span class=na>CONTENT_TYPE</span><span class=p>,</span><span class=w> </span><span class=n>MimeTypeUtils</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>).</span><span class=na>build</span><span class=p>();</span><span class=w></span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>    </span><span class=n>streamBridge</span><span class=p>.</span><span class=na>send</span><span class=p>(</span><span class=n>BINDING_NAME</span><span class=p>,</span><span class=w> </span><span class=n>toSend</span><span class=p>);</span><span class=w></span>
</code></pre></div> </li> </ul> <p>You can also build composite key with a special java bean class for that and use instance of this class as key.</p> <div class=highlight><pre><span></span><code>```java
 CustomerCompanyKey cck = new CustomerCompanyKey(order.customerID,customer.company);
 Message&lt;Order&gt; toSend = MessageBuilder.withPayload(order)
        .setHeader(KafkaHeaders.MESSAGE_KEY, cck)
        .setHeader(MessageHeaders.CONTENT_TYPE, MimeTypeUtils.APPLICATION_JSON).build();
    streamBridge.send(BINDING_NAME, toSend);
```
</code></pre></div> <p>The following screen shot illustrates that all records with the same "customerID" are in the same partition:</p> <p><img alt src=images/orders-topic.png></p> <p>If you want to use the partition key as an alternate way to do partition allocation using Spring Cloud Stream strategy then use a partitionKey:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=na>spring.cloud.stream.bindings.&lt;binding-name&gt;.producer.partition-key-expression</span><span class=o>:</span><span class=w> </span><span class=s>headers[&#39;partitionKey&#39;]</span><span class=w></span>
</code></pre></div> <p>and then in the code:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=n>Message</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=n>toSend</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MessageBuilder</span><span class=p>.</span><span class=na>withPayload</span><span class=p>(</span><span class=n>order</span><span class=p>)</span><span class=w></span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=w>            </span><span class=p>.</span><span class=na>setHeader</span><span class=p>(</span><span class=s>&quot;partitionKey&quot;</span><span class=p>,</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>customerID</span><span class=p>.</span><span class=na>getBytes</span><span class=p>())</span><span class=w></span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=w>            </span><span class=p>.</span><span class=na>setHeader</span><span class=p>(</span><span class=n>MessageHeaders</span><span class=p>.</span><span class=na>CONTENT_TYPE</span><span class=p>,</span><span class=w> </span><span class=n>MimeTypeUtils</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>).</span><span class=na>build</span><span class=p>();</span><span class=w></span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>        </span><span class=n>streamBridge</span><span class=p>.</span><span class=na>send</span><span class=p>(</span><span class=n>BINDING_NAME</span><span class=p>,</span><span class=w> </span><span class=n>toSend</span><span class=p>);</span><span class=w></span>
</code></pre></div> <h3 id=consuming-message>Consuming message<a class=headerlink href=#consuming-message title="Permanent link">&para;</a></h3> <p>With the last release of Spring Cloud Stream, consumers are single beans of type <code>Function</code>, <code>Consumer</code> or <code>Supplier</code>. Here is an example of consumer only.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=w>    </span><span class=nd>@Bean</span><span class=w></span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Consumer</span><span class=o>&lt;</span><span class=n>Message</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=nf>consumeOrderEvent</span><span class=p>(){</span><span class=w></span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>msg</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>saveOrder</span><span class=p>(</span><span class=n>msg</span><span class=p>.</span><span class=na>getPayload</span><span class=p>());</span><span class=w></span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>    </span><span class=p>}</span><span class=w></span>
</code></pre></div> <p>For thew binding configuration the name of the method gives the name of the binding:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=nt>spring.cloud.stream</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=w>  </span><span class=nt>bindings</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=w>    </span><span class=nt>consumeOrderEvent-in-0</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>      </span><span class=nt>destination</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">orders</span><span class=w></span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=w>      </span><span class=nt>contentType</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">application/json</span><span class=w></span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>      </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">orderms-grp</span><span class=w></span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=w>      </span><span class=nt>useNativeDecoding</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=w>  </span><span class=nt>kafka</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=w>    </span><span class=nt>bindings</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=w>      </span><span class=nt>consumeOrderEvent-in-0</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=w>        </span><span class=nt>consumer</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=w>          </span><span class=nt>ackMode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MANUAL</span><span class=w></span>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=w>          </span><span class=nt>configuration</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=w>            </span><span class=nt>value.deserializer</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ibm.eda.demo.infrastructure.events.OrderDeserializer</span><span class=w></span>
</code></pre></div> <p>The deserialization is declared in a specific class:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=kn>package</span><span class=w> </span><span class=nn>ibm.eda.demo.infrastructure.events</span><span class=p>;</span><span class=w></span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.kafka.support.serializer.JsonDeserializer</span><span class=p>;</span><span class=w></span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderDeserializer</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JsonDeserializer</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=p>}</span><span class=w></span>
</code></pre></div> <p>In this example above as the goal is to save to the database, we should not auto commit the offset reading. So the following settings are needed on the consumer side:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=nt>spring.cloud.stream.kafka</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=w>    </span><span class=nt>bindings</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=w>      </span><span class=nt>consumeOrderEvent-in-0</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=w>        </span><span class=nt>consumer</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=w>          </span><span class=nt>autoCommitOffset</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w></span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=w>          </span><span class=nt>startOffset</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">latest</span><span class=w></span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=w>          </span><span class=nt>ackMode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MANUAL</span><span class=w></span>
</code></pre></div> <p>And the consumer code is now looking at the acknowledge header property if present or not and perform manual acknowledge once the save operation is successful.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=w> </span><span class=nd>@Bean</span><span class=w></span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Consumer</span><span class=o>&lt;</span><span class=n>Message</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=nf>consumeOrderEvent</span><span class=p>(){</span><span class=w></span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>msg</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=w>            </span><span class=n>Acknowledgment</span><span class=w> </span><span class=n>acknowledgment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>msg</span><span class=p>.</span><span class=na>getHeaders</span><span class=p>().</span><span class=na>get</span><span class=p>(</span><span class=n>KafkaHeaders</span><span class=p>.</span><span class=na>ACKNOWLEDGMENT</span><span class=p>,</span><span class=w> </span><span class=n>Acknowledgment</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w></span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=w>            </span><span class=n>saveOrder</span><span class=p>(</span><span class=n>msg</span><span class=p>.</span><span class=na>getPayload</span><span class=p>());</span><span class=w></span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>acknowledgment</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=w>                </span><span class=n>acknowledgment</span><span class=p>.</span><span class=na>acknowledge</span><span class=p>();</span><span class=w></span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=w>            </span><span class=p>}</span><span class=w></span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=w>        </span><span class=p>};</span><span class=w></span>
</code></pre></div> <h3 id=kafka-spring-cloud-stream-app-basic>Kafka spring cloud stream app basic<a class=headerlink href=#kafka-spring-cloud-stream-app-basic title="Permanent link">&para;</a></h3> <p>The approach to develop such application includes the following steps:</p> <ul> <li>A spring boot application, with REST spring web starter</li> <li>Define a resource and a controller for the REST API.</li> <li>Define inbound and/or outbound binding to communicate to underlying middleware</li> <li>Add method to process incoming message, taking into account the underlying middleware and serialization. For example with Kafka, most of the consumers may not auto commit the read offset but control the commit by using manual commit. </li> <li>Add logic to produce message using middleware </li> </ul> <p>To add a consumer from a Kafka topic for example, we can add a function that will process the message, and declare it as a Bean. </p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=w> </span><span class=nd>@Bean</span><span class=w></span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Consumer</span><span class=o>&lt;</span><span class=n>Message</span><span class=o>&lt;</span><span class=n>CloudEvent</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=nf>consumeCloudEventEvent</span><span class=p>(){</span><span class=w></span>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>msg</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=w>            </span><span class=n>Acknowledgment</span><span class=w> </span><span class=n>acknowledgment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>msg</span><span class=p>.</span><span class=na>getHeaders</span><span class=p>().</span><span class=na>get</span><span class=p>(</span><span class=n>KafkaHeaders</span><span class=p>.</span><span class=na>ACKNOWLEDGMENT</span><span class=p>,</span><span class=w> </span><span class=n>Acknowledgment</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w></span>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=w>            </span><span class=n>saveOrder</span><span class=p>((</span><span class=n>Order</span><span class=p>)</span><span class=n>msg</span><span class=p>.</span><span class=na>getPayload</span><span class=p>().</span><span class=na>getData</span><span class=p>());</span><span class=w></span>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>acknowledgment</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Acknowledgment provided&quot;</span><span class=p>);</span><span class=w></span>
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=w>                </span><span class=n>acknowledgment</span><span class=p>.</span><span class=na>acknowledge</span><span class=p>();</span><span class=w></span>
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=w>            </span><span class=p>}</span><span class=w></span>
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=w>        </span><span class=p>};</span><span class=w></span>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=w>    </span><span class=p>}</span><span class=w></span>
</code></pre></div> This previous code is also illustrating manual offset commit.</p> <p>Then we add configuration to link to the binders queue or topic:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=w>    </span><span class=nt>consumeOrderEvent-in-0</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=w>        </span><span class=nt>consumer</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=w>          </span><span class=nt>autoCommitOffset</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w></span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>          </span><span class=nt>startOffset</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">latest</span><span class=w></span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=w>          </span><span class=nt>ackMode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MANUAL</span><span class=w></span>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=w>          </span><span class=nt>configuration</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=w>            </span><span class=nt>value.deserializer</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ibm.eda.demo.infrastructure.events.CloudEventDeserializer</span><span class=w></span>
</code></pre></div> <h3 id=avro-serialization>Avro serialization<a class=headerlink href=#avro-serialization title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=nt>producer</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=w>        </span><span class=nt>useNativeEncoding</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
</code></pre></div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../flink/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Apache Flink" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Apache Flink </div> </div> </a> <a href=../../use-cases/gitops/ class="md-footer__link md-footer__link--next" aria-label="Next: Event-driven solution GitOps" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Event-driven solution GitOps </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright  2022 IBM </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/ibm-cloud-architecture target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/agileitarchitecture target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tabs.sticky", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.9c69f0bc.min.js></script> </body> </html>