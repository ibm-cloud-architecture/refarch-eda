<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Apache Kafka to AWS S3 object storage Source & Sink Connector usecase"><meta name=author content="Jerome Boyer"><link href=https://ibm-cloud-architecture.github.com/refarch-eda/use-cases/connect-s3/ rel=canonical><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.1"><title>Kafka Connect to S3 Source & Sink - IBM Automation - Event-driven Solution - Sharing knowledge</title><link rel=stylesheet href=../../assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cbb835fc.min.css><meta name=theme-color content=#000000><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#overview class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="IBM Automation - Event-driven Solution - Sharing knowledge" class="md-header__button md-logo" aria-label="IBM Automation - Event-driven Solution - Sharing knowledge" data-md-component=logo> <img src=../../images/es-icon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> IBM Automation - Event-driven Solution - Sharing knowledge </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Kafka Connect to S3 Source & Sink </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ibm-cloud-architecture/refarch-eda title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> ibm-cloud-architecture/refarch-eda </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="IBM Automation - Event-driven Solution - Sharing knowledge" class="md-nav__button md-logo" aria-label="IBM Automation - Event-driven Solution - Sharing knowledge" data-md-component=logo> <img src=../../images/es-icon.png alt=logo> </a> IBM Automation - Event-driven Solution - Sharing knowledge </label> <div class=md-nav__source> <a href=https://github.com/ibm-cloud-architecture/refarch-eda title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> ibm-cloud-architecture/refarch-eda </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../news/ class=md-nav__link> What's new </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Introduction <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Introduction data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Introduction </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../introduction/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../introduction/reference-architecture/ class=md-nav__link> Reference Architecture </a> </li> <li class=md-nav__item> <a href=../../introduction/usecases/ class=md-nav__link> Business Use Cases </a> </li> <li class=md-nav__item> <a href=../../introduction/target-audiences/ class=md-nav__link> Target Audiences </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Learning Journey <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Learning Journey" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Learning Journey </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../journey/101/ class=md-nav__link> Get started (101 content) </a> </li> <li class=md-nav__item> <a href=../../journey/201/ class=md-nav__link> Deeper dive (201 content) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Concepts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Concepts data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../concepts/terms-and-definitions/ class=md-nav__link> Terms & Definitions </a> </li> <li class=md-nav__item> <a href=../../concepts/integration/ class=md-nav__link> Agile Integration </a> </li> <li class=md-nav__item> <a href=../../concepts/events-versus-messages/ class=md-nav__link> Event streaming versus Queuing </a> </li> <li class=md-nav__item> <a href=../../concepts/fit-to-purpose/ class=md-nav__link> Fit for purpose </a> </li> <li class=md-nav__item> <a href=../../concepts/model/ class=md-nav__link> Devising the data models </a> </li> <li class=md-nav__item> <a href=../../concepts/flow-architectures/ class=md-nav__link> Flow Architecture </a> </li> <li class=md-nav__item> <a href=../../concepts/service-mesh/ class=md-nav__link> Service mesh </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Advantages of EDA <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Advantages of EDA" data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Advantages of EDA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advantages/microservice/ class=md-nav__link> Microservice decoupling </a> </li> <li class=md-nav__item> <a href=../../advantages/reactive/ class=md-nav__link> Reactive systems </a> </li> <li class=md-nav__item> <a href=../../advantages/resiliency/ class=md-nav__link> Resiliency </a> </li> <li class=md-nav__item> <a href=../../advantages/scalability/ class=md-nav__link> Scalability </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Patterns in EDA <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Patterns in EDA" data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Patterns in EDA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../patterns/intro/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../patterns/event-sourcing/ class=md-nav__link> Event Sourcing </a> </li> <li class=md-nav__item> <a href=../../patterns/cqrs/ class=md-nav__link> CQRS </a> </li> <li class=md-nav__item> <a href=../../patterns/saga/ class=md-nav__link> Saga </a> </li> <li class=md-nav__item> <a href=../../patterns/dlq/ class=md-nav__link> Dead Letter Queue </a> </li> <li class=md-nav__item> <a href=../../patterns/topic-replication/ class=md-nav__link> Topic Replication </a> </li> <li class=md-nav__item> <a href=../../patterns/data-pipeline/ class=md-nav__link> Data Intensive App </a> </li> <li class=md-nav__item> <a href=../../patterns/realtime-analytics/ class=md-nav__link> Near real-time analytics </a> </li> <li class=md-nav__item> <a href=../../patterns/api-mgt/ class=md-nav__link> API management </a> </li> <li class=md-nav__item> <a href=../../patterns/cep/ class=md-nav__link> Situational decision </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Methodology <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Methodology data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Methodology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../methodology/event-storming/ class=md-nav__link> Event Storming </a> </li> <li class=md-nav__item> <a href=../../methodology/domain-driven-design/ class=md-nav__link> Domain-Driven Design </a> </li> <li class=md-nav__item> <a href=../../methodology/data-intensive/ class=md-nav__link> Data Intensive App Development </a> </li> <li class=md-nav__item> <a href=../../methodology/data-lineage/ class=md-nav__link> Data lineage </a> </li> <li class=md-nav__item> <a href=../../methodology/governance/ class=md-nav__link> Governance </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> Technology <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Technology data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Technology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../technology/kafka-overview/ class=md-nav__link> Kafka Overview </a> </li> <li class=md-nav__item> <a href=../../technology/event-streams/ class=md-nav__link> Event Streams </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/eda-tech-academy/demo/ class=md-nav__link> Event Streams Demo Script </a> </li> <li class=md-nav__item> <a href=../../technology/faq/ class=md-nav__link> Kafka FAQ </a> </li> <li class=md-nav__item> <a href=../../technology/mq/ class=md-nav__link> MQ in EDA context </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-producers/ class=md-nav__link> Kafka Producers </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-consumers/ class=md-nav__link> Kafka Consumers </a> </li> <li class=md-nav__item> <a href=../../technology/avro-schemas/ class=md-nav__link> Avro Schema </a> </li> <li class=md-nav__item> <a href=../../technology/advanced-kafka/ class=md-nav__link> Advanced Concepts </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-streams/ class=md-nav__link> Kafka Streams </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-connect/ class=md-nav__link> Kafka Connect </a> </li> <li class=md-nav__item> <a href=../../technology/event-streams/es-maas/security/ class=md-nav__link> Kafka security </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-monitoring/ class=md-nav__link> Kafka Monitoring </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-mirrormaker/ class=md-nav__link> Mirror Maker 2 </a> </li> <li class=md-nav__item> <a href=../../technology/security/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../../technology/flink/ class=md-nav__link> Apache Flink </a> </li> <li class=md-nav__item> <a href=../../technology/spring/ class=md-nav__link> Spring cloud </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10 type=checkbox id=__nav_10 checked> <label class=md-nav__link for=__nav_10> Use Cases <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Use Cases" data-md-level=1> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Use Cases </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../gitops/ class=md-nav__link> Event-driven solution GitOps </a> </li> <li class=md-nav__item> <a href=../../technology/event-streams/es-cp4i/ class=md-nav__link> Deploy Event-Streams </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Kafka Connect - S3 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Kafka Connect - S3 </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#scenario-prereqs class=md-nav__link> Scenario prereqs </a> </li> <li class=md-nav__item> <a href=#kafka-connect-cluster class=md-nav__link> Kafka Connect Cluster </a> <nav class=md-nav aria-label="Kafka Connect Cluster"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#optional-create-configmap-for-log4j-configuration class=md-nav__link> (Optional) Create ConfigMap for log4j configuration </a> </li> <li class=md-nav__item> <a href=#deploy-the-baseline-kafka-connect-cluster class=md-nav__link> Deploy the baseline Kafka Connect Cluster </a> </li> <li class=md-nav__item> <a href=#build-the-camel-kafka-connector class=md-nav__link> Build the Camel Kafka Connector </a> </li> <li class=md-nav__item> <a href=#deploy-the-camel-kafka-connector-binaries class=md-nav__link> Deploy the Camel Kafka Connector binaries </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#kafka-to-s3-sink-connector class=md-nav__link> Kafka to S3 Sink Connector </a> </li> <li class=md-nav__item> <a href=#s3-to-kafka-source-connector class=md-nav__link> S3 to Kafka Source Connector </a> </li> <li class=md-nav__item> <a href=#event-streams-v10-addendum class=md-nav__link> Event Streams v10 Addendum </a> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=#next-steps class=md-nav__link> Next steps </a> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../connect-cos/ class=md-nav__link> Kafka Connect - COS </a> </li> <li class=md-nav__item> <a href=../connect-jdbc/ class=md-nav__link> Kafka Connect - jdbc </a> </li> <li class=md-nav__item> <a href=../connect-mq/ class=md-nav__link> Kafka Connect - MQ </a> </li> <li class=md-nav__item> <a href=../connect-rabbitmq/ class=md-nav__link> Kafka Connect - Rabbitmq </a> </li> <li class=md-nav__item> <a href=../kafka-streams/ class=md-nav__link> Kafka Streams labs </a> </li> <li class=md-nav__item> <a href=../db2-debezium/ class=md-nav__link> DB2 - CDC Debezium - Outbox </a> </li> <li class=md-nav__item> <a href=../kafka-mm2/ class=md-nav__link> Mirror maker 2 labs </a> </li> <li class=md-nav__item> <a href=../schema-registry-on-cloud/ class=md-nav__link> Schema registry ES on Cloud </a> </li> <li class=md-nav__item> <a href=../schema-registry-on-ocp/ class=md-nav__link> Schema registry </a> </li> <li class=md-nav__item> <a href=../monitoring-on-cloud/ class=md-nav__link> Monitoring ES on Cloud </a> </li> <li class=md-nav__item> <a href=../monitoring-on-ocp/ class=md-nav__link> Monitoring ES </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11 type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11> Scenarios <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Scenarios data-md-level=1> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Scenarios </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../scenarios/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/refarch-kc/ class=md-nav__link> Reefer Shipment Solution </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/vaccine-solution-main/ class=md-nav__link> Vaccine at Scale </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/eda-rt-inventory-gitops class=md-nav__link> Near real-time Inventory </a> </li> <li class=md-nav__item> <a href=../../scenarios/saga-orchestration/ class=md-nav__link> SAGA with MQ Orchestration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../additional-reading/ class=md-nav__link> Additional reading </a> </li> <li class=md-nav__item> <a href=../../contribute/ class=md-nav__link> Contribute to this Site </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#scenario-prereqs class=md-nav__link> Scenario prereqs </a> </li> <li class=md-nav__item> <a href=#kafka-connect-cluster class=md-nav__link> Kafka Connect Cluster </a> <nav class=md-nav aria-label="Kafka Connect Cluster"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#optional-create-configmap-for-log4j-configuration class=md-nav__link> (Optional) Create ConfigMap for log4j configuration </a> </li> <li class=md-nav__item> <a href=#deploy-the-baseline-kafka-connect-cluster class=md-nav__link> Deploy the baseline Kafka Connect Cluster </a> </li> <li class=md-nav__item> <a href=#build-the-camel-kafka-connector class=md-nav__link> Build the Camel Kafka Connector </a> </li> <li class=md-nav__item> <a href=#deploy-the-camel-kafka-connector-binaries class=md-nav__link> Deploy the Camel Kafka Connector binaries </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#kafka-to-s3-sink-connector class=md-nav__link> Kafka to S3 Sink Connector </a> </li> <li class=md-nav__item> <a href=#s3-to-kafka-source-connector class=md-nav__link> S3 to Kafka Source Connector </a> </li> <li class=md-nav__item> <a href=#event-streams-v10-addendum class=md-nav__link> Event Streams v10 Addendum </a> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=#next-steps class=md-nav__link> Next steps </a> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ibm-cloud-architecture/refarch-eda/edit/master/docs/use-cases/connect-s3/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1>Kafka Connect - S3</h1> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>This scenario walkthrough will cover the usage of <a href=https://ibm.github.io/event-streams/about/overview/ >IBM Event Streams</a> as a Kafka provider and <a href=https://aws.amazon.com/s3/ >Amazon S3</a> as an object storage service as systems to integrate with the <a href=https://ibm-cloud-architecture.github.io/refarch-eda/kafka/connect/ >Kafka Connect framework</a>. Through the use of the <a href=https://camel.apache.org/ >Apache Camel opensource project</a>, we are able to use the <a href=https://camel.apache.org/camel-kafka-connector/latest/index.html>Apache Camel Kafka Connector</a> in both a source and a sink capacity to provide bidirectional communication between <a href=https://ibm.github.io/event-streams/about/overview/ >IBM Event Streams</a> and <a href=https://aws.amazon.com/s3/ >AWS S3</a>.</p> <p>As different use cases will require different configuration details to accommodate different situational requirements, the Kafka to S3 Source and Sink capabilities described here can be used to move data between S3 buckets with a Kafka topic being the middle-man or move data between Kafka topics with an S3 Bucket being the middle-man. However, take care to ensure that you do not create an infinite processing loop by writing to the same Kafka topics and the same S3 buckets with both a Source and Sink connector deployed at the same time.</p> <h2 id=scenario-prereqs>Scenario prereqs<a class=headerlink href=#scenario-prereqs title="Permanent link">&para;</a></h2> <p><strong>OpenShift Container Platform</strong></p> <ul> <li>This deployment scenario was developed for use on the OpenShift Container Platform, with a minimum version of <code>4.2</code>.</li> </ul> <p><strong>Strimzi</strong> - This deployment scenario will make use of the <a href=https://strimzi.io/docs/operators/latest/deploying.html>Strimzi Operator</a> for Kafka deployments and the custom resources it manages. - A minimum version of <code>0.17.0</code> is required for this scenario. This scenario has been explicitly validated with version <code>0.17.0</code>. - The simplest scenario is to deploy the Strimzi Operator to watch all namespaces for relevant custom resource creation and management. - This can be done in the OpenShift console via the <strong>Operators &gt; Operator Hub</strong> page.</p> <p><strong>Amazon Web Services account</strong> - As this scenario will make use of <a href=https://aws.amazon.com/s3/ >AWS S3</a>, an active Amazon Web Services account is required. - Using the configuration described in this walkthrough, an additional IAM user can be created for further separation of permission, roles, and responsibilities. - This new IAM user should contain: - The <a href="https://console.aws.amazon.com/iam/home?region=us-east-1#/policies/arn:aws:iam::aws:policy/AmazonS3FullAccess$serviceLevelSummary"><code>AmazonS3FullAccess</code> policy</a> attached to it <em>(as it will need both read and write access to S3)</em>, - An <a href=https://docs.aws.amazon.com/AmazonS3/latest/dev/walkthrough1.html>S3 Bucket Policy</a> set on the Bucket to allow the IAM user to perform CRUD actions on the bucket and its objects. - Create a file named <code>aws-credentials.properties</code> with the following format:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>aws_access_key_id=AKIA123456EXAMPLE
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>aws_secret_access_key=strWrz/bb8%c3po/r2d2EXAMPLEKEY
</code></pre></div> <ul> <li>Create a Kubernetes Secret from this file to inject into the Kafka Connect cluster at runtime:</li> </ul> <p><div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>kubectl create secret generic aws-credentials --from-file<span class=o>=</span>aws-credentials.properties
</code></pre></div> - <em>Additional work is underway to enable configuration of the components to make use of IAM Roles instead.</em></p> <p><strong>IBM Event Streams API Key</strong> - This scenario is written with <a href=https://ibm.github.io/event-streams/about/overview/ >IBM Event Streams</a> as the provider of the Kafka endpoints. - API Keys are required for connectivity to the Kafka brokers and interaction with Kafka topics. - An API key should be created with (at minimum) read and write access to the source and target Kafka topics the connectors will interact with. - A Kubernetes Secret must be created with the Event Streams API to inject into the Kafka Connect cluster at runtime:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>kubectl create secret generic eventstreams-apikey --from-literal<span class=o>=</span><span class=nv>password</span><span class=o>=</span>&lt;eventstreams_api_key&gt;
</code></pre></div> <p><strong>IBM Event Streams Certificates on IBM Cloud Pak for Integration</strong> - If you are using an IBM Event Streams instance deployed via the IBM Cloud Pak for Integration, you must also download the generated truststore file to provide TLS communication between the connectors and the Kafka brokers. - This file, along with its password, can be found on the <strong>Connect to this cluster</strong> dialog in the Event Streams UI. - Once downloaded, it must be configured to work with the Kafka Connect certificate deployment pattern:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>keytool -importkeystore -srckeystore es-cert.jks -destkeystore es-cert.p12 -deststoretype PKCS12
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>openssl pkcs12 -in es-cert.p12 -nokeys -out es-cert.crt
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>kubectl create secret generic eventstreams-truststore-cert --from-file<span class=o>=</span>es-cert.crt
</code></pre></div> <p><strong>IBM Event Streams Certificates on IBM Cloud</strong> - If you are using an IBM Event Streams instance deployed on IBM Cloud, you need to provide the root CA certificate to connect correctly from the Kafka Connect instance. - This file can be downloaded as <code>eventstreams.cloud.ibm.com.cer</code> from the endpoint defined in your service credentials via the <code>kafka_http_url</code> property. - Once downloaded, it must be configured to work with the Kafka Connect certificate deployment pattern:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>openssl x509 -inform DER -in eventstreams.cloud.ibm.com.cer -out es-cert.crt
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>kubectl create secret generic eventstreams-truststore-cert --from-file<span class=o>=</span>es-cert.crt
</code></pre></div> <h2 id=kafka-connect-cluster>Kafka Connect Cluster<a class=headerlink href=#kafka-connect-cluster title="Permanent link">&para;</a></h2> <p>We will take advantage of some of the developer experience improvements that OpenShift and the Strimi Operator brings to the Kafka Connect framework. The Strimzi Operator provides a <code>KafkaConnect</code> custom resource which will manage a Kafka Connect cluster for us with minimal system interaction. The only work we need to do is to update the container image that the Kafka Connect deployment will use with the necessary Camel Kafka Connector binaries, which OpenShift can help us with through the use of its Build capabilities.</p> <h4 id=optional-create-configmap-for-log4j-configuration>(Optional) Create ConfigMap for log4j configuration<a class=headerlink href=#optional-create-configmap-for-log4j-configuration title="Permanent link">&para;</a></h4> <p>Due to the robust nature of Apache Camel, the default logging settings for the Apache Kafka Connect classes will send potentially sensitive information to the logs during Apache Camel context configuration. To avoid this, we can provide an updated logging configuration to the <code>log4j</code> configuration that is used by our deployments.</p> <p>Save the properties file below and name it <code>log4j.properties</code>. Then create a ConfigMap via <code>kubectl create configmap custom-connect-log4j --from-file=log4j.properties</code>. This ConfigMap will then be used in our KafkaConnect cluster creation to filter out any logging output containing <code>accesskey</code> or <code>secretkey</code> permutations.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c># Do not change this generated file. Logging can be configured in the corresponding kubernetes/openshift resource.</span><span class=w></span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=na>log4j.appender.CONSOLE</span><span class=o>=</span><span class=s>org.apache.log4j.ConsoleAppender</span><span class=w></span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=na>log4j.appender.CONSOLE.layout</span><span class=o>=</span><span class=s>org.apache.log4j.PatternLayout</span><span class=w></span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=na>log4j.appender.CONSOLE.layout.ConversionPattern</span><span class=o>=</span><span class=s>%d{ISO8601} %p %m (%c) [%t]%n</span><span class=w></span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=na>connect.root.logger.level</span><span class=o>=</span><span class=s>INFO</span><span class=w></span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=na>log4j.rootLogger</span><span class=o>=</span><span class=s>${connect.root.logger.level}, CONSOLE</span><span class=w></span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=na>log4j.logger.org.apache.zookeeper</span><span class=o>=</span><span class=s>ERROR</span><span class=w></span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=na>log4j.logger.org.I0Itec.zkclient</span><span class=o>=</span><span class=s>ERROR</span><span class=w></span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=na>log4j.logger.org.reflections</span><span class=o>=</span><span class=s>ERROR</span><span class=w></span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=c># Due to back-leveled version of log4j that is included in Kafka Connect,</span><span class=w></span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=c># we can use multiple StringMatchFilters to remove all the permutations</span><span class=w></span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=c># of the AWS accessKey and secretKey values that may get dumped to stdout</span><span class=w></span>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=c># and thus into any connected logging system.</span><span class=w></span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=na>log4j.appender.CONSOLE.filter.a</span><span class=o>=</span><span class=s>org.apache.log4j.varia.StringMatchFilter</span><span class=w></span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=na>log4j.appender.CONSOLE.filter.a.StringToMatch</span><span class=o>=</span><span class=s>accesskey</span><span class=w></span>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=na>log4j.appender.CONSOLE.filter.a.AcceptOnMatch</span><span class=o>=</span><span class=s>false</span><span class=w></span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=na>log4j.appender.CONSOLE.filter.b</span><span class=o>=</span><span class=s>org.apache.log4j.varia.StringMatchFilter</span><span class=w></span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=na>log4j.appender.CONSOLE.filter.b.StringToMatch</span><span class=o>=</span><span class=s>accessKey</span><span class=w></span>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=na>log4j.appender.CONSOLE.filter.b.AcceptOnMatch</span><span class=o>=</span><span class=s>false</span><span class=w></span>
<a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=na>log4j.appender.CONSOLE.filter.c</span><span class=o>=</span><span class=s>org.apache.log4j.varia.StringMatchFilter</span><span class=w></span>
<a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=na>log4j.appender.CONSOLE.filter.c.StringToMatch</span><span class=o>=</span><span class=s>AccessKey</span><span class=w></span>
<a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=na>log4j.appender.CONSOLE.filter.c.AcceptOnMatch</span><span class=o>=</span><span class=s>false</span><span class=w></span>
<a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=na>log4j.appender.CONSOLE.filter.d</span><span class=o>=</span><span class=s>org.apache.log4j.varia.StringMatchFilter</span><span class=w></span>
<a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=na>log4j.appender.CONSOLE.filter.d.StringToMatch</span><span class=o>=</span><span class=s>ACCESSKEY</span><span class=w></span>
<a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=na>log4j.appender.CONSOLE.filter.d.AcceptOnMatch</span><span class=o>=</span><span class=s>false</span><span class=w></span>
<a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a>
<a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=na>log4j.appender.CONSOLE.filter.e</span><span class=o>=</span><span class=s>org.apache.log4j.varia.StringMatchFilter</span><span class=w></span>
<a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a><span class=na>log4j.appender.CONSOLE.filter.e.StringToMatch</span><span class=o>=</span><span class=s>secretkey</span><span class=w></span>
<a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a><span class=na>log4j.appender.CONSOLE.filter.e.AcceptOnMatch</span><span class=o>=</span><span class=s>false</span><span class=w></span>
<a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a><span class=na>log4j.appender.CONSOLE.filter.f</span><span class=o>=</span><span class=s>org.apache.log4j.varia.StringMatchFilter</span><span class=w></span>
<a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a><span class=na>log4j.appender.CONSOLE.filter.f.StringToMatch</span><span class=o>=</span><span class=s>secretKey</span><span class=w></span>
<a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a><span class=na>log4j.appender.CONSOLE.filter.f.AcceptOnMatch</span><span class=o>=</span><span class=s>false</span><span class=w></span>
<a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a><span class=na>log4j.appender.CONSOLE.filter.g</span><span class=o>=</span><span class=s>org.apache.log4j.varia.StringMatchFilter</span><span class=w></span>
<a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a><span class=na>log4j.appender.CONSOLE.filter.g.StringToMatch</span><span class=o>=</span><span class=s>SecretKey</span><span class=w></span>
<a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a><span class=na>log4j.appender.CONSOLE.filter.g.AcceptOnMatch</span><span class=o>=</span><span class=s>false</span><span class=w></span>
<a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a><span class=na>log4j.appender.CONSOLE.filter.h</span><span class=o>=</span><span class=s>org.apache.log4j.varia.StringMatchFilter</span><span class=w></span>
<a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a><span class=na>log4j.appender.CONSOLE.filter.h.StringToMatch</span><span class=o>=</span><span class=s>SECRETKEY</span><span class=w></span>
<a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a><span class=na>log4j.appender.CONSOLE.filter.h.AcceptOnMatch</span><span class=o>=</span><span class=s>false</span><span class=w></span>
</code></pre></div> <h4 id=deploy-the-baseline-kafka-connect-cluster>Deploy the baseline Kafka Connect Cluster<a class=headerlink href=#deploy-the-baseline-kafka-connect-cluster title="Permanent link">&para;</a></h4> <p>Review the YAML description for our <code>KafkaConnectS2I</code> custom resource below, named <code>connect-cluster-101</code>. Pay close attention to <em>(using YAML notation)</em>: - <code>spec.logging.name</code> should point to the name of the ConfigMap created in the previous step to configure custom <code>log4j</code> logging filters <em>(optional)</em> - <code>spec.bootstrapServers</code> should be updated with your local Event Streams endpoints - <code>spec.tls.trustedCertificates[0].secretName</code> should match the Kubernetes Secret containing the IBM Event Streams certificate - <code>spec.authentication.passwordSecret.secretName</code> should match the Kubernetes Secret containing the IBM Event Streams API key - <code>spec.externalConfiguration.volumes[0].secret.secretName</code> should match the Kubernetes Secret containing your AWS credentials - <code>spec.config['group.id']</code> should be a unique name for this Kafka Connect cluster across all Kafka Connect instances that will be communicating with the same set of Kafka brokers. - <code>spec.config['*.storage.topic']</code> should be updated to provide unique topics for this Kafka Connect cluster inside your Kafka deployment. Distinct Kafka Connect clusters should not share metadata topics.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kafka.strimzi.io/v1alpha1</span><span class=w></span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">KafkaConnectS2I</span><span class=w></span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connect-cluster-101</span><span class=w></span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=w>    </span><span class=nt>strimzi.io/use-connector-resources</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span><span class=w></span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>  </span><span class=c1>#logging:</span><span class=w></span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>  </span><span class=c1>#  type: external</span><span class=w></span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>  </span><span class=c1>#  name: custom-connect-log4j</span><span class=w></span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w></span>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=w>  </span><span class=nt>bootstrapServers</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">es-1-ibm-es-proxy-route-bootstrap-eventstreams.apps.cluster.local:443</span><span class=w></span>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=w>  </span><span class=nt>tls</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=w>    </span><span class=nt>trustedCertificates</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>certificate</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">es-cert.crt</span><span class=w></span>
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=w>        </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">eventstreams-truststore-cert</span><span class=w></span>
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=w>  </span><span class=nt>authentication</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a><span class=w>    </span><span class=nt>passwordSecret</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">eventstreams-apikey</span><span class=w></span>
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class=w>      </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span><span class=w></span>
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a><span class=w>    </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">token</span><span class=w></span>
<a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">plain</span><span class=w></span>
<a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a><span class=w>  </span><span class=nt>externalConfiguration</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aws-credentials</span><span class=w></span>
<a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a><span class=w>        </span><span class=nt>secret</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a><span class=w>          </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aws-credentials</span><span class=w></span>
<a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a><span class=w>    </span><span class=nt>group.id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connect-cluster-101</span><span class=w></span>
<a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a><span class=w>    </span><span class=nt>config.providers</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">file</span><span class=w></span>
<a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a><span class=w>    </span><span class=nt>config.providers.file.class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.kafka.common.config.provider.FileConfigProvider</span><span class=w></span>
<a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a><span class=w>    </span><span class=nt>key.converter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.kafka.connect.json.JsonConverter</span><span class=w></span>
<a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a><span class=w>    </span><span class=nt>value.converter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.kafka.connect.json.JsonConverter</span><span class=w></span>
<a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a><span class=w>    </span><span class=nt>key.converter.schemas.enable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w></span>
<a id=__codelineno-6-35 name=__codelineno-6-35 href=#__codelineno-6-35></a><span class=w>    </span><span class=nt>value.converter.schemas.enable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w></span>
<a id=__codelineno-6-36 name=__codelineno-6-36 href=#__codelineno-6-36></a><span class=w>    </span><span class=nt>offset.storage.topic</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connect-cluster-101-offsets</span><span class=w></span>
<a id=__codelineno-6-37 name=__codelineno-6-37 href=#__codelineno-6-37></a><span class=w>    </span><span class=nt>config.storage.topic</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connect-cluster-101-configs</span><span class=w></span>
<a id=__codelineno-6-38 name=__codelineno-6-38 href=#__codelineno-6-38></a><span class=w>    </span><span class=nt>status.storage.topic</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connect-cluster-101-status</span><span class=w></span>
</code></pre></div> <p>Save the YAML above into a file named <code>kafka-connect.yaml</code>. If you created the ConfigMap in the previous step to filter out <code>accesskey</code> and <code>secretkey</code> values from the logs, uncomment the <code>spec.logging</code> lines to allow for the custom logging filters to be enabled during Kafka Connect cluster creation. Then this resource can be created via <code>kubectl apply -f kafka-connect.yaml</code>. You can then tail the output of the <code>connect-cluster-101</code> pods for updates on the connector status.</p> <h4 id=build-the-camel-kafka-connector>Build the Camel Kafka Connector<a class=headerlink href=#build-the-camel-kafka-connector title="Permanent link">&para;</a></h4> <p>The next step is to build the Camel Kafka Connector binaries so that they can be loaded into the just-deployed Kafka Connect cluster's container images.</p> <ol> <li> <p>Clone the repository https://github.com/osowski/camel-kafka-connector to your local machine:</p> <ul> <li><code>git clone https://github.com/osowski/camel-kafka-connector.git</code></li> </ul> </li> <li> <p>Check out the <code>camel-kafka-connector-0.1.0-branch</code>:</p> </li> <li> <p><code>git checkout camel-kafka-connector-0.1.0-branch</code></p> </li> <li> <p>From the root directory of the repository, build the project components:</p> <ul> <li><code>mvn clean package</code></li> <li> <p>Go get a coffee and take a walk... as this build will take around 30 minutes on a normal developer workstation.</p> </li> <li> <p>To reduce the overall build scope of the project, you can comment out the undesired modules from the <code>&lt;modules&gt;</code> element of the <code>connectors/pom.xml</code> using <code>&lt;!-- --&gt;</code> notation.</p> </li> </ul> </li> <li> <p>Copy the generated S3 artifacts to the core package build artifacts:</p> <ul> <li><code>cp connectors/camel-aws-s3-kafka-connector/target/camel-aws-s3-kafka-connector-0.1.0.jar core/target/camel-kafka-connector-0.1.0-package/share/java/camel-kafka-connector/</code></li> </ul> </li> </ol> <p>Some items to note:</p> <ul> <li>The repository used here (https://github.com/osowski/camel-kafka-connector) is a fork of the official repository (https://github.com/apache/camel-kafka-connector) with a minor update applied to allow for dynamic endpoints to be specified via configuration, which is critical for our <a href=#kafka-to-s3-sink-connector>Kafka to S3 Sink Connector</a> scenario.</li> <li>This step (and the next step) will eventually be eliminated by providing an existing container image with the necessary Camel Kafka Connector binaries as part of a build system.</li> </ul> <h4 id=deploy-the-camel-kafka-connector-binaries>Deploy the Camel Kafka Connector binaries<a class=headerlink href=#deploy-the-camel-kafka-connector-binaries title="Permanent link">&para;</a></h4> <p>Now that the Camel Kafka Connector binaries have been built, we need to include them on the classpath inside of the container image which our Kafka Connect clusters are using.</p> <ol> <li> <p>From the root directory of the repository, start a new OpenShift Build, using the generated build artifacts:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>oc start-build connect-cluster-101-connect --from-dir<span class=o>=</span>./core/target/camel-kafka-connector-0.1.0-package/share/java --follow
</code></pre></div> </li> <li> <p>Watch the Kubernetes pods as they are updated with the new build and rollout of the Kafka Connect Cluster using the updated container image <em>(which now includes the Camel Kafka Connector binaries)</em>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>kubectl get pods -w
</code></pre></div> </li> <li> <p>Once the <code>connect-cluster-101-connect-2-[random-suffix]</code> pod is in a <code>Running</code> state, you can proceed.</p> </li> </ol> <h2 id=kafka-to-s3-sink-connector>Kafka to S3 Sink Connector<a class=headerlink href=#kafka-to-s3-sink-connector title="Permanent link">&para;</a></h2> <p>Now that you have a Kafka Connect cluster up and running, you will need to configure a connector to actually begin the transmission of data from one system to the other. This will be done by taking advantage of Strimzi and using the <a href=https://strimzi.io/docs/0.17.0/#kafkaconnector_resources><code>KafkaConnector</code> custom resource</a> the Strimzi Operator manages for us.</p> <p>Review the YAML description for our <code>KafkaConnector</code> custom resource below, named <code>s3-sink-connector</code>. Pay close attention to: - The <code>strimzi.io/cluster</code> label must match the deployed Kafka Connect cluster you previously deployed <em>(or else Strimzi will not connect the <code>KafkaConnector</code> to your <code>KafkaConnect</code> cluster)</em> - The <code>topics</code> parameter <em>(named <code>my-source-topic</code> here)</em> - The S3 Bucket parameter of the <code>camel.sink.url</code> configuration option <em>(named <code>my-s3-bucket</code> here)</em></p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kafka.strimzi.io/v1alpha1</span><span class=w></span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">KafkaConnector</span><span class=w></span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">s3-sink-connector</span><span class=w></span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>    </span><span class=nt>strimzi.io/cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connect-cluster-101</span><span class=w></span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>  </span><span class=nt>class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.camel.kafkaconnector.CamelSinkConnector</span><span class=w></span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>  </span><span class=nt>tasksMax</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w></span>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=w>    </span><span class=nt>key.converter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.kafka.connect.storage.StringConverter</span><span class=w></span>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>    </span><span class=nt>value.converter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.kafka.connect.storage.StringConverter</span><span class=w></span>
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=w>    </span><span class=nt>topics</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-source-topic</span><span class=w></span>
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=w>    </span><span class=nt>camel.sink.url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aws-s3://my-s3-bucket?keyName=${date:now:yyyyMMdd-HHmmssSSS}-${exchangeId}</span><span class=w></span>
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=w>    </span><span class=nt>camel.sink.maxPollDuration</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10000</span><span class=w></span>
<a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=w>    </span><span class=nt>camel.component.aws-s3.configuration.autocloseBody</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w></span>
<a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=w>    </span><span class=nt>camel.component.aws-s3.accessKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${file:/opt/kafka/external-configuration/aws-credentials/aws-credentials.properties:aws_access_key_id}</span><span class=w></span>
<a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=w>    </span><span class=nt>camel.component.aws-s3.secretKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${file:/opt/kafka/external-configuration/aws-credentials/aws-credentials.properties:aws_secret_access_key}</span><span class=w></span>
<a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=w>    </span><span class=nt>camel.component.aws-s3.region</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">US_EAST_1</span><span class=w></span>
</code></pre></div> <p>Once you have updated the YAML and saved it in a file named <code>kafka-sink-connector.yaml</code>, this resource can be created via <code>kubectl apply -f kafka-sink-connector.yaml</code>. You can then tail the output of the <code>connect-cluster-101</code> pods for updates on the connector status.</p> <p><strong>NOTE:</strong> If you require objects in S3 to reside in a sub-folder of the bucket root, you can place a folder name prefix in the <code>keyName</code> query parameter of the <code>camel.sink.url</code> configuration option above. For example, <code>camel.sink.url: aws-s3://my-s3-bucket?keyName=myfoldername/${date:now:yyyyMMdd-HHmmssSSS}-${exchangeId}</code>.</p> <h2 id=s3-to-kafka-source-connector>S3 to Kafka Source Connector<a class=headerlink href=#s3-to-kafka-source-connector title="Permanent link">&para;</a></h2> <p>Similar to the <a href=#kafka-to-s3-sink-connector>Kafka to S3 Sink Connector</a> scenario, this scenario will make use of the Strimzi <a href=https://strimzi.io/docs/0.17.0/#kafkaconnector_resources><code>KafkaConnector</code> custom resource</a> to configure the specific connector instance.</p> <p>Review the YAML description for our <code>KafkaConnector</code> custom resource below, named <code>s3-source-connector</code>. Pay close attention to: - The <code>strimzi.io/cluster</code> label must match the deployed Kafka Connect cluster you previously deployed <em>(or else Strimzi will not connect the <code>KafkaConnector</code> to your <code>KafkaConnect</code> cluster)</em> - The <code>topics</code> and <code>camel.source.kafka.topic</code> parameters <em>(named <code>my-target-topic</code> here)</em> - The S3 Bucket parameter of the <code>camel.sink.url</code> configuration option <em>(named <code>my-s3-bucket</code> here)</em></p> <p><strong>Please note</strong> that it is an explicit intention that the topics used in the <a href=#kafka-to-s3-sink-connector>Kafka to S3 Sink Connector</a> configuration and the <a href=#s3-to-kafka-source-connector>S3 to Kafka Source Connector</a> configuration are different. If these configurations were to use the <strong>same Kafka topic</strong> and the <strong>same S3 Bucket</strong>, we would create an infinite processing loop of the same information being endlessly recycled through the system. In our example deployments here, we are deploying to different topics but the same S3 Bucket.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kafka.strimzi.io/v1alpha1</span><span class=w></span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">KafkaConnector</span><span class=w></span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">s3-source-connector</span><span class=w></span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>    </span><span class=nt>strimzi.io/cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connect-cluster-101</span><span class=w></span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>  </span><span class=nt>class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.camel.kafkaconnector.CamelSourceConnector</span><span class=w></span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>  </span><span class=nt>tasksMax</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w></span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>    </span><span class=nt>key.converter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.kafka.connect.storage.StringConverter</span><span class=w></span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>    </span><span class=nt>value.converter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.camel.kafkaconnector.awss3.converters.S3ObjectConverter</span><span class=w></span>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>    </span><span class=nt>topics</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-target-topic</span><span class=w></span>
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=w>    </span><span class=nt>camel.source.kafka.topic</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-target-topic</span><span class=w></span>
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=w>    </span><span class=nt>camel.source.url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aws-s3://my-s3-bucket?autocloseBody=false</span><span class=w></span>
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=w>    </span><span class=nt>camel.source.maxPollDuration</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10000</span><span class=w></span>
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=w>    </span><span class=nt>camel.component.aws-s3.accessKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${file:/opt/kafka/external-configuration/aws-credentials/aws-credentials.properties:aws_access_key_id}</span><span class=w></span>
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=w>    </span><span class=nt>camel.component.aws-s3.secretKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${file:/opt/kafka/external-configuration/aws-credentials/aws-credentials.properties:aws_secret_access_key}</span><span class=w></span>
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=w>    </span><span class=nt>camel.component.aws-s3.region</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">US_EAST_1</span><span class=w></span>
</code></pre></div> <p>Once you have updated the YAML and saved it in a file named <code>kafka-source-connector.yaml</code>, this resource can be created via <code>kubectl apply -f kafka-source-connector.yaml</code>. You can then tail the output of the <code>connect-cluster-101</code> pods for updates on the connector status.</p> <p><strong>NOTE:</strong> If you require the connector to only read objects from a subdirecotry of the S3 bucket root, you can set the <code>camel.component.aws-s3.configuration.prefix</code> configuration option with the value of the subdirectory name. For example, <code>camel.component.aws-s3.configuration.prefix: myfoldername</code> .</p> <h2 id=event-streams-v10-addendum>Event Streams v10 Addendum<a class=headerlink href=#event-streams-v10-addendum title="Permanent link">&para;</a></h2> <ul> <li>The steps up to now assumed usage of an OpenShift Container Platform v4.3.x cluster, IBM Cloud Pak for Integration v2020.1.1 and IBM Event Streams v2019.4.2</li> <li> <p>With the release of Event Streams v10 (which is built on top of the Strimzi Kafka Operator) and the new CP4I there are some things need that need to be adjusted in the yamls to reflect that.</p> </li> <li> <p>You can edit the previous <code>kafka-connect.yaml</code> or create a new file. <strong>kafka-connect-esv10.yaml</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">eventstreams.ibm.com/v1beta1</span><span class=w></span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">KafkaConnectS2I</span><span class=w></span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connect-cluster-101</span><span class=w></span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=w>    </span><span class=nt>eventstreams.ibm.com/use-connector-resources</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span><span class=w></span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=w>  </span><span class=c1>#logging:</span><span class=w></span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=w>  </span><span class=c1>#  type: external</span><span class=w></span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=w>  </span><span class=c1>#  name: custom-connect-log4j</span><span class=w></span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2.5.0</span><span class=w></span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w></span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>  </span><span class=nt>bootstrapServers</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=nv>internal-bootstrap-server-address</span><span class="p p-Indicator">}</span><span class=w></span>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>    </span><span class=nt>pod</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=w>      </span><span class=nt>imagePullSecrets</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[]</span><span class=w></span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=w>      </span><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=w>        </span><span class=nt>annotations</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=w>          </span><span class=nt>eventstreams.production.type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CloudPakForIntegrationNonProduction</span><span class=w></span>
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=w>          </span><span class=nt>productID</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=nv>product-id</span><span class="p p-Indicator">}</span><span class=w></span>
<a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=w>          </span><span class=nt>productName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IBM Event Streams for Non Production</span><span class=w></span>
<a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=w>          </span><span class=nt>productVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10.0.0</span><span class=w></span>
<a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a><span class=w>          </span><span class=nt>productMetric</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VIRTUAL_PROCESSOR_CORE</span><span class=w></span>
<a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a><span class=w>          </span><span class=nt>productChargedContainers</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=nv>connect-cluster-101</span><span class="p p-Indicator">}</span><span class="l l-Scalar l-Scalar-Plain">-connect</span><span class=w></span>
<a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a><span class=w>          </span><span class=nt>cloudpakId</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=nv>cloudpak-id</span><span class="p p-Indicator">}</span><span class=w></span>
<a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a><span class=w>          </span><span class=nt>cloudpakName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IBM Cloud Pak for Integration</span><span class=w></span>
<a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a><span class=w>          </span><span class=nt>cloudpakVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2020.2.1</span><span class=w></span>
<a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a><span class=w>          </span><span class=nt>productCloudpakRatio</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2:1&quot;</span><span class=w></span>
<a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a><span class=w>  </span><span class=nt>tls</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a><span class=w>      </span><span class=nt>trustedCertificates</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=nv>your-es-instance-name</span><span class="p p-Indicator">}</span><span class="l l-Scalar l-Scalar-Plain">-cluster-ca-cert</span><span class=w></span>
<a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a><span class=w>          </span><span class=nt>certificate</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ca.crt</span><span class=w></span>
<a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a><span class=w>  </span><span class=nt>authentication</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tls</span><span class=w></span>
<a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a><span class=w>    </span><span class=nt>certificateAndKey</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-36 name=__codelineno-11-36 href=#__codelineno-11-36></a><span class=w>      </span><span class=nt>certificate</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user.crt</span><span class=w></span>
<a id=__codelineno-11-37 name=__codelineno-11-37 href=#__codelineno-11-37></a><span class=w>      </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user.key</span><span class=w></span>
<a id=__codelineno-11-38 name=__codelineno-11-38 href=#__codelineno-11-38></a><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=nv>generated-secret-from-ui</span><span class="p p-Indicator">}</span><span class=w></span>
<a id=__codelineno-11-39 name=__codelineno-11-39 href=#__codelineno-11-39></a><span class=w>  </span><span class=nt>externalConfiguration</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-40 name=__codelineno-11-40 href=#__codelineno-11-40></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-41 name=__codelineno-11-41 href=#__codelineno-11-41></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aws-credentials</span><span class=w></span>
<a id=__codelineno-11-42 name=__codelineno-11-42 href=#__codelineno-11-42></a><span class=w>        </span><span class=nt>secret</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-43 name=__codelineno-11-43 href=#__codelineno-11-43></a><span class=w>          </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aws-credentials</span><span class=w></span>
<a id=__codelineno-11-44 name=__codelineno-11-44 href=#__codelineno-11-44></a><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-11-45 name=__codelineno-11-45 href=#__codelineno-11-45></a><span class=w>    </span><span class=nt>group.id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connect-cluster-101</span><span class=w></span>
<a id=__codelineno-11-46 name=__codelineno-11-46 href=#__codelineno-11-46></a><span class=w>    </span><span class=nt>config.providers</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">file</span><span class=w></span>
<a id=__codelineno-11-47 name=__codelineno-11-47 href=#__codelineno-11-47></a><span class=w>    </span><span class=nt>config.providers.file.class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.kafka.common.config.provider.FileConfigProvider</span><span class=w></span>
<a id=__codelineno-11-48 name=__codelineno-11-48 href=#__codelineno-11-48></a><span class=w>    </span><span class=nt>key.converter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.kafka.connect.json.JsonConverter</span><span class=w></span>
<a id=__codelineno-11-49 name=__codelineno-11-49 href=#__codelineno-11-49></a><span class=w>    </span><span class=nt>value.converter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.kafka.connect.json.JsonConverter</span><span class=w></span>
<a id=__codelineno-11-50 name=__codelineno-11-50 href=#__codelineno-11-50></a><span class=w>    </span><span class=nt>key.converter.schemas.enable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w></span>
<a id=__codelineno-11-51 name=__codelineno-11-51 href=#__codelineno-11-51></a><span class=w>    </span><span class=nt>value.converter.schemas.enable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w></span>
<a id=__codelineno-11-52 name=__codelineno-11-52 href=#__codelineno-11-52></a><span class=w>    </span><span class=nt>offset.storage.topic</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connect-cluster-101-offsets</span><span class=w></span>
<a id=__codelineno-11-53 name=__codelineno-11-53 href=#__codelineno-11-53></a><span class=w>    </span><span class=nt>config.storage.topic</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connect-cluster-101-configs</span><span class=w></span>
<a id=__codelineno-11-54 name=__codelineno-11-54 href=#__codelineno-11-54></a><span class=w>    </span><span class=nt>status.storage.topic</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connect-cluster-101-status</span><span class=w></span>
</code></pre></div></p> </li> <li> <p>There are a couple changes of note here.</p> </li> <li><code>apiVersion: eventstreams.ibm.com/v1beta1</code> instead of the previous Strimzi one.</li> <li><code>metadata.annotations.eventstreams.ibm.com/use-connector-resources: "true"</code> instead of the previous Strimzi one as well.</li> <li><code>spec.bootstrapservers:</code> Previously in Event Streams v2019.4.2 and prior there was only a single external facing route for this bootstrap server address. In Event Streams v10 there is an <code>External</code> and <code>Internal</code> one now. Replace <code>{internal-bootstrap-server-address}</code> with the <code>Internal</code> bootstrap server address from the Event Streams v10 UI.</li> <li><code>spec.template.pod.metadata.annotations.*</code> This entire section is new and represents new metadata that the Event Streams instance needs.</li> <li><code>spec.template.pod.metadata.annotations.productID</code> You can find this value when trying to deploy an Event Streams Custom Resource from the Installed Event Streams Operator YAML deployment or when applying this YAML through the command-line, OCP will provide you the proper values if they're wrong.</li> <li><code>spec.template.pod.metadata.annotations.cloudpakId</code> Same as productID.</li> <li><code>spec.tls.trustedCertificates</code> This is different from the previous one in that this certificate was automatically generated on creation of your Event Streams Kafka Cluster. If your Event Streams instance is named <code>eventstreams-dev</code> then this value should be <code>eventstreams-dev-cluster-ca-cert</code>.</li> <li><code>spec.authentication.*</code> This section is mostly different from the previous section. Prior we used a generated API Key, but on Event Streams v10 we will need to generate TLS credentials. In the <code>Internal</code> connection details there will be a <code>Generate TLS Credentials</code> button. Here you can name your secret and provide the proper access to it. <strong>Note 1</strong> - This is automatically created by the Event Streams Operator into the same namespace as both a <code>KafkaUser</code> Custom Resource as well as a secret. If your secret is named <code>internal-secret</code> then there will be an automatically generated Kubernetes/OpenShift secret named that as well as a <code>KafkaUser</code>. <code>user.crt</code> and <code>user.key</code> are certificates automatically generated within said secret. <strong>Note 2</strong> - Deletion of that secret will replicate itself. You will need to delete the associated and created <code>KafkaUser</code>.</li> </ul> <p><strong>kafka-sink-connector.yaml-esv10.yaml</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">eventstreams.ibm.com/v1alpha1</span><span class=w></span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">KafkaConnector</span><span class=w></span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">s3-sink-connector</span><span class=w></span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=w>    </span><span class=nt>eventstreams.ibm.com/cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connect-cluster-101</span><span class=w></span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>  </span><span class=nt>class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.camel.kafkaconnector.CamelSinkConnector</span><span class=w></span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=w>  </span><span class=nt>tasksMax</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w></span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=w>    </span><span class=nt>key.converter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.kafka.connect.storage.StringConverter</span><span class=w></span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=w>    </span><span class=nt>value.converter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.kafka.connect.storage.StringConverter</span><span class=w></span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=w>    </span><span class=nt>topics</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-topic</span><span class=w></span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=w>    </span><span class=nt>camel.sink.url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aws-s3://my-s3-bucket?keyName=${date:now:yyyyMMdd-HHmmssSSS}-${exchangeId}</span><span class=w></span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=w>    </span><span class=nt>camel.sink.maxPollDuration</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10000</span><span class=w></span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=w>    </span><span class=nt>camel.component.aws-s3.configuration.autocloseBody</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w></span>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=w>    </span><span class=nt>camel.component.aws-s3.accessKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${file:/opt/kafka/external-configuration/aws-credentials/aws-credentials.properties:aws_access_key_id}</span><span class=w></span>
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=w>    </span><span class=nt>camel.component.aws-s3.secretKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${file:/opt/kafka/external-configuration/aws-credentials/aws-credentials.properties:aws_secret_access_key}</span><span class=w></span>
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=w>    </span><span class=nt>camel.component.aws-s3.region</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-s3-bucket-region</span><span class=w></span>
</code></pre></div> - For the most part identical besides two minor changes. - <code>apiVersion: eventstreams.ibm.com/v1alpha1</code> instead of Strimzi. - <code>metadata.labels.eventstreams.ibm.com/cluster: connect-cluster-101</code> again instead of Strimzi.</p> <p><strong>kafka-source-connector.yaml-esv10.yaml</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">eventstreams.ibm.com/v1alpha1</span><span class=w></span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">KafkaConnector</span><span class=w></span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">s3-source-connector</span><span class=w></span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>    </span><span class=nt>eventstreams.ibm.com/cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connect-cluster-101</span><span class=w></span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=w>  </span><span class=nt>class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.camel.kafkaconnector.CamelSourceConnector</span><span class=w></span>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=w>  </span><span class=nt>tasksMax</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w></span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=w>    </span><span class=nt>key.converter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.kafka.connect.storage.StringConverter</span><span class=w></span>
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=w>    </span><span class=nt>value.converter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.camel.kafkaconnector.awss3.converters.S3ObjectConverter</span><span class=w></span>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=w>    </span><span class=nt>topics</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-topic</span><span class=w></span>
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=w>    </span><span class=nt>camel.source.kafka.topic</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-topic</span><span class=w></span>
<a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=w>    </span><span class=nt>camel.source.url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aws-s3://my-s3-bucket?autocloseBody=false</span><span class=w></span>
<a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=w>    </span><span class=nt>camel.source.maxPollDuration</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10000</span><span class=w></span>
<a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=w>    </span><span class=nt>camel.component.aws-s3.accessKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${file:/opt/kafka/external-configuration/aws-credentials/aws-credentials.properties:aws_access_key_id}</span><span class=w></span>
<a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=w>    </span><span class=nt>camel.component.aws-s3.secretKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${file:/opt/kafka/external-configuration/aws-credentials/aws-credentials.properties:aws_secret_access_key}</span><span class=w></span>
<a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=w>    </span><span class=nt>camel.component.aws-s3.region</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-s3-bucket-region</span><span class=w></span>
</code></pre></div> - Similar to the S3 sink connector yaml. - <code>apiVersion: eventstreams.ibm.com/v1alpha1</code> instead of Strimzi. - <code>metadata.labels.eventstreams.ibm.com/cluster: connect-cluster-101</code> again instead of Strimzi.</p> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h2> <ul> <li> <p>The log output from the Kafka Connector instances will be available in the KafkaConnectS2I pods, named in the pattern of <code>{connect-cluster-name}-connect-{latest-build-id}-{random-suffix}</code>. This pattern will be referred to as <code>{connect-pod}</code> throughout the rest of the <strong>Troubleshooting</strong> section.</p> </li> <li> <p>To increase the logging output of the deployed connector instances:</p> </li> <li>Follow the steps for <strong>"Create ConfigMap for log4j configuration"</strong> in <a href=#kafka-connect-cluster>Kafka Connect Cluster</a> above</li> <li>Update the <code>log4j.properties</code> ConfigMap to include the line <code>log4j.logger.org.apache.camel.kafkaconnector=DEBUG</code></li> <li> <p>Reapply the YAML configuration of the KafkaConnectS2I cluster</p> </li> <li> <p>To check the deployment status of applied Kafka Connect configuration via Kafka Connect's REST API, run the following commands:</p> </li> <li><code>oc exec {connect-pod} bash -- -c "curl --silent http://localhost:8083/connectors/"</code></li> <li><code>oc exec {connect-pod} bash -- -c "curl --silent http://localhost:8083/connectors/{deployed-connector-name}/status"</code></li> </ul> <h2 id=next-steps>Next steps<a class=headerlink href=#next-steps title="Permanent link">&para;</a></h2> <ul> <li>Enable use of IAM Credentials in the Connector configuration <em>(as the default Java code currently outputs <code>aws_access_key_id</code> and <code>aws_secret_access_key</code> to container runtime logs due to their existence as configuration properties)</em></li> <li>Optionally configure individual connector instances to startup with offset value of -1 <em>(to enable to run from beginning of available messages)</em></li> <li>Implement a build system to produce container images with the Camel Kafka Connector binaries already present</li> </ul> <h2 id=references>References<a class=headerlink href=#references title="Permanent link">&para;</a></h2> <ul> <li><a href=https://camel.apache.org/camel-kafka-connector/latest/try-it-out-on-openshift-with-strimzi.html>Apache Camel Kafka Connector - Try it out on OpenShift with Strimzi</a></li> <li><a href=https://camel.apache.org/components/latest/languages/simple-language.html>Apache Camel - Available pattern elements</a> for use in the <code>keyName</code> parameter of the <code>camel.sink.url</code> property.</li> <li><a href=https://camel.apache.org/components/latest/eips/toD-eip.html>Apache Camel - Dynamic Endpoint reference</a></li> <li><a href=https://developers.redhat.com/blog/2020/02/14/using-secrets-in-apache-kafka-connect-configuration/ >Red Hat Developer Blog - Using secrets in Kafka Connect configuration</a></li> <li><a href=http://kafka.apache.org/documentation/#connect>Apache Kafka - Connect Overview</a></li> </ul> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../technology/event-streams/es-cp4i/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Deploy Event-Streams" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Deploy Event-Streams </div> </div> </a> <a href=../connect-cos/ class="md-footer__link md-footer__link--next" aria-label="Next: Kafka Connect - COS" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Kafka Connect - COS </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright  2022 IBM </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/ibm-cloud-architecture target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/agileitarchitecture target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tabs.sticky", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.9c69f0bc.min.js></script> </body> </html>