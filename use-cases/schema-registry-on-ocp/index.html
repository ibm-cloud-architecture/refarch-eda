<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Hands on lab to understand IBM Event Streams from the IBM CloudPak for Integration Schema Registry feature"><meta name=author content="Jerome Boyer"><link href=https://ibm-cloud-architecture.github.com/refarch-eda/use-cases/schema-registry-on-ocp/ rel=canonical><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.1"><title>IBM Event Streams Schema Registry from IBM CloudPak for Integration - IBM Automation - Event-driven Solution - Sharing knowledge</title><link rel=stylesheet href=../../assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cbb835fc.min.css><meta name=theme-color content=#000000><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#requirements class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="IBM Automation - Event-driven Solution - Sharing knowledge" class="md-header__button md-logo" aria-label="IBM Automation - Event-driven Solution - Sharing knowledge" data-md-component=logo> <img src=../../images/es-icon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> IBM Automation - Event-driven Solution - Sharing knowledge </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> IBM Event Streams Schema Registry from IBM CloudPak for Integration </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ibm-cloud-architecture/refarch-eda title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> ibm-cloud-architecture/refarch-eda </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="IBM Automation - Event-driven Solution - Sharing knowledge" class="md-nav__button md-logo" aria-label="IBM Automation - Event-driven Solution - Sharing knowledge" data-md-component=logo> <img src=../../images/es-icon.png alt=logo> </a> IBM Automation - Event-driven Solution - Sharing knowledge </label> <div class=md-nav__source> <a href=https://github.com/ibm-cloud-architecture/refarch-eda title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> ibm-cloud-architecture/refarch-eda </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../news/ class=md-nav__link> What's new </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Introduction <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Introduction data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Introduction </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../introduction/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../introduction/reference-architecture/ class=md-nav__link> Reference Architecture </a> </li> <li class=md-nav__item> <a href=../../introduction/usecases/ class=md-nav__link> Business Use Cases </a> </li> <li class=md-nav__item> <a href=../../introduction/target-audiences/ class=md-nav__link> Target Audiences </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Learning Journey <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Learning Journey" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Learning Journey </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../journey/101/ class=md-nav__link> Get started (101 content) </a> </li> <li class=md-nav__item> <a href=../../journey/201/ class=md-nav__link> Deeper dive (201 content) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Concepts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Concepts data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../concepts/terms-and-definitions/ class=md-nav__link> Terms & Definitions </a> </li> <li class=md-nav__item> <a href=../../concepts/integration/ class=md-nav__link> Agile Integration </a> </li> <li class=md-nav__item> <a href=../../concepts/events-versus-messages/ class=md-nav__link> Event streaming versus Queuing </a> </li> <li class=md-nav__item> <a href=../../concepts/fit-to-purpose/ class=md-nav__link> Fit for purpose </a> </li> <li class=md-nav__item> <a href=../../concepts/model/ class=md-nav__link> Devising the data models </a> </li> <li class=md-nav__item> <a href=../../concepts/flow-architectures/ class=md-nav__link> Flow Architecture </a> </li> <li class=md-nav__item> <a href=../../concepts/service-mesh/ class=md-nav__link> Service mesh </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Advantages of EDA <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Advantages of EDA" data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Advantages of EDA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advantages/microservice/ class=md-nav__link> Microservice decoupling </a> </li> <li class=md-nav__item> <a href=../../advantages/reactive/ class=md-nav__link> Reactive systems </a> </li> <li class=md-nav__item> <a href=../../advantages/resiliency/ class=md-nav__link> Resiliency </a> </li> <li class=md-nav__item> <a href=../../advantages/scalability/ class=md-nav__link> Scalability </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Patterns in EDA <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Patterns in EDA" data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Patterns in EDA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../patterns/intro/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../patterns/event-sourcing/ class=md-nav__link> Event Sourcing </a> </li> <li class=md-nav__item> <a href=../../patterns/cqrs/ class=md-nav__link> CQRS </a> </li> <li class=md-nav__item> <a href=../../patterns/saga/ class=md-nav__link> Saga </a> </li> <li class=md-nav__item> <a href=../../patterns/dlq/ class=md-nav__link> Dead Letter Queue </a> </li> <li class=md-nav__item> <a href=../../patterns/topic-replication/ class=md-nav__link> Topic Replication </a> </li> <li class=md-nav__item> <a href=../../patterns/data-pipeline/ class=md-nav__link> Data Intensive App </a> </li> <li class=md-nav__item> <a href=../../patterns/realtime-analytics/ class=md-nav__link> Near real-time analytics </a> </li> <li class=md-nav__item> <a href=../../patterns/api-mgt/ class=md-nav__link> API management </a> </li> <li class=md-nav__item> <a href=../../patterns/cep/ class=md-nav__link> Situational decision </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Methodology <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Methodology data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Methodology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../methodology/event-storming/ class=md-nav__link> Event Storming </a> </li> <li class=md-nav__item> <a href=../../methodology/domain-driven-design/ class=md-nav__link> Domain-Driven Design </a> </li> <li class=md-nav__item> <a href=../../methodology/data-intensive/ class=md-nav__link> Data Intensive App Development </a> </li> <li class=md-nav__item> <a href=../../methodology/data-lineage/ class=md-nav__link> Data lineage </a> </li> <li class=md-nav__item> <a href=../../methodology/governance/ class=md-nav__link> Governance </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> Technology <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Technology data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Technology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../technology/kafka-overview/ class=md-nav__link> Kafka Overview </a> </li> <li class=md-nav__item> <a href=../../technology/event-streams/ class=md-nav__link> Event Streams </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/eda-tech-academy/demo/ class=md-nav__link> Event Streams Demo Script </a> </li> <li class=md-nav__item> <a href=../../technology/faq/ class=md-nav__link> Kafka FAQ </a> </li> <li class=md-nav__item> <a href=../../technology/mq/ class=md-nav__link> MQ in EDA context </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-producers/ class=md-nav__link> Kafka Producers </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-consumers/ class=md-nav__link> Kafka Consumers </a> </li> <li class=md-nav__item> <a href=../../technology/avro-schemas/ class=md-nav__link> Avro Schema </a> </li> <li class=md-nav__item> <a href=../../technology/advanced-kafka/ class=md-nav__link> Advanced Concepts </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-streams/ class=md-nav__link> Kafka Streams </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-connect/ class=md-nav__link> Kafka Connect </a> </li> <li class=md-nav__item> <a href=../../technology/event-streams/es-maas/security/ class=md-nav__link> Kafka security </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-monitoring/ class=md-nav__link> Kafka Monitoring </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-mirrormaker/ class=md-nav__link> Mirror Maker 2 </a> </li> <li class=md-nav__item> <a href=../../technology/security/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../../technology/flink/ class=md-nav__link> Apache Flink </a> </li> <li class=md-nav__item> <a href=../../technology/spring/ class=md-nav__link> Spring cloud </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10 type=checkbox id=__nav_10 checked> <label class=md-nav__link for=__nav_10> Use Cases <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Use Cases" data-md-level=1> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Use Cases </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../gitops/ class=md-nav__link> Event-driven solution GitOps </a> </li> <li class=md-nav__item> <a href=../../technology/event-streams/es-cp4i/ class=md-nav__link> Deploy Event-Streams </a> </li> <li class=md-nav__item> <a href=../connect-s3/ class=md-nav__link> Kafka Connect - S3 </a> </li> <li class=md-nav__item> <a href=../connect-cos/ class=md-nav__link> Kafka Connect - COS </a> </li> <li class=md-nav__item> <a href=../connect-jdbc/ class=md-nav__link> Kafka Connect - jdbc </a> </li> <li class=md-nav__item> <a href=../connect-mq/ class=md-nav__link> Kafka Connect - MQ </a> </li> <li class=md-nav__item> <a href=../connect-rabbitmq/ class=md-nav__link> Kafka Connect - Rabbitmq </a> </li> <li class=md-nav__item> <a href=../kafka-streams/ class=md-nav__link> Kafka Streams labs </a> </li> <li class=md-nav__item> <a href=../db2-debezium/ class=md-nav__link> DB2 - CDC Debezium - Outbox </a> </li> <li class=md-nav__item> <a href=../kafka-mm2/ class=md-nav__link> Mirror maker 2 labs </a> </li> <li class=md-nav__item> <a href=../schema-registry-on-cloud/ class=md-nav__link> Schema registry ES on Cloud </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Schema registry <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Schema registry </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#requirements class=md-nav__link> Requirements </a> </li> <li class=md-nav__item> <a href=#ibm-cloud-shell class=md-nav__link> IBM Cloud Shell </a> <nav class=md-nav aria-label="IBM Cloud Shell"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ibm-cloud-pak-cli class=md-nav__link> IBM Cloud Pak CLI </a> </li> <li class=md-nav__item> <a href=#event-streams-plugin-for-ibm-cloud-pak-cli class=md-nav__link> Event Streams plugin for IBM Cloud Pak CLI </a> </li> <li class=md-nav__item> <a href=#git class=md-nav__link> Git </a> </li> <li class=md-nav__item> <a href=#vi class=md-nav__link> Vi </a> </li> <li class=md-nav__item> <a href=#python-3 class=md-nav__link> Python 3 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#schema-registry class=md-nav__link> Schema Registry </a> <nav class=md-nav aria-label="Schema Registry"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#accessing-the-schema-registry class=md-nav__link> Accessing the Schema Registry </a> <nav class=md-nav aria-label="Accessing the Schema Registry"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli class=md-nav__link> CLI </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#schemas class=md-nav__link> Schemas </a> <nav class=md-nav aria-label=Schemas> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-a-schema class=md-nav__link> Create a schema </a> <nav class=md-nav aria-label="Create a schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_1 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_1 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#list-schemas class=md-nav__link> List schemas </a> <nav class=md-nav aria-label="List schemas"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_2 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_2 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#delete-schemas class=md-nav__link> Delete schemas </a> <nav class=md-nav aria-label="Delete schemas"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_3 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_3 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#create-new-schema-version class=md-nav__link> Create new schema version </a> <nav class=md-nav aria-label="Create new schema version"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_4 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_4 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#get-latest-version-of-a-schema class=md-nav__link> Get latest version of a schema </a> <nav class=md-nav aria-label="Get latest version of a schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_5 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_5 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#get-specific-version-of-a-schema class=md-nav__link> Get specific version of a schema </a> <nav class=md-nav aria-label="Get specific version of a schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_6 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_6 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#listing-all-versions-of-a-schema class=md-nav__link> Listing all versions of a schema </a> <nav class=md-nav aria-label="Listing all versions of a schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_7 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_7 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deleting-a-version-of-a-schema class=md-nav__link> Deleting a version of a schema </a> <nav class=md-nav aria-label="Deleting a version of a schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_8 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_8 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ibm-event-streams-credentials class=md-nav__link> IBM Event Streams Credentials </a> <nav class=md-nav aria-label="IBM Event Streams Credentials"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#gui class=md-nav__link> GUI </a> </li> <li class=md-nav__item> <a href=#cli_9 class=md-nav__link> CLI </a> </li> <li class=md-nav__item> <a href=#environment-variables class=md-nav__link> Environment variables </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#python-application class=md-nav__link> Python Application </a> <nav class=md-nav aria-label="Python Application"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#clone class=md-nav__link> Clone </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#python-avro-producer class=md-nav__link> Python Avro Producer </a> <nav class=md-nav aria-label="Python Avro Producer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#produce-message class=md-nav__link> Produce Message </a> </li> <li class=md-nav__item> <a href=#avro-utils class=md-nav__link> Avro Utils </a> </li> <li class=md-nav__item> <a href=#kafka-avro-producer class=md-nav__link> Kafka Avro Producer </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#python-avro-consumer class=md-nav__link> Python Avro Consumer </a> <nav class=md-nav aria-label="Python Avro Consumer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#consume-message class=md-nav__link> Consume Message </a> </li> <li class=md-nav__item> <a href=#kafka-avro-consumer class=md-nav__link> Kafka Avro Consumer </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#schemas-and-messages class=md-nav__link> Schemas and Messages </a> <nav class=md-nav aria-label="Schemas and Messages"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#produce-a-message class=md-nav__link> Produce a message </a> </li> <li class=md-nav__item> <a href=#create-a-non-compliant-message class=md-nav__link> Create a non-compliant message </a> </li> <li class=md-nav__item> <a href=#consume-a-message class=md-nav__link> Consume a message </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#data-evolution class=md-nav__link> Data Evolution </a> <nav class=md-nav aria-label="Data Evolution"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#adding-a-new-attribute class=md-nav__link> Adding a new attribute </a> </li> <li class=md-nav__item> <a href=#removing-an-existing-attribute class=md-nav__link> Removing an existing attribute </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security class=md-nav__link> Security </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../monitoring-on-cloud/ class=md-nav__link> Monitoring ES on Cloud </a> </li> <li class=md-nav__item> <a href=../monitoring-on-ocp/ class=md-nav__link> Monitoring ES </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11 type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11> Scenarios <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Scenarios data-md-level=1> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Scenarios </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../scenarios/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/refarch-kc/ class=md-nav__link> Reefer Shipment Solution </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/vaccine-solution-main/ class=md-nav__link> Vaccine at Scale </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/eda-rt-inventory-gitops class=md-nav__link> Near real-time Inventory </a> </li> <li class=md-nav__item> <a href=../../scenarios/saga-orchestration/ class=md-nav__link> SAGA with MQ Orchestration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../additional-reading/ class=md-nav__link> Additional reading </a> </li> <li class=md-nav__item> <a href=../../contribute/ class=md-nav__link> Contribute to this Site </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#requirements class=md-nav__link> Requirements </a> </li> <li class=md-nav__item> <a href=#ibm-cloud-shell class=md-nav__link> IBM Cloud Shell </a> <nav class=md-nav aria-label="IBM Cloud Shell"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ibm-cloud-pak-cli class=md-nav__link> IBM Cloud Pak CLI </a> </li> <li class=md-nav__item> <a href=#event-streams-plugin-for-ibm-cloud-pak-cli class=md-nav__link> Event Streams plugin for IBM Cloud Pak CLI </a> </li> <li class=md-nav__item> <a href=#git class=md-nav__link> Git </a> </li> <li class=md-nav__item> <a href=#vi class=md-nav__link> Vi </a> </li> <li class=md-nav__item> <a href=#python-3 class=md-nav__link> Python 3 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#schema-registry class=md-nav__link> Schema Registry </a> <nav class=md-nav aria-label="Schema Registry"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#accessing-the-schema-registry class=md-nav__link> Accessing the Schema Registry </a> <nav class=md-nav aria-label="Accessing the Schema Registry"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli class=md-nav__link> CLI </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#schemas class=md-nav__link> Schemas </a> <nav class=md-nav aria-label=Schemas> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-a-schema class=md-nav__link> Create a schema </a> <nav class=md-nav aria-label="Create a schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_1 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_1 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#list-schemas class=md-nav__link> List schemas </a> <nav class=md-nav aria-label="List schemas"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_2 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_2 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#delete-schemas class=md-nav__link> Delete schemas </a> <nav class=md-nav aria-label="Delete schemas"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_3 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_3 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#create-new-schema-version class=md-nav__link> Create new schema version </a> <nav class=md-nav aria-label="Create new schema version"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_4 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_4 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#get-latest-version-of-a-schema class=md-nav__link> Get latest version of a schema </a> <nav class=md-nav aria-label="Get latest version of a schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_5 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_5 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#get-specific-version-of-a-schema class=md-nav__link> Get specific version of a schema </a> <nav class=md-nav aria-label="Get specific version of a schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_6 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_6 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#listing-all-versions-of-a-schema class=md-nav__link> Listing all versions of a schema </a> <nav class=md-nav aria-label="Listing all versions of a schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_7 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_7 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deleting-a-version-of-a-schema class=md-nav__link> Deleting a version of a schema </a> <nav class=md-nav aria-label="Deleting a version of a schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_8 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#cli_8 class=md-nav__link> CLI </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ibm-event-streams-credentials class=md-nav__link> IBM Event Streams Credentials </a> <nav class=md-nav aria-label="IBM Event Streams Credentials"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#gui class=md-nav__link> GUI </a> </li> <li class=md-nav__item> <a href=#cli_9 class=md-nav__link> CLI </a> </li> <li class=md-nav__item> <a href=#environment-variables class=md-nav__link> Environment variables </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#python-application class=md-nav__link> Python Application </a> <nav class=md-nav aria-label="Python Application"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#clone class=md-nav__link> Clone </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#python-avro-producer class=md-nav__link> Python Avro Producer </a> <nav class=md-nav aria-label="Python Avro Producer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#produce-message class=md-nav__link> Produce Message </a> </li> <li class=md-nav__item> <a href=#avro-utils class=md-nav__link> Avro Utils </a> </li> <li class=md-nav__item> <a href=#kafka-avro-producer class=md-nav__link> Kafka Avro Producer </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#python-avro-consumer class=md-nav__link> Python Avro Consumer </a> <nav class=md-nav aria-label="Python Avro Consumer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#consume-message class=md-nav__link> Consume Message </a> </li> <li class=md-nav__item> <a href=#kafka-avro-consumer class=md-nav__link> Kafka Avro Consumer </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#schemas-and-messages class=md-nav__link> Schemas and Messages </a> <nav class=md-nav aria-label="Schemas and Messages"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#produce-a-message class=md-nav__link> Produce a message </a> </li> <li class=md-nav__item> <a href=#create-a-non-compliant-message class=md-nav__link> Create a non-compliant message </a> </li> <li class=md-nav__item> <a href=#consume-a-message class=md-nav__link> Consume a message </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#data-evolution class=md-nav__link> Data Evolution </a> <nav class=md-nav aria-label="Data Evolution"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#adding-a-new-attribute class=md-nav__link> Adding a new attribute </a> </li> <li class=md-nav__item> <a href=#removing-an-existing-attribute class=md-nav__link> Removing an existing attribute </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security class=md-nav__link> Security </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ibm-cloud-architecture/refarch-eda/edit/master/docs/use-cases/schema-registry-on-ocp/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1>Schema registry</h1> <!-- Originally available via "/technology/event-streams/schema-registry-cp4i-v10/" --> <p>This documentation aims to be a introductory hands-on lab on the IBM Event Streams (v11.0.2) Schema Registry installed throught the <strong>IBM Cloud Pak for Integration V2022.2</strong> on an Openshift cluster. It uses Python applications for producer and consumer with schema registry API. For a Quarkus based producer and consumer see the <a href=https://github.com/ibm-cloud-architecture/eda-quickstarts>EDA-quickstarts project</a> sub-folders: <code>quarkus-reactive-kafka-producer</code> and <code>quarkus-reactive-kafka-consumer</code> which includes docker compose with Apicur.io and reactive messaging implementation, plus all needed instructions to test schema management.</p> <h2 id=requirements>Requirements<a class=headerlink href=#requirements title="Permanent link">&para;</a></h2> <p>This lab requires the following components to work against:</p> <ol> <li>An IBM Event Streams V10 instance installed through the IBM CloudPak for Integration V2020.2.X or greater.</li> <li>An IBM Cloud Shell - <a href=https://www.ibm.com/cloud/cloud-shell>https://www.ibm.com/cloud/cloud-shell</a></li> </ol> <h2 id=ibm-cloud-shell>IBM Cloud Shell<a class=headerlink href=#ibm-cloud-shell title="Permanent link">&para;</a></h2> <p>Here we are going to set up our IBM Cloud Shell with all the tools required to carry out this lab.</p> <p>Start your IBM Cloud Shell by pointing your browser to <a href=https://cloud.ibm.com/shell>https://cloud.ibm.com/shell</a></p> <p><img alt=shell src=images/shell-v10.png></p> <h4 id=ibm-cloud-pak-cli>IBM Cloud Pak CLI<a class=headerlink href=#ibm-cloud-pak-cli title="Permanent link">&para;</a></h4> <p>Cloudctl is a command line tool to manage Container Application Software for Enterprises (CASEs). This CLI will allow us to manage Cloud Pak related components as well as software, like IBM Event Streams, installed through any IBM Cloud Pak.</p> <p>In order to install it, execute the following commands in your IBM Cloud Shell:</p> <ol> <li>Download the IBM Cloud Pak CLI - <code>curl -L https://github.com/IBM/cloud-pak-cli/releases/latest/download/cloudctl-linux-amd64.tar.gz -o cloudctl-linux-amd64.tar.gz</code></li> <li>Untar it - <code>tar -xvf cloudctl-linux-amd64.tar.gz</code></li> <li>Rename it for ease of use - <code>mv cloudctl-linux-amd64 cloudctl</code></li> <li>Include it to the PATH environment variable - <code>export PATH=$PATH:$PWD</code></li> <li>Make sure your IBM Cloud Pak CLI is in the path- <code>which cloudctl</code></li> <li>Make sure your IBM Cloud Pak CLI works - <code>cloudctl help</code></li> </ol> <p><img alt=shell2 src=images/shell2-v10.png></p> <p><strong>Note:</strong> If you are not using the IBM Cloud Shell to run the lab, be aware that the <code>cloudctl</code> CLI requires the <code>kubectl</code> CLI. To install the <code>kubectl</code> CLI on your personal environment, follow the instructions <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl/ >here</a></p> <h4 id=event-streams-plugin-for-ibm-cloud-pak-cli>Event Streams plugin for IBM Cloud Pak CLI<a class=headerlink href=#event-streams-plugin-for-ibm-cloud-pak-cli title="Permanent link">&para;</a></h4> <p>This plugin will allow us to manage IBM Event Streams.</p> <p>In order to install it, execute the following commands in your IBM Cloud Shell:</p> <ol> <li>Download the Event Streams plugin for IBM Cloud Pak CLI - <code>curl -L http://ibm.biz/es-cli-linux -o es-plugin</code></li> <li>Install it - <code>cloudctl plugin install es-plugin</code></li> <li>Make sure it works - <code>cloudctl es help</code></li> </ol> <p><img alt=shell3 src=images/shell3-v10.png></p> <h4 id=git>Git<a class=headerlink href=#git title="Permanent link">&para;</a></h4> <p>IBM Cloud Shell comes with Git already installed out of the box.</p> <h4 id=vi>Vi<a class=headerlink href=#vi title="Permanent link">&para;</a></h4> <p>IBM Cloud Shell comes with Vi already installed out of the box.</p> <h4 id=python-3>Python 3<a class=headerlink href=#python-3 title="Permanent link">&para;</a></h4> <p>IBM Cloud Shell comes with Python 3 already installed out of the box. However, we need to install the following modules that will be used later on in this tutorial when we run a Python application to work with Avro, Schemas and messages. These modules are <code>confluent_kafka</code> and <code>avro-python3</code></p> <p>In order to install these modules, execute the following command in your IBM Cloud Shell:</p> <ol> <li>Install the modules - <code>python3 -mpip install avro-python3 confluent_kafka --user</code></li> </ol> <p><img alt=shell4 src=images/shell4-v10.png></p> <p><strong>Congrats!</strong> you have now your IBM Cloud Shell ready to start working.</p> <h2 id=schema-registry>Schema Registry<a class=headerlink href=#schema-registry title="Permanent link">&para;</a></h2> <p><img alt=diagram src=images/schema-registry.png></p> <p>One of the most common technologies used in the industry these days to define, serialize and deserialize messages flowing through your Kafka topics is Apache Avro (<a href=https://avro.apache.org/docs/current/ >https://avro.apache.org/docs/current/</a>). To learn more about Apache Avro, how to define Apache Avro data schemas and more, we strongly recommend to read through our documentation on Avro and data schemas <a href=/technology/avro-schemas/ >here</a></p> <p>IBM Event Streams development team has developed a Schema Registry to work along your Kafka cluster to provide a place to store descriptions of the message formats used by your producers and consumers. The benefit of storing these descriptions is that you are able to validate that your producing and consuming applications will correctly inter-operate. The Schema Registry will also provide the ability for schemas to evolve in time.</p> <h3 id=accessing-the-schema-registry>Accessing the Schema Registry<a class=headerlink href=#accessing-the-schema-registry title="Permanent link">&para;</a></h3> <h4 id=ui>UI<a class=headerlink href=#ui title="Permanent link">&para;</a></h4> <p>To access the schema registry, we first need to log into IBM Event Streams.</p> <ol> <li> <p>Point your browser to your IBM Event Streams instace's user interface url and introduce your credentials</p> <p><img alt=login src=images/login-v10.png></p> </li> <li> <p>Once you are logged into your IBM Event Streams instance, you simply need to click on the Schema Registry button on the main left hand vertical menu bar:</p> </li> </ol> <p><img alt=4 src=images/4-v10.png></p> <h4 id=cli>CLI<a class=headerlink href=#cli title="Permanent link">&para;</a></h4> <p>We can also interact with the Schema Registry through the IBM Event Streams CLI. In order to do so, we first need to log in with the IBM Cloud Pak CLI:</p> <ol> <li> <p>Log into your cluster with the IBM CloudPak CLI</p> <p><inlinenotification kind=warning></p> <p>Make sure to use the appropriate credentials and select the namespace where your IBM Event Streams instance is installed</p> <p></inlinenotification></p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>cloudctl login -a https://cp-console.apps.eda-solutions.gse-ocp.net --skip-ssl-validation
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>Username&gt; admin
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>Password&gt;
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>Authenticating...
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>OK
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>Targeted account mycluster Account
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>Enter a namespace &gt; integration
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>Targeted namespace integration
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>Configuring kubectl ...
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>Property <span class=s2>&quot;clusters.mycluster&quot;</span> unset.
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>Property <span class=s2>&quot;users.mycluster-user&quot;</span> unset.
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>Property <span class=s2>&quot;contexts.mycluster-context&quot;</span> unset.
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>Cluster <span class=s2>&quot;mycluster&quot;</span> set.
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>User <span class=s2>&quot;mycluster-user&quot;</span> set.
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>Context <span class=s2>&quot;mycluster-context&quot;</span> created.
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>Switched to context <span class=s2>&quot;mycluster-context&quot;</span>.
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>OK
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>Configuring helm: /Users/user/.helm
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>OK
</code></pre></div> </li> <li> <p>Initialize the Event Streams CLI plugin</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>cloudctl es init
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>IBM Cloud Platform Common Services endpoint:   https://cp-console.apps.eda-solutions.gse-ocp.net
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>Namespace:                                     integration
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>Name:                                          es-1
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>IBM Cloud Pak <span class=k>for</span> Integration UI address:      No instance of Cloud Pak <span class=k>for</span> Integration has been found. Please check that you have access to it.
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>Event Streams API endpoint:                    https://es-1-ibm-es-admapi-external-integration.apps.eda-solutions.gse-ocp.net
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>Event Streams API status:                      OK
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>Event Streams UI address:                      https://es-1-ibm-es-ui-integration.apps.eda-solutions.gse-ocp.net
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>Event Streams Schema Registry endpoint:        https://es-1-ibm-es-schema-external-integration.apps.eda-solutions.gse-ocp.net
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>Event Streams bootstrap address:               es-1-kafka-bootstrap-integration.apps.eda-solutions.gse-ocp.net:443
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>OK
</code></pre></div> <p>(*)The above information will later be used in the <a href=#ibm-event-streams-credentials>IBM Event Streams Credentials</a> section as these are neeeded by the Python application we will work with.</p> </li> <li> <p>Make sure you can access the IBM Event Streams Schema Registry:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>cloudctl es schemas
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>No schemas were found.
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>OK
</code></pre></div> </li> </ol> <h2 id=schemas>Schemas<a class=headerlink href=#schemas title="Permanent link">&para;</a></h2> <p>In this section we will finally get our hands dirty with the IBM Event Steams Schema Registry capability by working with Apache Avro schemas and the Schema Registry.</p> <p><inlinenotification kind=info></p> <p>We recommend to complete most of the UI steps from your <strong>local workstation</strong> since these will require you to upload the files your create/modify to IBM Event Streams and that requires having your files available locally on your workstation rather than on the IBM Cloud Shell</p> <p></inlinenotification></p> <h3 id=create-a-schema>Create a schema<a class=headerlink href=#create-a-schema title="Permanent link">&para;</a></h3> <p>Let's see how can we create a schema to start playing with.</p> <h4 id=ui_1>UI<a class=headerlink href=#ui_1 title="Permanent link">&para;</a></h4> <p>The IBM EVent Streams user interface allow us to create schemas only from <em>json</em> or Avro schema <em>avsc</em> files.</p> <ol> <li> <p>Create an Avro schema file <strong>avsc</strong> with your schema:</p> <p><inlinenotification kind=warning></p> <p>Change USER1</p> <p></inlinenotification></p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nb>echo</span> <span class=s1>&#39;{</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=s1>&quot;type&quot;:&quot;record&quot;,</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=s1>&quot;name&quot;:&quot;demoSchema_UI_USER1&quot;,</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=s1>&quot;namespace&quot;: &quot;schemas.demo.ui&quot;,</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=s1>&quot;fields&quot;:[</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=s1>    {&quot;name&quot;: &quot;eventKey&quot;,&quot;type&quot;:&quot;string&quot;},</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=s1>    {&quot;name&quot;: &quot;message&quot;,&quot;type&quot;:&quot;string&quot;}]</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=s1>}&#39;</span> &gt; demoshema-ui.avsc
</code></pre></div> </li> <li> <p>On the IBM Event Streams Schema Registry User Interface, Click on <em>Add schema</em> button on the top right corner.</p> </li> <li> <p>Click on <em>Upload definition</em> button on the left hand side and select the <code>demoschema-ui.avsc</code> file we just created.</p> </li> <li> <p>You should now see you Avro schema loaded in the UI with two tabs, definition and preview to make sure your schema looks as desired:</p> <p><img alt=5 src=images/5-v10.png></p> </li> <li> <p>Click on <em>Add schema</em> button at the top right corner and you should now see that schema listed among your other schemas.</p> </li> </ol> <h4 id=cli_1>CLI<a class=headerlink href=#cli_1 title="Permanent link">&para;</a></h4> <ol> <li> <p>Create another Avro schema <strong>avsc</strong> file with a different schema:</p> <p><inlinenotification kind=warning></p> <p>Change USER1</p> <p></inlinenotification></p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nb>echo</span> <span class=s1>&#39;{</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=s1>&quot;type&quot;:&quot;record&quot;,</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=s1>&quot;name&quot;:&quot;demoSchema_CLI_USER1&quot;,</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=s1>&quot;namespace&quot;: &quot;schemas.demo.cli&quot;,</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=s1>&quot;fields&quot;:[</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=s1>    {&quot;name&quot;: &quot;eventKey&quot;,&quot;type&quot;:&quot;string&quot;},</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=s1>    {&quot;name&quot;: &quot;message&quot;,&quot;type&quot;:&quot;string&quot;}]</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=s1>}&#39;</span> &gt; demoshema-cli.avsc
</code></pre></div> </li> <li> <p>Create a schema by executing the following command:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>cloudctl es schema-add --file demoshema-cli.avsc
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>Schema demoSchema_CLI_USER1 is active.
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>Version   Version ID   Schema           State    Updated                         Comment
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=m>1</span>.0.0     <span class=m>1</span>            demoSchema_CLI_USER1   active   Thu, <span class=m>25</span> Jun <span class=m>2020</span> <span class=m>11</span>:30:42 UTC
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>Added version <span class=m>1</span>.0.0 of schema demoSchema_CLI_USER1 to the registry.
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>OK
</code></pre></div> </li> </ol> <h3 id=list-schemas>List schemas<a class=headerlink href=#list-schemas title="Permanent link">&para;</a></h3> <h4 id=ui_2>UI<a class=headerlink href=#ui_2 title="Permanent link">&para;</a></h4> <p>In order to list the schemas in the UI you just simply need to open up the Schema Registry User Interface and schemas will get listed in there automatically. You also have a search tool bar at the top. You can also see more details about your schema by clicking the drop down arrow on its left:</p> <p><img alt=6 src=images/6-v10.png></p> <h4 id=cli_2>CLI<a class=headerlink href=#cli_2 title="Permanent link">&para;</a></h4> <ol> <li> <p>Execute the following command to list the schemas in your Schema Registry:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>cloudctl es schemas
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>Schema                 State    Latest version   Latest version ID   Updated
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>demoSchema_CLI_USER1   active   <span class=m>1</span>.0.0            <span class=m>1</span>                   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>13</span>:55:49 UTC
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>demoSchema_UI_USER1    active   <span class=m>1</span>.0.0            <span class=m>1</span>                   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>13</span>:55:51 UTC
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>OK
</code></pre></div> </li> </ol> <h3 id=delete-schemas>Delete schemas<a class=headerlink href=#delete-schemas title="Permanent link">&para;</a></h3> <h4 id=ui_3>UI<a class=headerlink href=#ui_3 title="Permanent link">&para;</a></h4> <ol> <li>Click on the schema you want to delete.</li> <li>Click on the <em>Manage schema</em> tab at the top.</li> <li> <p>Click on <em>Remove schema</em></p> <p><img alt=7 src=images/7-v10.png></p> </li> </ol> <h4 id=cli_3>CLI<a class=headerlink href=#cli_3 title="Permanent link">&para;</a></h4> <p>To remove a schema using the CLI, simply execute the following command and confirm:</p> <p><inlinenotification kind=warning></p> <p>Change USER1</p> <p></inlinenotification></p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>cloudctl es schema-remove demoSchema_CLI_USER1
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>Remove schema demoSchema_CLI_USER1 and all versions? <span class=o>[</span>y/n<span class=o>]</span>&gt; y
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>Schema demoSchema_CLI_USER1 and all versions removed.
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>OK
</code></pre></div> <h3 id=create-new-schema-version>Create new schema version<a class=headerlink href=#create-new-schema-version title="Permanent link">&para;</a></h3> <p>To create a new version of a schema,</p> <ol> <li> <p>Let's first create again the previous two schemas:</p> <p><inlinenotification kind=warning></p> <p>Change USER1</p> <p></inlinenotification></p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>cloudctl es schema-add --file demoshema-ui.avsc
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>Schema demoSchema_UI_USER1 is active.
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>Version   Version ID   Schema                State    Updated                         Comment
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=m>1</span>.0.0     <span class=m>1</span>            demoSchema_UI_USER1   active   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>13</span>:59:55 UTC
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>Added version <span class=m>1</span>.0.0 of schema demoSchema_UI_USER1 to the registry.
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>OK
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>cloudctl es schema-add --file demoshema-cli.avsc
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>Schema demoSchema_CLI_USER1 is active.
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>Version   Version ID   Schema                 State    Updated                         Comment
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=m>1</span>.0.0     <span class=m>1</span>            demoSchema_CLI_USER1   active   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>14</span>:00:45 UTC
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>Added version <span class=m>1</span>.0.0 of schema demoSchema_CLI_USER1 to the registry.
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>OK
</code></pre></div></p> </li> <li> <p>Add a new attribute to the schemas by editing their Avro schema avsc files:</p> <p><inlinenotification kind=warning></p> <p>Change USER1</p> <p></inlinenotification></p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>cat demoshema-ui.avsc
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=o>{</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=s2>&quot;type&quot;</span>:<span class=s2>&quot;record&quot;</span>,
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=s2>&quot;name&quot;</span>:<span class=s2>&quot;demoSchema_UI_USER1&quot;</span>,
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=s2>&quot;namespace&quot;</span>: <span class=s2>&quot;schemas.demo.ui&quot;</span>,
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=s2>&quot;fields&quot;</span>:<span class=o>[</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>    <span class=o>{</span><span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;eventKey&quot;</span>,<span class=s2>&quot;type&quot;</span>:<span class=s2>&quot;string&quot;</span><span class=o>}</span>,
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>    <span class=o>{</span><span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;message&quot;</span>,<span class=s2>&quot;type&quot;</span>:<span class=s2>&quot;string&quot;</span><span class=o>}</span>,
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>    <span class=o>{</span><span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;attribute1&quot;</span>,<span class=s2>&quot;type&quot;</span>:<span class=s2>&quot;string&quot;</span><span class=o>}]</span>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=o>}</span>
</code></pre></div> </li> </ol> <h4 id=ui_4>UI<a class=headerlink href=#ui_4 title="Permanent link">&para;</a></h4> <ol> <li>Click on the schema you want to create a new version for.</li> <li>Click on the <em>Add new version</em> button on the left hand side.</li> <li>Click on <em>Upload definition</em> button on the left hand side.</li> <li> <p>Select the Avro schema avsc file and click ok.</p> <p><img alt=8 src=images/8-v10.png></p> </li> </ol> <p><inlinenotification kind=error></p> <p><strong>ERROR:</strong> The error we are seeing on the screen is because the IBM Event Streams Schema Registtry enforces full compatibility: <a href=https://ibm.github.io/event-streams/schemas/creating/#adding-new-schema-versions>https://ibm.github.io/event-streams/schemas/creating/#adding-new-schema-versions</a></p> <p></inlinenotification></p> <p><strong>Full compatibility</strong> for data schemas means that messages that have been serialized with an earlier version of a schema can be deserialized with a later version. To be compatible, fields in later versions of a schema cannot be removed, and any new schema field must have a default value. More on data schema compatibility on the section <a href=#data-evolution>Data Evolution</a> towards the end of this lab.</p> <p>As explained in the error notification above, we need to add a default value for our new attribute in our data schema so that messages serialized with an older version of the data schema which won't contain this new attribute can later be deserialized with the newer version of the data schema that expects such attribute. By providing a default value, we allow deserializers to consume messages that do not contain newer attributes.</p> <ol> <li> <p>Add a default value for the new attribute:</p> <p><inlinenotification kind=warning></p> <p>Change USER1</p> <p></inlinenotification></p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>cat demoshema-ui.avsc
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=o>{</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=s2>&quot;type&quot;</span>:<span class=s2>&quot;record&quot;</span>,
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=s2>&quot;name&quot;</span>:<span class=s2>&quot;demoSchema_UI_USER1&quot;</span>,
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=s2>&quot;namespace&quot;</span>: <span class=s2>&quot;schemas.demo.ui&quot;</span>,
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=s2>&quot;fields&quot;</span>:<span class=o>[</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>    <span class=o>{</span><span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;eventKey&quot;</span>,<span class=s2>&quot;type&quot;</span>:<span class=s2>&quot;string&quot;</span><span class=o>}</span>,
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>    <span class=o>{</span><span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;message&quot;</span>,<span class=s2>&quot;type&quot;</span>:<span class=s2>&quot;string&quot;</span><span class=o>}</span>,
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>    <span class=o>{</span><span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;attribute1&quot;</span>,<span class=s2>&quot;type&quot;</span>:<span class=s2>&quot;string&quot;</span>,<span class=s2>&quot;default&quot;</span>: <span class=s2>&quot;whatever&quot;</span><span class=o>}]</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=o>}</span>
</code></pre></div> </li> <li> <p>Repeat the steps for adding a new version of a schema above.</p> </li> <li> <p>This time you should see that the schema is valid:</p> <p><img alt=9 src=images/9-v10.png></p> </li> <li> <p>However, it still does not let us add this new version to the data schema until we actually provide a version for it. Click on the <em>Add +</em> link on the right of the version attribute of the schema and give it <code>2.0.0</code> for example (hit enter for the version to take the value you type in).</p> </li> <li>Click on <em>Add schema</em>.</li> <li> <p>You should now see the two versions for your data schema on the left hand side.</p> <p><img alt=10 src=images/10-v10.png></p> </li> <li> <p>If you go back to the Schema Registry page where all your schemas are listed, you should now see that the latest version for your data schema is <code>2.0.0</code> now.</p> </li> </ol> <h4 id=cli_4>CLI<a class=headerlink href=#cli_4 title="Permanent link">&para;</a></h4> <ol> <li> <p>If we try to add the new version of the schema from its <code>demoschema-cli.avsc</code> Avro schema file, we will get the same error as in the previous UI example:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>cloudctl es schema-add --file demoshema-cli.avsc
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>FAILED
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>Event Streams API request failed:
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>Error response from server. Status code: <span class=m>400</span>. Avro schema is not compatible with latest schema version: Compatibility <span class=nb>type</span> <span class=s1>&#39;MUTUAL_READ&#39;</span> does not hold between <span class=m>1</span> schema<span class=o>(</span>s<span class=o>)</span> <span class=k>in</span> the chronology because: Schema<span class=o>[</span><span class=m>0</span><span class=o>]</span> has incompatibilities: <span class=o>[</span><span class=s1>&#39;READER_FIELD_MISSING_DEFAULT_VALUE: attribute1&#39;</span> at <span class=s1>&#39;/fields/2&#39;</span><span class=o>]</span>.
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>Unable to add version <span class=m>1</span>.0.0 of schema demoSchema_CLI_USER1 to the registry.
</code></pre></div> </li> <li> <p>Add the default value for the new attribute in your Avro schema avsc file and try to add that new version of the schema:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>cloudctl es schema-add --file demoshema-cli.avsc
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>FAILED
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>Event Streams API request failed:
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>Error response from server. Status code: <span class=m>409</span>. Schema version name already exists
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>Unable to add version <span class=m>1</span>.0.0 of schema demoSchema_CLI_USER1 to the registry.
</code></pre></div> </li> <li> <p>We see that we still have an error because we have not specified a new version value. Specify a new version value when adding this new version of the schema:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>cloudctl es schema-add --file demoshema-cli.avsc --version <span class=m>2</span>.0.0
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>Schema demoSchema_CLI_USER1 is active.
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>Version   Version ID   Schema                 State    Updated                         Comment
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=m>1</span>.0.0     <span class=m>1</span>            demoSchema_CLI_USER1   active   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>14</span>:00:45 UTC
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=m>2</span>.0.0     <span class=m>2</span>            demoSchema_CLI_USER1   active   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>14</span>:09:37 UTC
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>Added version <span class=m>2</span>.0.0 of schema demoSchema_CLI_USER1 to the registry.
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>OK
</code></pre></div> </li> </ol> <h3 id=get-latest-version-of-a-schema>Get latest version of a schema<a class=headerlink href=#get-latest-version-of-a-schema title="Permanent link">&para;</a></h3> <h4 id=ui_5>UI<a class=headerlink href=#ui_5 title="Permanent link">&para;</a></h4> <p>In order to see the latest version of a data schema using the UI, we just need to go to the Schema Registry web user interface and click on the expand arrow buttton that is on the left:</p> <p><img alt=11 src=images/11.png></p> <h4 id=cli_5>CLI<a class=headerlink href=#cli_5 title="Permanent link">&para;</a></h4> <p>In order to see the latest version of a data schema using the CLI, we simply need to run the following command:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>cloudctl es schema demoSchema_CLI_USER1 --version <span class=m>2</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=o>{</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>  <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;record&quot;</span>,
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>  <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;demoSchema_CLI_USER1&quot;</span>,
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>  <span class=s2>&quot;namespace&quot;</span>: <span class=s2>&quot;schemas.demo.cli&quot;</span>,
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>  <span class=s2>&quot;fields&quot;</span>: <span class=o>[</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>    <span class=o>{</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>      <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;eventKey&quot;</span>,
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>      <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;string&quot;</span>
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a>    <span class=o>}</span>,
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a>    <span class=o>{</span>
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a>      <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;message&quot;</span>,
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>      <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;string&quot;</span>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a>    <span class=o>}</span>,
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a>    <span class=o>{</span>
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a>      <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;attribute1&quot;</span>,
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a>      <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;string&quot;</span>,
<a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a>      <span class=s2>&quot;default&quot;</span>: <span class=s2>&quot;whatever&quot;</span>
<a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a>    <span class=o>}</span>
<a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a>  <span class=o>]</span>
<a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=o>}</span>
</code></pre></div> <p>(*) The version you specify is actually the version ID (2) rather than the version name we gave to the newer schema version (2.0.0):</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>cloudctl es schema demoSchema_CLI_USER1
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>Schema demoSchema_CLI_USER1 is active.
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>Version   Version ID   Schema                 State    Updated                         Comment
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=m>1</span>.0.0     <span class=m>1</span>            demoSchema_CLI_USER1   active   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>14</span>:00:45 UTC
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=m>2</span>.0.0     <span class=m>2</span>            demoSchema_CLI_USER1   active   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>14</span>:09:37 UTC
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>OK
</code></pre></div> <h3 id=get-specific-version-of-a-schema>Get specific version of a schema<a class=headerlink href=#get-specific-version-of-a-schema title="Permanent link">&para;</a></h3> <h4 id=ui_6>UI<a class=headerlink href=#ui_6 title="Permanent link">&para;</a></h4> <p>To see a specific version of a schema, go to the Schema Registry web user interface and click on the schema you want to see the version for. You will now see how many version of the schema you have and you can click on any of these in order to see more details about it.</p> <p><img alt=12 src=images/12-v10.png></p> <h4 id=cli_6>CLI<a class=headerlink href=#cli_6 title="Permanent link">&para;</a></h4> <p>To see a specific version of a schema using the CLI, simply run the following command with the version ID you would like to get retrieved:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>cloudctl es schema demoSchema_CLI_USER1 --version <span class=m>1</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=o>{</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>  <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;record&quot;</span>,
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>  <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;demoSchema_CLI_USER1&quot;</span>,
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>  <span class=s2>&quot;namespace&quot;</span>: <span class=s2>&quot;schemas.demo.cli&quot;</span>,
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a>  <span class=s2>&quot;fields&quot;</span>: <span class=o>[</span>
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a>    <span class=o>{</span>
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>      <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;eventKey&quot;</span>,
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>      <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;string&quot;</span>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a>    <span class=o>}</span>,
<a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>    <span class=o>{</span>
<a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a>      <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;message&quot;</span>,
<a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a>      <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;string&quot;</span>
<a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a>    <span class=o>}</span>
<a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a>  <span class=o>]</span>
<a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=o>}</span>
</code></pre></div> <h3 id=listing-all-versions-of-a-schema>Listing all versions of a schema<a class=headerlink href=#listing-all-versions-of-a-schema title="Permanent link">&para;</a></h3> <h4 id=ui_7>UI<a class=headerlink href=#ui_7 title="Permanent link">&para;</a></h4> <p>To list all versions of schema in the Schema Registry user interface, you simply need to click on the data schema you want and a new page will display these:</p> <p><img alt=12 src=images/12-v10.png></p> <h4 id=cli_7>CLI<a class=headerlink href=#cli_7 title="Permanent link">&para;</a></h4> <p>In order to display all versions of a schema, run the following command:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>cloudctl es schema demoSchema_CLI_USER1
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>Schema demoSchema_CLI_USER1 is active.
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>Version   Version ID   Schema                 State    Updated                         Comment
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=m>1</span>.0.0     <span class=m>1</span>            demoSchema_CLI_USER1   active   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>14</span>:00:45 UTC
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=m>2</span>.0.0     <span class=m>2</span>            demoSchema_CLI_USER1   active   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>14</span>:09:37 UTC
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>OK
</code></pre></div> <h3 id=deleting-a-version-of-a-schema>Deleting a version of a schema<a class=headerlink href=#deleting-a-version-of-a-schema title="Permanent link">&para;</a></h3> <h4 id=ui_8>UI<a class=headerlink href=#ui_8 title="Permanent link">&para;</a></h4> <p>In order to delete a version of a schema using the Schema Registry user interface,</p> <ol> <li>Click on the data schema you want a version of it deleted for.</li> <li>Select the version you want to delete on the left hand side.</li> <li>Click on <em>Manage version</em> button that is on the top right corner within the main box in the center of the page.</li> <li> <p>Click on <em>Remove version</em>.</p> <p><img alt=13 src=images/13-v10.png></p> </li> </ol> <h4 id=cli_8>CLI<a class=headerlink href=#cli_8 title="Permanent link">&para;</a></h4> <p>In order to delete a version of a schema through the CLI, execute the following command:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>cloudctl es schema-remove demoSchema_CLI_USER1 --version <span class=m>1</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>Remove version with ID <span class=m>1</span> of schema demoSchema_CLI_USER1? <span class=o>[</span>y/n<span class=o>]</span>&gt; y
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>Version with ID <span class=m>1</span> of schema demoSchema_CLI_USER1 removed.
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>OK
</code></pre></div> <p>We can see only version 2 now:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>cloudctl es schema demoSchema_CLI_USER1
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>Schema demoSchema_CLI_USER1 is active.
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>Version   Version ID   Schema                 State    Updated                         Comment
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=m>2</span>.0.0     <span class=m>2</span>            demoSchema_CLI_USER1   active   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>14</span>:09:37 UTC
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a>OK
</code></pre></div> <h2 id=ibm-event-streams-credentials>IBM Event Streams Credentials<a class=headerlink href=#ibm-event-streams-credentials title="Permanent link">&para;</a></h2> <p>We have seen how to interact with the IBM Event Streams Schema Registry in order to create, delete, update, etc schemas that our applications will theoretically used for data correctness and application robusteness. However, the first thing that we need to set up in our IBM Event Streams instance are these applications' <strong>service credentials</strong> to be able to interact with IBM Event Streams and its Schema Registry. For doing so, we can either use either the GUI or the CLI.</p> <h3 id=gui>GUI<a class=headerlink href=#gui title="Permanent link">&para;</a></h3> <ol> <li> <p>Go to you IBM Event Streams instance console</p> <p><img alt=1 src=images/1.png></p> </li> <li> <p>Click on <strong>Connect to this cluster</strong></p> <p><img alt=2 src=images/2.png></p> </li> </ol> <p>In this panel, you will find</p> <ol> <li>The <strong>Botstrap server</strong> to connect your applications to in order to send and receive messages from your IBM Event Streams instance. We can see we have one <strong>external listener</strong> (whith SCRAM-SHA authentication) and one internal listener (Depending your IBM Event Streams installation you might have different listeners and authentications for these).</li> <li>The <strong>Schema Registry url</strong> your applications will need to work with Apache Avro data schemas.</li> <li>A <em>Generate SCRAM credentials</em> button to generate the <strong>SCRAM credentials</strong> your applications will need to authenticate with.</li> <li> <p>A <em>Certificates</em> section to download either the <strong>Java PKCS12</strong> or the <strong>PEM</strong> certificates (or both) that your applications will need in order to be able to establish the communitaction with your IBM Event Streams instance.</p> <p><img alt=3 src=images/3-v10.png></p> </li> </ol> <p>To generate the SCRAM credentials needed by your application to get authenticated against IBM Event Streams to be able to produce and consume messages as well as to create, delete, etc topics and schemas, we need to create a <strong>KafkaUser</strong> (this happens behind the scenes) which we will set some permissions and get the corresponding SCRAM usernname and password for to be used in our applications kafka clients configuration:</p> <ol> <li>Click on <em>Generate SCRAM credentials</em></li> <li> <p>Enter a user name for your credentials and click next (leave the last option selected: <em>Produce messages, consume messages and create topics and schemas</em> so that we give full access to our user for simplicity)</p> <p><img alt=scram1 src=images/scram-1-v10.png></p> </li> <li> <p>Select all topics and click next</p> <p><img alt=scram2 src=images/scram-2-v10.png></p> </li> <li> <p>Select all consumer groups and click next</p> <p><img alt=scram3 src=images/scram-3-v10.png></p> </li> <li> <p>Select all transactional IDs and click next</p> <p><img alt=scram4 src=images/scram-4-v10.png></p> </li> </ol> <p>Once you have created your new KafkaUser, you get the SCRAM credentials displayed on the screen:</p> <p><img alt=scram5 src=images/scram-5-v10.png></p> <p><inlinenotification kind=info></p> <p>You can download the PEM certificate from the UI and then use the IBM Cloud Shell upload file option on the top bar or you can download it from within your IBM Cloud Shell by using the CLI (see below)</p> <p></inlinenotification></p> <h3 id=cli_9>CLI<a class=headerlink href=#cli_9 title="Permanent link">&para;</a></h3> <p><inlinenotification kind=info></p> <p>The following two steps should have been completed already in the previous <a href=#accessing-the-schema-registry>Accessing the Schema Registry</a> section</p> <p></inlinenotification></p> <ol> <li> <p>Log into your cluster with the IBM CloudPak CLI</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>cloudctl login -a https://cp-console.apps.eda-solutions.gse-ocp.net --skip-ssl-validation
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>Username&gt; admin
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>Password&gt;
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>Authenticating...
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>OK
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>
<a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>Targeted account mycluster Account
<a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>
<a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>Enter a namespace &gt; integration
<a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>Targeted namespace integration
<a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a>
<a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a>Configuring kubectl ...
<a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a>Property <span class=s2>&quot;clusters.mycluster&quot;</span> unset.
<a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a>Property <span class=s2>&quot;users.mycluster-user&quot;</span> unset.
<a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a>Property <span class=s2>&quot;contexts.mycluster-context&quot;</span> unset.
<a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a>Cluster <span class=s2>&quot;mycluster&quot;</span> set.
<a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a>User <span class=s2>&quot;mycluster-user&quot;</span> set.
<a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a>Context <span class=s2>&quot;mycluster-context&quot;</span> created.
<a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a>Switched to context <span class=s2>&quot;mycluster-context&quot;</span>.
<a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a>OK
<a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a>
<a id=__codelineno-21-24 name=__codelineno-21-24 href=#__codelineno-21-24></a>Configuring helm: /Users/jesusalmaraz/.helm
<a id=__codelineno-21-25 name=__codelineno-21-25 href=#__codelineno-21-25></a>OK
</code></pre></div> </li> <li> <p>Initialize the Event Streams CLI plugin</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>cloudctl es init
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>IBM Cloud Platform Common Services endpoint:   https://cp-console.apps.eda-solutions.gse-ocp.net
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>Namespace:                                     integration
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>Name:                                          es-1
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>IBM Cloud Pak <span class=k>for</span> Integration UI address:      No instance of Cloud Pak <span class=k>for</span> Integration has been found. Please check that you have access to it.
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>Event Streams API endpoint:                    https://es-1-ibm-es-admapi-external-integration.apps.eda-solutions.gse-ocp.net
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>Event Streams API status:                      OK
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>Event Streams UI address:                      https://es-1-ibm-es-ui-integration.apps.eda-solutions.gse-ocp.net
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>Event Streams Schema Registry endpoint:        https://es-1-ibm-es-schema-external-integration.apps.eda-solutions.gse-ocp.net
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>Event Streams bootstrap address:               es-1-kafka-bootstrap-integration.apps.eda-solutions.gse-ocp.net:443
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>OK
</code></pre></div> </li> </ol> <p>We can see above the Event Streams <strong>bootstrap address</strong> and <strong>Schema Registry url</strong> that our applications will need in order to connect to this Event Streams instance</p> <p>To be able to establish communication and authenticate against your IBM Event Streams instance, you will need the PEM certificate and an the SCRAM credentials:</p> <ol> <li> <p>To download your <strong>PEM certificate</strong>, you can use the following command:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>cloudctl es certificates --format pem
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>Certificate successfully written to /home/ALMARAZJ/es-cert.pem.
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>OK
</code></pre></div> </li> <li> <p>To generate your SCRAM credentials, we first need to create a <strong>KafkaUser</strong>, you can use the following command:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>cloudctl es kafka-user-create --name my-user1 --consumer --producer --schema-topic-create --all-topics --all-groups --all-txnids --auth-type scram-sha-512
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>KafkaUser name   Authentication   Authorization   Username                                                Secret
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>my-user1         scram-sha-512    simple          EntityOperator has not created corresponding username   EntityOperator has not created corresponding secret
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>Resource <span class=nb>type</span>     Name        Pattern <span class=nb>type</span>   Host   Operation
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a>topic             *           literal        *      Read
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>topic             __schema_   prefix         *      Read
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>topic             *           literal        *      Write
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>topic             *           literal        *      Create
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a>topic             __schema_   prefix         *      Alter
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>group             *           literal        *      Read
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a>transactionalId   *           literal        *      Write
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a>
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a>Created KafkaUser my-user1.
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a>OK
</code></pre></div> </li> </ol> <p><inlinenotification kind=warning></p> <p>We recommend to carefully set appropriate roles as well as access to topics, groups, transaction IDs and schemas for the API keys that you generate.</p> <p></inlinenotification></p> <p>When a KafkaUser custom resource is created, the Entity Operator within Event Streams will create the principal in ZooKeeper with appropriate ACL entries. It will also create a Kubernetes Secret that contains the Base64-encoded SCRAM password for the scram-sha-512 authentication type, or the Base64-encoded certificates and keys for the tls authentication type.</p> <ol> <li> <p>Retrieve the username and the secret name containing the password of your SCRAM credentials for your KafkaUser:</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>oc get kafkauser my-user1 --namespace integration -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{&quot;username: &quot;}{.status.username}{&quot;\nsecret-name: &quot;}{.status.secret}{&quot;\n&quot;}&#39;</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>username: my-user1
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>secret-name: my-user1
</code></pre></div> 1. Retrieve the password of your SCRAM credentials from the secret above:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>oc get secret my-user1 --namespace integration -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.data.password}&#39;</span> <span class=p>|</span> base64 --decode
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>*****
</code></pre></div> </li> </ol> <h3 id=environment-variables>Environment variables<a class=headerlink href=#environment-variables title="Permanent link">&para;</a></h3> <p>Now that we have generated the appropriate IBM Event Streams credentials for applications to be able to establish communication and authenticate against our IBM Event Streams instance, we are going to set some environment variables that will be used by our Python application:</p> <ol> <li> <p><strong>KAFKA_BROKERS</strong> which should take the value of <strong>bootstrap server</strong>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=nb>export</span> <span class=nv>KAFKA_BROKERS</span><span class=o>=</span>es-1-kafka-bootstrap-integration.apps.eda-solutions.gse-ocp.net:443
</code></pre></div> </li> <li> <p><strong>SCRAM_USERNAME</strong> which should take the value of the <strong>SCRAM username</strong> you have generated:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=nb>export</span> <span class=nv>SCRAM_USERNAME</span><span class=o>=</span>my-user1
</code></pre></div> </li> <li> <p><strong>SCRAM_PASSWORD</strong> which should take the value of the <strong>SCRAM password</strong> you have generated:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=nb>export</span> <span class=nv>SCRAM_PASSWORD</span><span class=o>=</span>*****
</code></pre></div> </li> <li> <p><strong>PEM_CERT</strong> which should take the value of the location where the PEM certificate is within your IBM Cloud Shell:</p> <p><inlinenotification kind=warning></p> <p>Set the path appropriately to your IBM Cloud Shell</p> <p></inlinenotification></p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=nb>export</span> <span class=nv>PEM_CERT</span><span class=o>=</span>~/es-cert.pem
</code></pre></div> <p>(*) Don't forget to download both the PEM certificate to your IBM Cloud Shell through the CLI or upload it to your IBM Cloud Shell from your laptop if you used the UI to get the certificate. Review previous section if needed.</p> </li> <li> <p><strong>SCHEMA_REGISTRY_URL</strong> which should be a combination of the <strong>SCRAM username</strong>, the <strong>SCRAM password</strong> and the <strong>Schema Registry url</strong> in the form of:</p> <p><code>https://&lt;SCRAM_username&gt;:&lt;SCRAM_password&gt;@&lt;Schema_Registry_url&gt;</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=nb>export</span> <span class=nv>SCHEMA_REGISTRY_URL</span><span class=o>=</span>https://<span class=si>${</span><span class=nv>SCRAM_USERNAME</span><span class=si>}</span>:<span class=si>${</span><span class=nv>SCRAM_PASSWORD</span><span class=si>}</span>@es-1-ibm-es-schema-external-integration.apps.eda-solutions.gse-ocp.net
</code></pre></div> </li> </ol> <h2 id=python-application>Python Application<a class=headerlink href=#python-application title="Permanent link">&para;</a></h2> <p>The Python application we have built to see how to produce and consume messages (either plain messages or Avro encoded messages based on Avro Data Schemas) to and from an IBM Event Streams instance installed through the IBM Cloud Pak for Integration is public at the following GitHub repo: <a href=https://github.com/ibm-cloud-architecture/refarch-eda-tools/tree/master/labs/es-cp4i-schema-lab-v10>https://github.com/ibm-cloud-architecture/refarch-eda-tools/tree/master/labs/es-cp4i-schema-lab-v10</a></p> <h3 id=clone>Clone<a class=headerlink href=#clone title="Permanent link">&para;</a></h3> <p>In order to use and work with this Python application, the first thing we need to do is to clone the GitHub repository where it is published.</p> <ol> <li> <p>Clone the github repository on your workstation on the location of your choice:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a>git clone https://github.com/ibm-cloud-architecture/refarch-eda-tools.git
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>Cloning into <span class=s1>&#39;refarch-eda-tools&#39;</span>...
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a>remote: Enumerating objects: <span class=m>185</span>, <span class=k>done</span>.
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a>remote: Counting objects: <span class=m>100</span>% <span class=o>(</span><span class=m>185</span>/185<span class=o>)</span>, <span class=k>done</span>.
<a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a>remote: Compressing objects: <span class=m>100</span>% <span class=o>(</span><span class=m>148</span>/148<span class=o>)</span>, <span class=k>done</span>.
<a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a>remote: Total <span class=m>185</span> <span class=o>(</span>delta <span class=m>23</span><span class=o>)</span>, reused <span class=m>176</span> <span class=o>(</span>delta <span class=m>16</span><span class=o>)</span>, pack-reused <span class=m>0</span>
<a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a>Receiving objects: <span class=m>100</span>% <span class=o>(</span><span class=m>185</span>/185<span class=o>)</span>, <span class=m>6</span>.17 MiB <span class=p>|</span> <span class=m>4</span>.61 MiB/s, <span class=k>done</span>.
<a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a>Resolving deltas: <span class=m>100</span>% <span class=o>(</span><span class=m>23</span>/23<span class=o>)</span>, <span class=k>done</span>.
</code></pre></div> </li> <li> <p>Change directory into <code>refarch-eda-tools/labs/es-cp4i-schema-lab-v10</code> to find the assets we will we working from now on for the python demo environment and few other scripts/applications:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=nb>cd</span> refarch-eda-tools/labs/es-cp4i-schema-lab-v10
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>$ ls -all
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a>total <span class=m>240</span>
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a>drwxr-xr-x   <span class=m>9</span> user  staff     <span class=m>288</span> <span class=m>20</span> May <span class=m>19</span>:33 .
<a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a>drwxr-xr-x   <span class=m>3</span> user  staff      <span class=m>96</span> <span class=m>20</span> May <span class=m>19</span>:33 ..
<a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a>-rw-r--r--   <span class=m>1</span> user  staff  <span class=m>112578</span> <span class=m>20</span> May <span class=m>19</span>:33 README.md
<a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a>drwxr-xr-x   <span class=m>5</span> user  staff     <span class=m>160</span> <span class=m>20</span> May <span class=m>19</span>:33 avro_files
<a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a>drwxr-xr-x   <span class=m>6</span> user  staff     <span class=m>192</span> <span class=m>20</span> May <span class=m>19</span>:33 kafka
<a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a>drwxr-xr-x   <span class=m>6</span> user  staff     <span class=m>192</span> <span class=m>20</span> May <span class=m>19</span>:33 src
</code></pre></div> </li> </ol> <p>In the next sections, we are going to briefly explain the implementation of this Python application so that you understand what is being done behind the scenes and more importantly, if you are a developer, how to do so.</p> <h2 id=python-avro-producer>Python Avro Producer<a class=headerlink href=#python-avro-producer title="Permanent link">&para;</a></h2> <p>In this section we describe the Python scripts we will be using in order to be able to produce <strong>avro</strong> messages to a Kafka topic.</p> <h3 id=produce-message>Produce Message<a class=headerlink href=#produce-message title="Permanent link">&para;</a></h3> <p>The python script that we will use to send an avro message to a Kafka topic is <a href=https://github.com/ibm-cloud-architecture/refarch-eda-tools/tree/master/labs/es-cloud-schema-lab-v10/src/ProduceAvroMessage.py>ProduceAvroMessage.py</a> where we have the following:</p> <ol> <li> <p>A function to parse the arguments:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=k>def</span> <span class=nf>parseArguments</span><span class=p>():</span>
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>    <span class=k>global</span> <span class=n>TOPIC_NAME</span>
<a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;The arguments for this script are: &quot;</span> <span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>))</span>
<a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
<a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a>        <span class=n>TOPIC_NAME</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
<a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;[ERROR] - The produceAvroMessage.py script expects one argument: The Kafka topic to publish the message to&quot;</span><span class=p>)</span>
<a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div> </li> <li> <p>A function to create the event to be sent:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=k>def</span> <span class=nf>createEvent</span><span class=p>():</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Creating event...&#39;</span><span class=p>)</span>
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a>
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a>    <span class=n>key</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;key&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}</span>
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a>    <span class=n>value</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;message&quot;</span> <span class=p>:</span> <span class=s2>&quot;This is a test message&quot;</span><span class=p>}</span>
<a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a>
<a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;DONE&quot;</span><span class=p>)</span>
<a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a>
<a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a>    <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>value</span><span class=p>),</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</code></pre></div> </li> <li> <p>The main where we will:</p> <ol> <li>Parse the arguments</li> <li>Get the Avro schemas for the key and value of the event</li> <li>Create the Event to be sent</li> <li>Print it out for reference</li> <li>Create the Kafka Avro Producer and configure it</li> <li>Send the event</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>    <span class=c1># Get the Kafka topic name</span>
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>    <span class=n>parseArguments</span><span class=p>()</span>
<a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>    <span class=c1># Get the avro schemas for the message&#39;s key and value</span>
<a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a>    <span class=n>event_value_schema</span> <span class=o>=</span> <span class=n>getDefaultEventValueSchema</span><span class=p>(</span><span class=n>DATA_SCHEMAS</span><span class=p>)</span>
<a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>    <span class=n>event_key_schema</span> <span class=o>=</span> <span class=n>getDefaultEventKeySchema</span><span class=p>(</span><span class=n>DATA_SCHEMAS</span><span class=p>)</span>
<a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a>    <span class=c1># Create the event</span>
<a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a>    <span class=n>event_value</span><span class=p>,</span> <span class=n>event_key</span> <span class=o>=</span> <span class=n>createEvent</span><span class=p>()</span>
<a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a>    <span class=c1># Print out the event to be sent</span>
<a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;--- Event to be published: ---&quot;</span><span class=p>)</span>
<a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a>    <span class=nb>print</span><span class=p>(</span><span class=n>event_key</span><span class=p>)</span>
<a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a>    <span class=nb>print</span><span class=p>(</span><span class=n>event_value</span><span class=p>)</span>
<a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;----------------------------------------&quot;</span><span class=p>)</span>
<a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a>    <span class=c1># Create the Kafka Avro Producer</span>
<a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a>    <span class=n>kafka_producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span><span class=n>KAFKA_BROKERS</span><span class=p>,</span><span class=n>SCRAM_USERNAME</span><span class=p>,</span><span class=n>SCRAM_PASSWORD</span><span class=p>,</span><span class=n>SCHEMA_REGISTRY_URL</span><span class=p>)</span>
<a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a>    <span class=c1># Prepare the Kafka Avro Producer</span>
<a id=__codelineno-36-17 name=__codelineno-36-17 href=#__codelineno-36-17></a>    <span class=n>kafka_producer</span><span class=o>.</span><span class=n>prepareProducer</span><span class=p>(</span><span class=s2>&quot;ProduceAvroMessagePython&quot;</span><span class=p>,</span><span class=n>event_key_schema</span><span class=p>,</span><span class=n>event_value_schema</span><span class=p>)</span>
<a id=__codelineno-36-18 name=__codelineno-36-18 href=#__codelineno-36-18></a>    <span class=c1># Publish the event</span>
<a id=__codelineno-36-19 name=__codelineno-36-19 href=#__codelineno-36-19></a>    <span class=n>kafka_producer</span><span class=o>.</span><span class=n>publishEvent</span><span class=p>(</span><span class=n>TOPIC_NAME</span><span class=p>,</span><span class=n>event_value</span><span class=p>,</span><span class=n>event_key</span><span class=p>)</span>
</code></pre></div> </li> </ol> <p>As you can see, this python code depends on an <strong>Avro Utils</strong> for loading the Avro schemas and a <strong>Kafka Avro Producer</strong> to send the messages. These are explained next.</p> <h3 id=avro-utils>Avro Utils<a class=headerlink href=#avro-utils title="Permanent link">&para;</a></h3> <p>This script, called <a href=https://github.com/ibm-cloud-architecture/refarch-eda-tools/tree/master/labs/es-cloud-schema-lab-v10/avro_files/utils/avroEDAUtils.py>avroEDAUtils.py</a>, contains some very simple utility functions to be able to load Avro schemas from their <strong>avsc</strong> files in order to be used by the Kafka Avro Producer.</p> <ol> <li> <p>A function to get the key and value Avro schemas for the messages to be sent:</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=k>def</span> <span class=nf>getDefaultEventValueSchema</span><span class=p>(</span><span class=n>schema_files_location</span><span class=p>):</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=c1># Get the default event value data schema</span>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=n>known_schemas</span> <span class=o>=</span> <span class=n>avro</span><span class=o>.</span><span class=n>schema</span><span class=o>.</span><span class=n>Names</span><span class=p>()</span>
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=n>default_event_value_schema</span> <span class=o>=</span> <span class=n>LoadAvsc</span><span class=p>(</span><span class=n>schema_files_location</span> <span class=o>+</span> <span class=s2>&quot;/default_value.avsc&quot;</span><span class=p>,</span> <span class=n>known_schemas</span><span class=p>)</span>
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=k>return</span> <span class=n>default_event_value_schema</span>
<a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a>
<a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=k>def</span> <span class=nf>getDefaultEventKeySchema</span><span class=p>(</span><span class=n>schema_files_location</span><span class=p>):</span>
<a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=c1># Get the default event key data schema</span>
<a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class=n>known_schemas</span> <span class=o>=</span> <span class=n>avro</span><span class=o>.</span><span class=n>schema</span><span class=o>.</span><span class=n>Names</span><span class=p>()</span>
<a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a><span class=n>default_event_key_schema</span> <span class=o>=</span> <span class=n>LoadAvsc</span><span class=p>(</span><span class=n>schema_files_location</span> <span class=o>+</span> <span class=s2>&quot;/default_key.avsc&quot;</span><span class=p>,</span> <span class=n>known_schemas</span><span class=p>)</span>
<a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a><span class=k>return</span> <span class=n>default_event_key_schema</span>
</code></pre></div> (*) Where <code>known_schemas</code> is an Avro schema dictionary where all Avro schemas read get stored in order to be able to read nested Avro schemas afterwards. See the python script in detail for examples of this.</p> </li> <li> <p>A function to open a file, read its content as an Avro schema and store it in the Avro schema dictionary:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=k>def</span> <span class=nf>LoadAvsc</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>names</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=c1># Load avsc file</span>
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=c1># file_path: path to schema file</span>
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=c1># names(optional): avro.schema.Names object</span>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=n>file_text</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=n>json_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>file_text</span><span class=p>)</span>
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=n>schema</span> <span class=o>=</span> <span class=n>avro</span><span class=o>.</span><span class=n>schema</span><span class=o>.</span><span class=n>SchemaFromJSONData</span><span class=p>(</span><span class=n>json_data</span><span class=p>,</span> <span class=n>names</span><span class=p>)</span>
<a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=k>return</span> <span class=n>schema</span>
</code></pre></div> </li> </ol> <h3 id=kafka-avro-producer>Kafka Avro Producer<a class=headerlink href=#kafka-avro-producer title="Permanent link">&para;</a></h3> <p>This script, called <a href=https://github.com/ibm-cloud-architecture/refarch-eda-tools/tree/master/labs/es-cloud-schema-lab-v10/kafka/KcAvroProducer.py>KcAvroProducer.py</a>, will actually be the responsible for creating the Kafka Avro Producer, initialize and configure it and provide the publish method:</p> <ol> <li> <p>Initialize and prepare the Kafka Producer</p> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=k>class</span> <span class=nc>KafkaProducer</span><span class=p>:</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>kafka_brokers</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span><span class=n>scram_username</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span><span class=n>scram_password</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span><span class=n>schema_registry_url</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>):</span>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>kafka_brokers</span> <span class=o>=</span> <span class=n>kafka_brokers</span>
<a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>scram_username</span> <span class=o>=</span> <span class=n>scram_username</span>
<a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a>        <span class=bp>self</span><span class=o>.</span><span class=n>scram_password</span> <span class=o>=</span> <span class=n>scram_password</span>
<a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a>        <span class=bp>self</span><span class=o>.</span><span class=n>schema_registry_url</span> <span class=o>=</span> <span class=n>schema_registry_url</span>
<a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a>
<a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a>    <span class=k>def</span> <span class=nf>prepareProducer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>groupID</span> <span class=o>=</span> <span class=s2>&quot;pythonproducers&quot;</span><span class=p>,</span><span class=n>key_schema</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>value_schema</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>):</span>
<a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a>        <span class=n>options</span> <span class=o>=</span><span class=p>{</span>
<a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a>                <span class=s1>&#39;bootstrap.servers&#39;</span><span class=p>:</span>  <span class=bp>self</span><span class=o>.</span><span class=n>kafka_brokers</span><span class=p>,</span>
<a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a>                <span class=s1>&#39;schema.registry.url&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>schema_registry_url</span><span class=p>,</span>
<a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a>                <span class=s1>&#39;group.id&#39;</span><span class=p>:</span> <span class=n>groupID</span><span class=p>,</span>
<a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a>                <span class=s1>&#39;security.protocol&#39;</span><span class=p>:</span> <span class=s1>&#39;SASL_SSL&#39;</span><span class=p>,</span>
<a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a>                <span class=s1>&#39;sasl.mechanisms&#39;</span><span class=p>:</span> <span class=s1>&#39;SCRAM-SHA-512&#39;</span><span class=p>,</span>
<a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a>                <span class=s1>&#39;sasl.username&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>scram_username</span><span class=p>,</span>
<a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a>                <span class=s1>&#39;sasl.password&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>scram_password</span><span class=p>,</span>
<a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a>                <span class=s1>&#39;ssl.ca.location&#39;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;PEM_CERT&#39;</span><span class=p>],</span>
<a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a>                <span class=s1>&#39;schema.registry.ssl.ca.location&#39;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;PEM_CERT&#39;</span><span class=p>]</span>
<a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a>        <span class=p>}</span>
<a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a>        <span class=c1># Print out the configuration</span>
<a id=__codelineno-39-22 name=__codelineno-39-22 href=#__codelineno-39-22></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;--- This is the configuration for the avro producer: ---&quot;</span><span class=p>)</span>
<a id=__codelineno-39-23 name=__codelineno-39-23 href=#__codelineno-39-23></a>        <span class=nb>print</span><span class=p>(</span><span class=n>options</span><span class=p>)</span>
<a id=__codelineno-39-24 name=__codelineno-39-24 href=#__codelineno-39-24></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;---------------------------------------------------&quot;</span><span class=p>)</span>
<a id=__codelineno-39-25 name=__codelineno-39-25 href=#__codelineno-39-25></a>        <span class=c1># Create the Avro Producer</span>
<a id=__codelineno-39-26 name=__codelineno-39-26 href=#__codelineno-39-26></a>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=o>=</span> <span class=n>AvroProducer</span><span class=p>(</span><span class=n>options</span><span class=p>,</span><span class=n>default_key_schema</span><span class=o>=</span><span class=n>key_schema</span><span class=p>,</span><span class=n>default_value_schema</span><span class=o>=</span><span class=n>value_schema</span><span class=p>)</span>
</code></pre></div> </li> <li> <p>Publish method</p> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=k>def</span> <span class=nf>publishEvent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topicName</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a>    <span class=c1># Produce the Avro message</span>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>    <span class=c1># Important: value DOES NOT come in JSON format from ContainerAvroProducer.py. Therefore, we must convert it to JSON format first</span>
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a>    <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>produce</span><span class=p>(</span><span class=n>topic</span><span class=o>=</span><span class=n>topicName</span><span class=p>,</span><span class=n>value</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>value</span><span class=p>),</span><span class=n>key</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>value</span><span class=p>)[</span><span class=n>key</span><span class=p>],</span> <span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>delivery_report</span><span class=p>)</span>
<a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a>    <span class=c1># Flush</span>
<a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a>    <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</code></pre></div> </li> </ol> <h2 id=python-avro-consumer>Python Avro Consumer<a class=headerlink href=#python-avro-consumer title="Permanent link">&para;</a></h2> <p>In this section we describe the python scripts we will be using in order to be able to consume Avro messages from a Kafka topic.</p> <h3 id=consume-message>Consume Message<a class=headerlink href=#consume-message title="Permanent link">&para;</a></h3> <p>The python script that we will use to consume an Avro message from a Kafka topic is <a href=https://github.com/ibm-cloud-architecture/refarch-eda-tools/tree/master/labs/es-cloud-schema-lab-v10/src/ConsumeAvroMessage.py>ConsumeAvroMessage.py</a> where we have the following:</p> <ol> <li> <p>A function to parse arguments:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=c1># Parse arguments to get the container ID to poll for</span>
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=k>def</span> <span class=nf>parseArguments</span><span class=p>():</span>
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a>    <span class=k>global</span> <span class=n>TOPIC_NAME</span>
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;The arguments for the script are: &quot;</span> <span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>))</span>
<a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>2</span><span class=p>:</span>
<a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;[ERROR] - The ConsumeAvroMessage.py script expects one arguments: The Kafka topic to events from.&quot;</span><span class=p>)</span>
<a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
<a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a>    <span class=n>TOPIC_NAME</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</code></pre></div> </li> <li> <p>The main where we will:</p> <ol> <li>Parse the arguments to get the topic to read from</li> <li>Create the Kafka Consumer and configure it</li> <li>Poll for next avro message</li> <li>Close the Kafka consumer</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>    <span class=c1># Parse arguments</span>
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a>    <span class=n>parseArguments</span><span class=p>()</span>
<a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a>    <span class=c1># Create the Kafka Avro consumer</span>
<a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a>    <span class=n>kafka_consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span><span class=n>KAFKA_BROKERS</span><span class=p>,</span><span class=n>SCRAM_USERNAME</span><span class=p>,</span><span class=n>SCRAM_PASSWORD</span><span class=p>,</span><span class=n>TOPIC_NAME</span><span class=p>,</span><span class=n>SCHEMA_REGISTRY_URL</span><span class=p>)</span>
<a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a>    <span class=c1># Prepare the consumer</span>
<a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a>    <span class=n>kafka_consumer</span><span class=o>.</span><span class=n>prepareConsumer</span><span class=p>()</span>
<a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a>    <span class=c1># Consume next Avro event</span>
<a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a>    <span class=n>kafka_consumer</span><span class=o>.</span><span class=n>pollNextEvent</span><span class=p>()</span>
<a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a>    <span class=c1># Close the Avro consumer</span>
<a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a>    <span class=n>kafka_consumer</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</code></pre></div> </li> </ol> <p>As you can see, this python code depends on a <strong>Kafka Avro Consumer</strong> to consume messages. This is explained next.</p> <h3 id=kafka-avro-consumer>Kafka Avro Consumer<a class=headerlink href=#kafka-avro-consumer title="Permanent link">&para;</a></h3> <p>This script, called <a href=https://github.com/ibm-cloud-architecture/refarch-eda-tools/tree/master/labs/es-cloud-schema-lab/kafka/KcAvroConsumer.py>KcAvroConsumer.py</a>, will actually be the responsible for creating the Kafka Avro Consumer, initialize and configure it and provide the poll next event method:</p> <ol> <li> <p>Initialize and prepare the new Kafka consumer:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=k>class</span> <span class=nc>KafkaConsumer</span><span class=p>:</span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>kafka_brokers</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>scram_username</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span><span class=n>scram_password</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>topic_name</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>schema_registry_url</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>autocommit</span> <span class=o>=</span> <span class=kc>True</span><span class=p>):</span>
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>kafka_brokers</span> <span class=o>=</span> <span class=n>kafka_brokers</span>
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>scram_username</span> <span class=o>=</span> <span class=n>scram_username</span>
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a>        <span class=bp>self</span><span class=o>.</span><span class=n>scram_password</span> <span class=o>=</span> <span class=n>scram_password</span>
<a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a>        <span class=bp>self</span><span class=o>.</span><span class=n>topic_name</span> <span class=o>=</span> <span class=n>topic_name</span>
<a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a>        <span class=bp>self</span><span class=o>.</span><span class=n>schema_registry_url</span> <span class=o>=</span> <span class=n>schema_registry_url</span>
<a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a>        <span class=bp>self</span><span class=o>.</span><span class=n>kafka_auto_commit</span> <span class=o>=</span> <span class=n>autocommit</span>
<a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a>
<a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a>    <span class=c1># See https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md</span>
<a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a>    <span class=k>def</span> <span class=nf>prepareConsumer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>groupID</span> <span class=o>=</span> <span class=s2>&quot;pythonconsumers&quot;</span><span class=p>):</span>
<a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a>        <span class=n>options</span> <span class=o>=</span><span class=p>{</span>
<a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a>            <span class=s1>&#39;bootstrap.servers&#39;</span><span class=p>:</span>  <span class=bp>self</span><span class=o>.</span><span class=n>kafka_brokers</span><span class=p>,</span>
<a id=__codelineno-43-15 name=__codelineno-43-15 href=#__codelineno-43-15></a>            <span class=s1>&#39;group.id&#39;</span><span class=p>:</span> <span class=n>groupID</span><span class=p>,</span>
<a id=__codelineno-43-16 name=__codelineno-43-16 href=#__codelineno-43-16></a>            <span class=s1>&#39;auto.offset.reset&#39;</span><span class=p>:</span> <span class=s1>&#39;earliest&#39;</span><span class=p>,</span>
<a id=__codelineno-43-17 name=__codelineno-43-17 href=#__codelineno-43-17></a>            <span class=s1>&#39;schema.registry.url&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>schema_registry_url</span><span class=p>,</span>
<a id=__codelineno-43-18 name=__codelineno-43-18 href=#__codelineno-43-18></a>            <span class=s1>&#39;enable.auto.commit&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>kafka_auto_commit</span><span class=p>,</span>
<a id=__codelineno-43-19 name=__codelineno-43-19 href=#__codelineno-43-19></a>            <span class=s1>&#39;security.protocol&#39;</span><span class=p>:</span> <span class=s1>&#39;SASL_SSL&#39;</span><span class=p>,</span>
<a id=__codelineno-43-20 name=__codelineno-43-20 href=#__codelineno-43-20></a>            <span class=s1>&#39;sasl.mechanisms&#39;</span><span class=p>:</span> <span class=s1>&#39;SCRAM-SHA-512&#39;</span><span class=p>,</span>
<a id=__codelineno-43-21 name=__codelineno-43-21 href=#__codelineno-43-21></a>            <span class=s1>&#39;sasl.username&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>scram_username</span><span class=p>,</span>
<a id=__codelineno-43-22 name=__codelineno-43-22 href=#__codelineno-43-22></a>            <span class=s1>&#39;sasl.password&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>scram_password</span><span class=p>,</span>
<a id=__codelineno-43-23 name=__codelineno-43-23 href=#__codelineno-43-23></a>            <span class=s1>&#39;ssl.ca.location&#39;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;PEM_CERT&#39;</span><span class=p>],</span>
<a id=__codelineno-43-24 name=__codelineno-43-24 href=#__codelineno-43-24></a>            <span class=s1>&#39;schema.registry.ssl.ca.location&#39;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;PEM_CERT&#39;</span><span class=p>]</span>
<a id=__codelineno-43-25 name=__codelineno-43-25 href=#__codelineno-43-25></a>        <span class=p>}</span>
<a id=__codelineno-43-26 name=__codelineno-43-26 href=#__codelineno-43-26></a>        <span class=c1># Print the configuration</span>
<a id=__codelineno-43-27 name=__codelineno-43-27 href=#__codelineno-43-27></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;--- This is the configuration for the Avro consumer: ---&quot;</span><span class=p>)</span>
<a id=__codelineno-43-28 name=__codelineno-43-28 href=#__codelineno-43-28></a>        <span class=nb>print</span><span class=p>(</span><span class=n>options</span><span class=p>)</span>
<a id=__codelineno-43-29 name=__codelineno-43-29 href=#__codelineno-43-29></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;---------------------------------------------------&quot;</span><span class=p>)</span>
<a id=__codelineno-43-30 name=__codelineno-43-30 href=#__codelineno-43-30></a>        <span class=c1># Create the Avro consumer</span>
<a id=__codelineno-43-31 name=__codelineno-43-31 href=#__codelineno-43-31></a>        <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span> <span class=o>=</span> <span class=n>AvroConsumer</span><span class=p>(</span><span class=n>options</span><span class=p>)</span>
<a id=__codelineno-43-32 name=__codelineno-43-32 href=#__codelineno-43-32></a>        <span class=c1># Subscribe to the topic</span>
<a id=__codelineno-43-33 name=__codelineno-43-33 href=#__codelineno-43-33></a>        <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=o>.</span><span class=n>subscribe</span><span class=p>([</span><span class=bp>self</span><span class=o>.</span><span class=n>topic_name</span><span class=p>])</span>
</code></pre></div> </li> <li> <p>Poll next event method:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=c1># Prints out the message</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=k>def</span> <span class=nf>traceResponse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>msg</span><span class=p>):</span>
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;[Message] - Next message consumed from </span><span class=si>{}</span><span class=s1> partition: [</span><span class=si>{}</span><span class=s1>] at offset </span><span class=si>{}</span><span class=s1> with key </span><span class=si>{}</span><span class=s1> and value </span><span class=si>{}</span><span class=s1>&#39;</span>
<a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a>                <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>topic</span><span class=p>(),</span> <span class=n>msg</span><span class=o>.</span><span class=n>partition</span><span class=p>(),</span> <span class=n>msg</span><span class=o>.</span><span class=n>offset</span><span class=p>(),</span> <span class=n>msg</span><span class=o>.</span><span class=n>key</span><span class=p>(),</span> <span class=n>msg</span><span class=o>.</span><span class=n>value</span><span class=p>()</span> <span class=p>))</span>
<a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a>
<a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=c1># Polls for next event</span>
<a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=k>def</span> <span class=nf>pollNextEvent</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a>    <span class=c1># Poll for messages</span>
<a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a>    <span class=n>msg</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=o>.</span><span class=n>poll</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mf>10.0</span><span class=p>)</span>
<a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a>    <span class=c1># Validate the returned message</span>
<a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a>    <span class=k>if</span> <span class=n>msg</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;[INFO] - No new messages on the topic&quot;</span><span class=p>)</span>
<a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a>    <span class=k>elif</span> <span class=n>msg</span><span class=o>.</span><span class=n>error</span><span class=p>():</span>
<a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a>        <span class=k>if</span> <span class=p>(</span><span class=s2>&quot;PARTITION_EOF&quot;</span> <span class=ow>in</span> <span class=n>msg</span><span class=o>.</span><span class=n>error</span><span class=p>()):</span>
<a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;[INFO] - End of partition&quot;</span><span class=p>)</span>
<a id=__codelineno-44-16 name=__codelineno-44-16 href=#__codelineno-44-16></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-44-17 name=__codelineno-44-17 href=#__codelineno-44-17></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;[ERROR] - Consumer error: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>error</span><span class=p>()))</span>
<a id=__codelineno-44-18 name=__codelineno-44-18 href=#__codelineno-44-18></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-44-19 name=__codelineno-44-19 href=#__codelineno-44-19></a>        <span class=c1># Print the message</span>
<a id=__codelineno-44-20 name=__codelineno-44-20 href=#__codelineno-44-20></a>        <span class=n>msgStr</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>traceResponse</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</code></pre></div> </li> </ol> <h2 id=schemas-and-messages>Schemas and Messages<a class=headerlink href=#schemas-and-messages title="Permanent link">&para;</a></h2> <p>In this section we are going to see how Schema Registry works when you have an application that produces and consumes messages based on Avro data schemas. The application we are going to use for this is the python application presented above in the <a href=#python-avro-producer>Python Avro Producer</a> and <a href=#python-avro-consumer>Python Avro Consumer</a> sections.</p> <p><strong>IMPORTANT:</strong> Before start using our Python application we must set the <strong>PYTHONPATH</strong> environment variable to point to where we have all the Python scripts that make up our application in order for Python to find these at execution time.</p> <ol> <li>Set the PYTHONPATH variable to the location where you cloned the GitHub repository containing the Python application we are going to be working with</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=nb>export</span> <span class=nv>PYTHONPATH</span><span class=o>=</span>~/refarch-eda-tools/labs/es-cp4i-schema-lab-v10
</code></pre></div> <h3 id=produce-a-message>Produce a message<a class=headerlink href=#produce-a-message title="Permanent link">&para;</a></h3> <p>In order to produce a message, we execute the <code>ProduceAvroMessage.py</code>. This script, as you could see in the <a href=#python-avro-producer>Python Avro Producer</a> section, is sending the event with key <code>{'key': '1'}</code> and value <code>{'message': 'This is a test message'}</code> according to the schemas defined in <a href=https://github.com/ibm-cloud-architecture/refarch-eda-tools/blob/master/labs/es-cp4i-schema-lab-v10/avro_files/default_key.avsc>default_key.avsc</a> and <a href=https://github.com/ibm-cloud-architecture/refarch-eda-tools/blob/master/labs/es-cp4i-schema-lab-v10/avro_files/default_value.avsc>default_value.avsc</a> for the key and value of the event respectively.</p> <p><inlinenotification kind=warning></p> <p>Make sure you are on the right path where the python scripts live: <strong>~/refarch-eda-tools/labs/es-cp4i-schema-lab-v10/src</strong></p> <p></inlinenotification></p> <p><inlinenotification kind=warning></p> <p>Change user1</p> <p></inlinenotification></p> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a>python3 ProduceAvroMessage.py test-schema-user1
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>
<a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a> @@@ Executing script: ProduceAvroMessage.py
<a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a>The arguments <span class=k>for</span> the script are:  <span class=o>[</span><span class=s1>&#39;ProduceAvroMessage.py&#39;</span>, <span class=s1>&#39;test-schema-user1&#39;</span><span class=o>]</span>
<a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a>Creating event...
<a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a>DONE
<a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a>--- Event to be published: ---
<a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=o>{</span><span class=s2>&quot;key&quot;</span>: <span class=m>1</span><span class=o>}</span>
<a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=o>{</span><span class=s2>&quot;message&quot;</span>: <span class=s2>&quot;This is a test message&quot;</span><span class=o>}</span>
<a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a>----------------------------------------
<a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a>--- This is the configuration <span class=k>for</span> the avro producer: ---
<a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=o>{</span><span class=s1>&#39;bootstrap.servers&#39;</span>: <span class=s1>&#39;es-1-kafka-bootstrap-integration.apps.eda-solutions.gse-ocp.net:443&#39;</span>, <span class=s1>&#39;schema.registry.url&#39;</span>: <span class=s1>&#39;https://my-user1:*****@es-1-ibm-es-schema-external-integration.apps.eda-solutions.gse-ocp.net&#39;</span>, <span class=s1>&#39;group.id&#39;</span>: <span class=s1>&#39;ProduceAvroMessagePython&#39;</span>, <span class=s1>&#39;security.protocol&#39;</span>: <span class=s1>&#39;SASL_SSL&#39;</span>, <span class=s1>&#39;sasl.mechanisms&#39;</span>: <span class=s1>&#39;SCRAM-SHA-512&#39;</span>, <span class=s1>&#39;sasl.username&#39;</span>: <span class=s1>&#39;my-user1&#39;</span>, <span class=s1>&#39;sasl.password&#39;</span>: <span class=s1>&#39;*****&#39;</span>, <span class=s1>&#39;ssl.ca.location&#39;</span>: <span class=s1>&#39;/home/ALMARAZJ/es-cert.pem&#39;</span>, <span class=s1>&#39;schema.registry.ssl.ca.location&#39;</span>: <span class=s1>&#39;/home/ALMARAZJ/es-cert.pem&#39;</span><span class=o>}</span>
<a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a>---------------------------------------------------
<a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a>Message delivered to test-schema-user1 <span class=o>[</span><span class=m>0</span><span class=o>]</span>
</code></pre></div> <p>We can see our new message delivered in the <code>test-schema-user1</code> topic by</p> <ol> <li> <p>Go into the topics page in the IBM Event Streams UI</p> <p><img alt=14 src=images/14-v10.png></p> </li> <li> <p>Click on the topic and then on the <em>Messages</em> tab at the top. Finally, click on a message to see it displayed on the right hand side of the screen</p> <p><img alt=15 src=images/15-v10.png></p> </li> </ol> <p><inlinenotification kind=info></p> <p><strong>INFO:</strong> Mind the message now is not in JSON format as Avro does not repeat every field name with every single record which makes Avro more efficient than JSON for high-volume usage. This is thanks to having Avro schemas.</p> <p></inlinenotification></p> <p><strong>IMPORTANT:</strong> As you can see, we got the <code>test-schema-user1</code> topic auto-created when we produced the message. The reason for this is that</p> <ol> <li>Kafka is set out of the box to let applications to auto-create topics.</li> <li>We created the SCRAM credentials for our application to allow the application to create topics.</li> </ol> <p>On a production-like environment, you don't want developers creating applications that auto-create topics in your IBM Event Streams instance without any control. For that, we would configure Kafka to forbid topic auto-creation (<a href=https://kafka.apache.org/documentation/#auto.create.topics.enable>https://kafka.apache.org/documentation/#auto.create.topics.enable</a>) as well as thoroughly created the SCRAM credentials with the most strict but appropriate permissions that our application needs.</p> <p><strong>IMPORTANT:</strong> Similar to the auto-creation of topics, we can see below that our application got the Avro data schemas for both the key and value of the message produced auto-registered. This is because many client libraries come with a SerDes property to allow them to auto-register the Avro data schemas (<a href=https://docs.confluent.io/current/clients/confluent-kafka-python/#avroserializer>https://docs.confluent.io/current/clients/confluent-kafka-python/#avroserializer</a>). However, on a production-like environment we don't want applications to auto-register schemas without any control but yet we can not leave it to the developers to set the auto-registration property off on their libraries. Instead, we would create the SCRAM credentials with the most strict but appropriate permissions that our application needs.</p> <p>If we look now at the schemas our schema registry has:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a>cloudctl es schemas
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a>
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a>Schema                           State    Latest version   Latest version ID   Updated
<a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a>demoSchema_CLI_USER1             active   <span class=m>2</span>.0.0            <span class=m>2</span>                   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>14</span>:09:37 UTC
<a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a>demoSchema_UI_USER1              active   <span class=m>2</span>.0.0            <span class=m>2</span>                   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>14</span>:06:27 UTC
<a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a>test-schema-user1-key-d89uk      active   <span class=m>1</span>                <span class=m>1</span>                   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>15</span>:41:46 UTC
<a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a>test-schema-user1-value-tv5efr   active   <span class=m>1</span>                <span class=m>1</span>                   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>15</span>:41:45 UTC
<a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a>OK
</code></pre></div> <p>we see two schemas, <code>test-schema-user1-key-d89uk</code> and <code>test-schema-user1-value-tv5efr</code>, which in fact correspond to the Avro data schema used for the <code>key</code> (<a href=https://github.com/ibm-cloud-architecture/refarch-eda-tools/blob/master/labs/es-cloud-schema-lab/avro_files/default_key.avsc>default_key.avsc</a>) and the <code>value</code> (<a href=https://github.com/ibm-cloud-architecture/refarch-eda-tools/blob/master/labs/es-cloud-schema-lab/avro_files/default_value.avsc>default_value.avsc</a>) of events sent to the <code>test-schema-user1</code> topic in the <a href=https://github.com/ibm-cloud-architecture/refarch-eda-tools/tree/master/labs/es-cloud-schema-lab-v10/src/ProduceAvroMessage.py>ProduceAvroMessage.py</a> as explained before sending the message.</p> <p>To make sure of what we are saying, we can inspect those schemas:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a>cloudctl es schema test-schema-user1-key-d89uk --version <span class=m>1</span>
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a>
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=o>{</span>
<a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a>  <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;record&quot;</span>,
<a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a>  <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;defaultKey&quot;</span>,
<a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a>  <span class=s2>&quot;namespace&quot;</span>: <span class=s2>&quot;ibm.eda.default&quot;</span>,
<a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a>  <span class=s2>&quot;fields&quot;</span>: <span class=o>[</span>
<a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a>    <span class=o>{</span>
<a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a>      <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;int&quot;</span>,
<a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a>      <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;key&quot;</span>,
<a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a>      <span class=s2>&quot;doc&quot;</span>: <span class=s2>&quot;We expect any int as the event key&quot;</span>
<a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a>    <span class=o>}</span>
<a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a>  <span class=o>]</span>,
<a id=__codelineno-48-14 name=__codelineno-48-14 href=#__codelineno-48-14></a>  <span class=s2>&quot;doc&quot;</span>: <span class=s2>&quot;Default Message&#39;s key Avro data schema&quot;</span>
<a id=__codelineno-48-15 name=__codelineno-48-15 href=#__codelineno-48-15></a><span class=o>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a>cloudctl es schema test-schema-user1-value-tv5efr --version <span class=m>1</span>
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a>
<a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=o>{</span>
<a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a>  <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;record&quot;</span>,
<a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a>  <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;defaultValue&quot;</span>,
<a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a>  <span class=s2>&quot;namespace&quot;</span>: <span class=s2>&quot;ibm.eda.default&quot;</span>,
<a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a>  <span class=s2>&quot;fields&quot;</span>: <span class=o>[</span>
<a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a>    <span class=o>{</span>
<a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a>      <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;string&quot;</span>,
<a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a>      <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;message&quot;</span>,
<a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a>      <span class=s2>&quot;doc&quot;</span>: <span class=s2>&quot;Any string&quot;</span>
<a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a>    <span class=o>}</span>
<a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a>  <span class=o>]</span>,
<a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a>  <span class=s2>&quot;doc&quot;</span>: <span class=s2>&quot;Default Message&#39;s value Avro data schema&quot;</span>
<a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a><span class=o>}</span>
</code></pre></div> <p>If I now decided that my events should contain another attribute, I would modify the event value schema (<a href=https://github.com/ibm-cloud-architecture/refarch-eda-tools/blob/master/labs/es-cloud-schema-lab/avro_files/default_value.avsc>default_value.avsc</a>) to reflect that as well as <code>ProduceAvroMessage.py</code> to send that new attribute in the event it sends:</p> <p><inlinenotification kind=warning></p> <p>Change user1</p> <p></inlinenotification></p> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a>python3 ProduceAvroMessage.py test-schema-user1
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a>
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a> @@@ Executing script: ProduceAvroMessage.py
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a>The arguments <span class=k>for</span> the script are:  <span class=o>[</span><span class=s1>&#39;ProduceAvroMessage.py&#39;</span>, <span class=s1>&#39;test-schema-user1&#39;</span><span class=o>]</span>
<a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a>Creating event...
<a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a>DONE
<a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a>--- Event to be published: ---
<a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=o>{</span><span class=s2>&quot;key&quot;</span>: <span class=m>1</span><span class=o>}</span>
<a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a><span class=o>{</span><span class=s2>&quot;message&quot;</span>: <span class=s2>&quot;This is a test message&quot;</span>, <span class=s2>&quot;anotherAttribute&quot;</span>: <span class=s2>&quot;Just another test string&quot;</span><span class=o>}</span>
<a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a>----------------------------------------
<a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a>--- This is the configuration <span class=k>for</span> the avro producer: ---
<a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a><span class=o>{</span><span class=s1>&#39;bootstrap.servers&#39;</span>: <span class=s1>&#39;es-1-kafka-bootstrap-integration.apps.eda-solutions.gse-ocp.net:443&#39;</span>, <span class=s1>&#39;schema.registry.url&#39;</span>: <span class=s1>&#39;https://my-user1:*****@es-1-ibm-es-schema-external-integration.apps.eda-solutions.gse-ocp.net&#39;</span>, <span class=s1>&#39;group.id&#39;</span>: <span class=s1>&#39;ProduceAvroMessagePython&#39;</span>, <span class=s1>&#39;security.protocol&#39;</span>: <span class=s1>&#39;SASL_SSL&#39;</span>, <span class=s1>&#39;sasl.mechanisms&#39;</span>: <span class=s1>&#39;SCRAM-SHA-512&#39;</span>, <span class=s1>&#39;sasl.username&#39;</span>: <span class=s1>&#39;my-user1&#39;</span>, <span class=s1>&#39;sasl.password&#39;</span>: <span class=s1>&#39;*****&#39;</span>, <span class=s1>&#39;ssl.ca.location&#39;</span>: <span class=s1>&#39;/home/ALMARAZJ/es-cert.pem&#39;</span>, <span class=s1>&#39;schema.registry.ssl.ca.location&#39;</span>: <span class=s1>&#39;/home/ALMARAZJ/es-cert.pem&#39;</span><span class=o>}</span>
<a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a>---------------------------------------------------
<a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a>Message delivered to test-schema-user1 <span class=o>[</span><span class=m>0</span><span class=o>]</span>
</code></pre></div> <p>I can see that an event with a new attribute has been sent:</p> <p><img alt=16 src=images/16-v10.png></p> <p>And I can also see that the new shcema has got registered as well:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a>cloudctl es schemas
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a>
<a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a>Schema                           State    Latest version   Latest version ID   Updated
<a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a>demoSchema_CLI_USER1             active   <span class=m>2</span>.0.0            <span class=m>2</span>                   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>14</span>:09:37 UTC
<a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a>demoSchema_UI_USER1              active   <span class=m>2</span>.0.0            <span class=m>2</span>                   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>14</span>:06:27 UTC
<a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a>test-schema-user1-key-d89uk      active   <span class=m>1</span>                <span class=m>1</span>                   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>15</span>:41:46 UTC
<a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a>test-schema-user1-value-a5bbaa   active   <span class=m>1</span>                <span class=m>1</span>                   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>15</span>:54:37 UTC
<a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a>test-schema-user1-value-tv5efr   active   <span class=m>1</span>                <span class=m>1</span>                   Fri, <span class=m>24</span> Jul <span class=m>2020</span> <span class=m>15</span>:41:45 UTC
<a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a>OK
</code></pre></div> <p>If I inspect that new schema, I see my new attribute in it:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a>cloudctl es schema test-schema-user1-value-a5bbaa --version <span class=m>1</span>
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a>
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=o>{</span>
<a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a>  <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;record&quot;</span>,
<a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a>  <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;defaultValue&quot;</span>,
<a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a>  <span class=s2>&quot;namespace&quot;</span>: <span class=s2>&quot;ibm.eda.default&quot;</span>,
<a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a>  <span class=s2>&quot;fields&quot;</span>: <span class=o>[</span>
<a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a>    <span class=o>{</span>
<a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a>      <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;string&quot;</span>,
<a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a>      <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;message&quot;</span>,
<a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a>      <span class=s2>&quot;doc&quot;</span>: <span class=s2>&quot;Any string&quot;</span>
<a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a>    <span class=o>}</span>,
<a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a>    <span class=o>{</span>
<a id=__codelineno-52-14 name=__codelineno-52-14 href=#__codelineno-52-14></a>      <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;string&quot;</span>,
<a id=__codelineno-52-15 name=__codelineno-52-15 href=#__codelineno-52-15></a>      <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;anotherAttribute&quot;</span>,
<a id=__codelineno-52-16 name=__codelineno-52-16 href=#__codelineno-52-16></a>      <span class=s2>&quot;doc&quot;</span>: <span class=s2>&quot;Any other string&quot;</span>
<a id=__codelineno-52-17 name=__codelineno-52-17 href=#__codelineno-52-17></a>    <span class=o>}</span>
<a id=__codelineno-52-18 name=__codelineno-52-18 href=#__codelineno-52-18></a>  <span class=o>]</span>,
<a id=__codelineno-52-19 name=__codelineno-52-19 href=#__codelineno-52-19></a>  <span class=s2>&quot;doc&quot;</span>: <span class=s2>&quot;Default Message&#39;s value Avro data schema&quot;</span>
<a id=__codelineno-52-20 name=__codelineno-52-20 href=#__codelineno-52-20></a><span class=o>}</span>
</code></pre></div> <p><inlinenotification kind=info></p> <p>The schema evolution above (test-schema-user1-value-a5bbaa) should have got registered as a new version of the already existing schema (test-schema-user1-value-tv5efr). IBM Event Streams allows schemas to auto-register themselves when these are sent along with a message from a producer application. However, the Schema Registry does not pick "new" schemas up as a new version of a previous schema and simply creates a new schema. Anyway, when reading messages off the topic, Schema Registry handles well what schema to return back to the receiver application so messages can get properly deserialized. Will see that in the next section.</p> <p></inlinenotification></p> <p><inlinenotification kind=error></p> <p><strong>SECURITY:</strong> As some of you may have already thought, having your clients (that is your applications), auto-register the Avro data schemas that are in the end kind of the contracts that your components of your overal solution agree on in order to understand each other and collaborate between them is <strong>NOT</strong> a good idea. Specially in microservices architectures where you might have hundreds of microservices talking and collaborating among themselsves. We will see in the <a href=#security>Security</a> section how we can control schema registration and evolution based on roles at the schema level also.</p> <p></inlinenotification></p> <h3 id=create-a-non-compliant-message>Create a non-compliant message<a class=headerlink href=#create-a-non-compliant-message title="Permanent link">&para;</a></h3> <p>Let's see what happens if we send a message that does not comply with its Avro data schema. Let's say that I send the following message:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=nv>key</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;key&quot;</span>: <span class=m>1</span><span class=o>}</span>
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=nv>value</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;message&quot;</span> : <span class=m>12345</span><span class=o>}</span>
</code></pre></div> <p>and this is the output of that attempt:</p> <p><inlinenotification kind=warning></p> <p>Change user1</p> <p></inlinenotification></p> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a>python3 ProduceAvroMessage.py test-schema-user1
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a>
<a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a> @@@ Executing script: ProduceAvroMessage.py
<a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a>The arguments <span class=k>for</span> the script are:  <span class=o>[</span><span class=s1>&#39;ProduceAvroMessage.py&#39;</span>, <span class=s1>&#39;test-schema-user1&#39;</span><span class=o>]</span>
<a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a>Creating event...
<a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a>DONE
<a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a>--- Event to be published: ---
<a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a><span class=o>{</span><span class=s2>&quot;key&quot;</span>: <span class=m>1</span><span class=o>}</span>
<a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a><span class=o>{</span><span class=s2>&quot;message&quot;</span>: <span class=m>12345</span><span class=o>}</span>
<a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a>----------------------------------------
<a id=__codelineno-54-11 name=__codelineno-54-11 href=#__codelineno-54-11></a>--- This is the configuration <span class=k>for</span> the avro producer: ---
<a id=__codelineno-54-12 name=__codelineno-54-12 href=#__codelineno-54-12></a><span class=o>{</span><span class=s1>&#39;bootstrap.servers&#39;</span>: <span class=s1>&#39;es-1-kafka-bootstrap-integration.apps.eda-solutions.gse-ocp.net:443&#39;</span>, <span class=s1>&#39;schema.registry.url&#39;</span>: <span class=s1>&#39;https://my-user1:*****@es-1-ibm-es-schema-external-integration.apps.eda-solutions.gse-ocp.net&#39;</span>, <span class=s1>&#39;group.id&#39;</span>: <span class=s1>&#39;ProduceAvroMessagePython&#39;</span>, <span class=s1>&#39;security.protocol&#39;</span>: <span class=s1>&#39;SASL_SSL&#39;</span>, <span class=s1>&#39;sasl.mechanisms&#39;</span>: <span class=s1>&#39;SCRAM-SHA-512&#39;</span>, <span class=s1>&#39;sasl.username&#39;</span>: <span class=s1>&#39;my-user1&#39;</span>, <span class=s1>&#39;sasl.password&#39;</span>: <span class=s1>&#39;*****&#39;</span>, <span class=s1>&#39;ssl.ca.location&#39;</span>: <span class=s1>&#39;/home/ALMARAZJ/es-cert.pem&#39;</span>, <span class=s1>&#39;schema.registry.ssl.ca.location&#39;</span>: <span class=s1>&#39;/home/ALMARAZJ/es-cert.pem&#39;</span><span class=o>}</span>
<a id=__codelineno-54-13 name=__codelineno-54-13 href=#__codelineno-54-13></a>---------------------------------------------------
<a id=__codelineno-54-14 name=__codelineno-54-14 href=#__codelineno-54-14></a>Traceback <span class=o>(</span>most recent call last<span class=o>)</span>:
<a id=__codelineno-54-15 name=__codelineno-54-15 href=#__codelineno-54-15></a>  File <span class=s2>&quot;ProduceAvroMessage.py&quot;</span>, line <span class=m>81</span>, <span class=k>in</span> &lt;module&gt;
<a id=__codelineno-54-16 name=__codelineno-54-16 href=#__codelineno-54-16></a>    kafka_producer.publishEvent<span class=o>(</span>TOPIC_NAME,event_value,event_key<span class=o>)</span>
<a id=__codelineno-54-17 name=__codelineno-54-17 href=#__codelineno-54-17></a>  File <span class=s2>&quot;/tmp/lab/kafka/KcAvroProducer.py&quot;</span>, line <span class=m>43</span>, <span class=k>in</span> publishEvent
<a id=__codelineno-54-18 name=__codelineno-54-18 href=#__codelineno-54-18></a>    self.producer.produce<span class=o>(</span><span class=nv>topic</span><span class=o>=</span>topicName,value<span class=o>=</span>json.loads<span class=o>(</span>value<span class=o>)</span>,key<span class=o>=</span>json.loads<span class=o>(</span>key<span class=o>)</span>, <span class=nv>callback</span><span class=o>=</span>self.delivery_report<span class=o>)</span>
<a id=__codelineno-54-19 name=__codelineno-54-19 href=#__codelineno-54-19></a>  File <span class=s2>&quot;/root/.local/lib/python3.7/site-packages/confluent_kafka/avro/__init__.py&quot;</span>, line <span class=m>99</span>, <span class=k>in</span> produce
<a id=__codelineno-54-20 name=__codelineno-54-20 href=#__codelineno-54-20></a>    <span class=nv>value</span> <span class=o>=</span> self._serializer.encode_record_with_schema<span class=o>(</span>topic, value_schema, value<span class=o>)</span>
<a id=__codelineno-54-21 name=__codelineno-54-21 href=#__codelineno-54-21></a>  File <span class=s2>&quot;/root/.local/lib/python3.7/site-packages/confluent_kafka/avro/serializer/message_serializer.py&quot;</span>, line <span class=m>118</span>, <span class=k>in</span> encode_record_with_schema
<a id=__codelineno-54-22 name=__codelineno-54-22 href=#__codelineno-54-22></a>    <span class=k>return</span> self.encode_record_with_schema_id<span class=o>(</span>schema_id, record, <span class=nv>is_key</span><span class=o>=</span>is_key<span class=o>)</span>
<a id=__codelineno-54-23 name=__codelineno-54-23 href=#__codelineno-54-23></a>  File <span class=s2>&quot;/root/.local/lib/python3.7/site-packages/confluent_kafka/avro/serializer/message_serializer.py&quot;</span>, line <span class=m>152</span>, <span class=k>in</span> encode_record_with_schema_id
<a id=__codelineno-54-24 name=__codelineno-54-24 href=#__codelineno-54-24></a>    writer<span class=o>(</span>record, outf<span class=o>)</span>
<a id=__codelineno-54-25 name=__codelineno-54-25 href=#__codelineno-54-25></a>  File <span class=s2>&quot;/root/.local/lib/python3.7/site-packages/confluent_kafka/avro/serializer/message_serializer.py&quot;</span>, line <span class=m>86</span>, <span class=k>in</span> &lt;lambda&gt;
<a id=__codelineno-54-26 name=__codelineno-54-26 href=#__codelineno-54-26></a>    <span class=k>return</span> lambda record, fp: writer.write<span class=o>(</span>record, avro.io.BinaryEncoder<span class=o>(</span>fp<span class=o>))</span>
<a id=__codelineno-54-27 name=__codelineno-54-27 href=#__codelineno-54-27></a>  File <span class=s2>&quot;/root/.local/lib/python3.7/site-packages/avro/io.py&quot;</span>, line <span class=m>771</span>, <span class=k>in</span> write
<a id=__codelineno-54-28 name=__codelineno-54-28 href=#__codelineno-54-28></a>    raise AvroTypeException<span class=o>(</span>self.writer_schema, datum<span class=o>)</span>
<a id=__codelineno-54-29 name=__codelineno-54-29 href=#__codelineno-54-29></a>avro.io.AvroTypeException: The datum <span class=o>{</span><span class=s1>&#39;message&#39;</span>: <span class=m>12345</span><span class=o>}</span> is not an example of the schema <span class=o>{</span>
<a id=__codelineno-54-30 name=__codelineno-54-30 href=#__codelineno-54-30></a>  <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;record&quot;</span>,
<a id=__codelineno-54-31 name=__codelineno-54-31 href=#__codelineno-54-31></a>  <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;defaultValue&quot;</span>,
<a id=__codelineno-54-32 name=__codelineno-54-32 href=#__codelineno-54-32></a>  <span class=s2>&quot;namespace&quot;</span>: <span class=s2>&quot;ibm.eda.default&quot;</span>,
<a id=__codelineno-54-33 name=__codelineno-54-33 href=#__codelineno-54-33></a>  <span class=s2>&quot;fields&quot;</span>: <span class=o>[</span>
<a id=__codelineno-54-34 name=__codelineno-54-34 href=#__codelineno-54-34></a>    <span class=o>{</span>
<a id=__codelineno-54-35 name=__codelineno-54-35 href=#__codelineno-54-35></a>      <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;string&quot;</span>,
<a id=__codelineno-54-36 name=__codelineno-54-36 href=#__codelineno-54-36></a>      <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;message&quot;</span>,
<a id=__codelineno-54-37 name=__codelineno-54-37 href=#__codelineno-54-37></a>      <span class=s2>&quot;doc&quot;</span>: <span class=s2>&quot;Any string&quot;</span>
<a id=__codelineno-54-38 name=__codelineno-54-38 href=#__codelineno-54-38></a>    <span class=o>}</span>,
<a id=__codelineno-54-39 name=__codelineno-54-39 href=#__codelineno-54-39></a>    <span class=o>{</span>
<a id=__codelineno-54-40 name=__codelineno-54-40 href=#__codelineno-54-40></a>      <span class=s2>&quot;type&quot;</span>: <span class=s2>&quot;string&quot;</span>,
<a id=__codelineno-54-41 name=__codelineno-54-41 href=#__codelineno-54-41></a>      <span class=s2>&quot;name&quot;</span>: <span class=s2>&quot;anotherAttribute&quot;</span>,
<a id=__codelineno-54-42 name=__codelineno-54-42 href=#__codelineno-54-42></a>      <span class=s2>&quot;doc&quot;</span>: <span class=s2>&quot;Any other string&quot;</span>
<a id=__codelineno-54-43 name=__codelineno-54-43 href=#__codelineno-54-43></a>    <span class=o>}</span>
<a id=__codelineno-54-44 name=__codelineno-54-44 href=#__codelineno-54-44></a>  <span class=o>]</span>,
<a id=__codelineno-54-45 name=__codelineno-54-45 href=#__codelineno-54-45></a>  <span class=s2>&quot;doc&quot;</span>: <span class=s2>&quot;Default Message&#39;s value Avro data schema&quot;</span>
<a id=__codelineno-54-46 name=__codelineno-54-46 href=#__codelineno-54-46></a><span class=o>}</span>
</code></pre></div> <p>As we can see, the attempt failed as the Avro producer will check the message against the Avro data schema defined for the topic we want to send the message to and yield that this message does not comply (the message value attribute we are sending is an integer rather than a string and we are missing the second attribute).</p> <p>Therefore, using Avro schemas with IBM Event Streams give us the ability to build our system with <strong>robustness</strong> protecting downstream data consumers from malformed data, as only valid data will be permitted in the topic.</p> <h3 id=consume-a-message>Consume a message<a class=headerlink href=#consume-a-message title="Permanent link">&para;</a></h3> <p>In order to consume a message, we execute the <code>ConsumeAvroMessage.py</code> within the <code>/tmp/lab/src</code> folder in our python demo environment:</p> <p><inlinenotification kind=warning></p> <p>Change user1</p> <p></inlinenotification></p> <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a>python3 ConsumeAvroMessage.py test-schema-user1
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a>
<a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a> @@@ Executing script: ConsumeAvroMessage.py
<a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a>The arguments <span class=k>for</span> this script are:  <span class=o>[</span><span class=s1>&#39;ConsumeAvroMessage.py&#39;</span>, <span class=s1>&#39;test-schema-user1&#39;</span><span class=o>]</span>
<a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a>--- This is the configuration <span class=k>for</span> the Avro consumer: ---
<a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=o>{</span><span class=s1>&#39;bootstrap.servers&#39;</span>: <span class=s1>&#39;es-1-kafka-bootstrap-integration.apps.eda-solutions.gse-ocp.net:443&#39;</span>, <span class=s1>&#39;group.id&#39;</span>: <span class=s1>&#39;pythonconsumers&#39;</span>, <span class=s1>&#39;auto.offset.reset&#39;</span>: <span class=s1>&#39;earliest&#39;</span>, <span class=s1>&#39;schema.registry.url&#39;</span>: <span class=s1>&#39;https://my-user1:*****@es-1-ibm-es-schema-external-integration.apps.eda-solutions.gse-ocp.net&#39;</span>, <span class=s1>&#39;enable.auto.commit&#39;</span>: True, <span class=s1>&#39;security.protocol&#39;</span>: <span class=s1>&#39;SASL_SSL&#39;</span>, <span class=s1>&#39;sasl.mechanisms&#39;</span>: <span class=s1>&#39;SCRAM-SHA-512&#39;</span>, <span class=s1>&#39;sasl.username&#39;</span>: <span class=s1>&#39;my-user1&#39;</span>, <span class=s1>&#39;sasl.password&#39;</span>: <span class=s1>&#39;*****&#39;</span>, <span class=s1>&#39;ssl.ca.location&#39;</span>: <span class=s1>&#39;/home/ALMARAZJ/es-cert.pem&#39;</span>, <span class=s1>&#39;schema.registry.ssl.ca.location&#39;</span>: <span class=s1>&#39;/home/ALMARAZJ/es-cert.pem&#39;</span><span class=o>}</span>
<a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a>---------------------------------------------------
<a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=o>[</span>Message<span class=o>]</span> - Next message consumed from test-schema-user1 partition: <span class=o>[</span><span class=m>0</span><span class=o>]</span> at offset <span class=m>0</span> with key <span class=o>{</span><span class=s1>&#39;key&#39;</span>: <span class=m>1</span><span class=o>}</span> and value <span class=o>{</span><span class=s1>&#39;message&#39;</span>: <span class=s1>&#39;This is a test message&#39;</span><span class=o>}</span>
<a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a>
<a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a>
<a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a>python3 ConsumeAvroMessage.py test-schema-user1
<a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a>
<a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a> @@@ Executing script: ConsumeAvroMessage.py
<a id=__codelineno-55-14 name=__codelineno-55-14 href=#__codelineno-55-14></a>The arguments <span class=k>for</span> this script are:  <span class=o>[</span><span class=s1>&#39;ConsumeAvroMessage.py&#39;</span>, <span class=s1>&#39;test-schema-user1&#39;</span><span class=o>]</span>
<a id=__codelineno-55-15 name=__codelineno-55-15 href=#__codelineno-55-15></a>--- This is the configuration <span class=k>for</span> the Avro consumer: ---
<a id=__codelineno-55-16 name=__codelineno-55-16 href=#__codelineno-55-16></a><span class=o>{</span><span class=s1>&#39;bootstrap.servers&#39;</span>: <span class=s1>&#39;es-1-kafka-bootstrap-integration.apps.eda-solutions.gse-ocp.net:443&#39;</span>, <span class=s1>&#39;group.id&#39;</span>: <span class=s1>&#39;pythonconsumers&#39;</span>, <span class=s1>&#39;auto.offset.reset&#39;</span>: <span class=s1>&#39;earliest&#39;</span>, <span class=s1>&#39;schema.registry.url&#39;</span>: <span class=s1>&#39;https://my-user1:*****@es-1-ibm-es-schema-external-integration.apps.eda-solutions.gse-ocp.net&#39;</span>, <span class=s1>&#39;enable.auto.commit&#39;</span>: True, <span class=s1>&#39;security.protocol&#39;</span>: <span class=s1>&#39;SASL_SSL&#39;</span>, <span class=s1>&#39;sasl.mechanisms&#39;</span>: <span class=s1>&#39;SCRAM-SHA-512&#39;</span>, <span class=s1>&#39;sasl.username&#39;</span>: <span class=s1>&#39;my-user1&#39;</span>, <span class=s1>&#39;sasl.password&#39;</span>: <span class=s1>&#39;*****&#39;</span>, <span class=s1>&#39;ssl.ca.location&#39;</span>: <span class=s1>&#39;/home/ALMARAZJ/es-cert.pem&#39;</span>, <span class=s1>&#39;schema.registry.ssl.ca.location&#39;</span>: <span class=s1>&#39;/home/ALMARAZJ/es-cert.pem&#39;</span><span class=o>}</span>
<a id=__codelineno-55-17 name=__codelineno-55-17 href=#__codelineno-55-17></a>---------------------------------------------------
<a id=__codelineno-55-18 name=__codelineno-55-18 href=#__codelineno-55-18></a><span class=o>[</span>Message<span class=o>]</span> - Next message consumed from test-schema-user1 partition: <span class=o>[</span><span class=m>0</span><span class=o>]</span> at offset <span class=m>1</span> with key <span class=o>{</span><span class=s1>&#39;key&#39;</span>: <span class=m>1</span><span class=o>}</span> and value <span class=o>{</span><span class=s1>&#39;message&#39;</span>: <span class=s1>&#39;This is a test message&#39;</span>, <span class=s1>&#39;anotherAttribute&#39;</span>: <span class=s1>&#39;Just another test string&#39;</span><span class=o>}</span>
</code></pre></div> <p>As you can see, our script was able to read the Avro messages from the <code>test-schema-user1</code> topic and map that back to their original structure thanks to the Avro schemas:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=o>[</span>Message<span class=o>]</span> - Next message consumed from test-schema partition: <span class=o>[</span><span class=m>0</span><span class=o>]</span> at offset <span class=m>0</span> with key <span class=o>{</span><span class=s1>&#39;key&#39;</span>: <span class=m>1</span><span class=o>}</span> and value <span class=o>{</span><span class=s1>&#39;message&#39;</span>: <span class=s1>&#39;This is a test message&#39;</span><span class=o>}</span>
<a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>
<a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=o>[</span>Message<span class=o>]</span> - Next message consumed from test-schema partition: <span class=o>[</span><span class=m>0</span><span class=o>]</span> at offset <span class=m>1</span> with key <span class=o>{</span><span class=s1>&#39;key&#39;</span>: <span class=m>1</span><span class=o>}</span> and value <span class=o>{</span><span class=s1>&#39;message&#39;</span>: <span class=s1>&#39;This is a test message&#39;</span>, <span class=s1>&#39;anotherAttribute&#39;</span>: <span class=s1>&#39;Just another test string&#39;</span><span class=o>}</span>
</code></pre></div> <h2 id=data-evolution>Data Evolution<a class=headerlink href=#data-evolution title="Permanent link">&para;</a></h2> <p>So far we have more or less seen what Avro is, what an Avro data schema is, what a schema registry is and how this all works together. From creating an Avro data schema for your messages/events to comply with to how the schema registry and Avro data schemas work together. And we have also seen the code for doing all this, from the python code to send and receive Avro encoded messages based on their Avro data schemas to the rich CLI IBM Event Streams provides to interact with.</p> <p>However, we have said little about the need for data to evolve. When you design an Event Driven architecture for your application (by applying <a href=/methodology/event-storming/ >Event Storming</a> or <a href=/methodology/domain-driven-design/ >Domain Driven Design</a> for example), it is very hard to come up with data structures/schemas that will not need to evolve/change in time. That is, your data, like your use or business cases, may need to evolve. As a result, Avro data schemas must be somehow flexible to allow your data to evolve along with your application and use cases.</p> <p>But it is not as easy as adding or removing data that travels in your events/messages or modifying the type of such data. And one of the reasons for this is that Kafka (or any other type of event backbone) is many times used as the source of truth. That is, a place that you can trust as to what has happened. Hence, Kafka will serve as the source of truth where all the events (that is, data) that happened (which could be bank transactions, communications, etc) will get stored (sometimes up to <a href=https://www.confluent.io/blog/publishing-apache-kafka-new-york-times/ >hundreds of years</a>) and will be able to be replayed if needed. As a result, there must be a data schema management and data schema evolution put in place that allow the <strong>compatibility</strong> of old and new data schemas and, in fact, old and new data at the end of the day.</p> <p><strong>The IBM Event Streams Schema Registry enforces full compatibility when creating a new version of a schema</strong>. Full compatibility means that <strong>old data can be read with the new data schema, and new data can also be read with the last data schema</strong>.</p> <p>In data formats like Avro, you can define fields with default values. In that case adding or removing a field with a default value is a fully compatible change. Let's see then how this affects when you want your data to evolve in a way that it needs to add a new attribute or delete an existing attribute.</p> <p>But let's see what that means in terms of adding and removing attributes from your data schema.</p> <h3 id=adding-a-new-attribute>Adding a new attribute<a class=headerlink href=#adding-a-new-attribute title="Permanent link">&para;</a></h3> <p>Although we have already seen this in the adding a new version of a schema section, let's try to add a new version of our <code>test-schema-value</code> schema where we have a new attribute. Remember, our <code>default_schema.avsc</code> already contains a new attribute than the original one but that it got registered as a new schema rather than as a new version of the original one. Let's reuse that Avro schema file to register it as a new version (<strong>INFO:</strong> you might need to copy/download that file to your local workstation in order to be able to then upload it to the IBM Event Streams through its UI)</p> <p>When doing so from the UI, we see the following error:</p> <p><img alt=17 src=images/17-v10.png></p> <p>The reason, as alread explained in the add a new version of a schema section, is because full compatibility dictates that you can only add new attributes to a schema if these have a default value. Reason being that a receiver should be able to deserialize messages produced with an older schema using the newer schema. Because old messages were written with an older schema that did not contain our new attribute, those messages won't have that attribute so we need to provide a default value for it in our never version of the schema so that the receiver is able to deserialize those older messages with the newer schema.</p> <p>If we add the default value for the new attribute, we see that our newer version is now compatible:</p> <p><img alt=18 src=images/18-v10.png></p> <p>and that it gets registered fine:</p> <p><img alt=19 src=images/19-v10.png></p> <h3 id=removing-an-existing-attribute>Removing an existing attribute<a class=headerlink href=#removing-an-existing-attribute title="Permanent link">&para;</a></h3> <p>What if we now wanted to remove the original <code>message</code> attribute from our schema. Let's remove it from the <code>default_value.avsc</code> file and try to register that new version:</p> <p><img alt=20 src=images/20-v10.png></p> <p>We, again, get the same error. And the reason is because receivers must be able to read and deserialize messages produced with the newer schema (that is, without the <code>message</code> attribute) but with the older schema (that is, with the schema version that enforces the existence of the <code>message</code> attribute).</p> <p>In order to work this around, what we need to do is to register first an intermediate schema that defines a default value for the <code>message</code> attribute:</p> <p><img alt=21 src=images/21-v10.png></p> <p>Once we have a default value for the <code>message</code> attribute, we can register a new version of the schema that finally removes that attribute:</p> <p><img alt=22 src=images/22-v10.png></p> <h2 id=security>Security<a class=headerlink href=#security title="Permanent link">&para;</a></h2> <p>As we have already mentioned during the this tutorial, we need to pay attention to the permissions we give to users, groups, applications (and thefore the clients they used to interact with IBM Event Streams), etc since we don't want everyone and everything to be, for instance, creating or deleting topics, schemas, etc.</p> <p>You can secure your IBM Event Streams resources in a fine-grained manner by managing the access each user and application has to each resource. Within IBM Event Streams, you can secure access to the following resource types, where the names in parentheses are the resource type names used in Access Control List (ACL) rules:</p> <ul> <li><strong>Topics (topic):</strong> you can control the ability of users and applications to create, delete, read, and write to a topic.</li> <li><strong>Consumer groups (group):</strong> you can control an applications ability to join a consumer group.</li> <li><strong>Transactional IDs (transactionalId):</strong> you can control the ability to use the transaction capability in Kafka.</li> </ul> <p>Note: Schemas in the Event Streams Schema Registry are a special case and are secured using the resource type of topic combined with a prefix of __schema_. You can control the ability of users and applications to create, delete, read, and update schemas.</p> <p>You can find more information about how to secure your IBM Event Streams resources in the official documentation at: <a href=https://ibm.github.io/event-streams/security/managing-access/ >https://ibm.github.io/event-streams/security/managing-access/</a></p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../schema-registry-on-cloud/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Schema registry ES on Cloud" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Schema registry ES on Cloud </div> </div> </a> <a href=../monitoring-on-cloud/ class="md-footer__link md-footer__link--next" aria-label="Next: Monitoring ES on Cloud" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Monitoring ES on Cloud </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright  2022 IBM </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/ibm-cloud-architecture target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/agileitarchitecture target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tabs.sticky", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.9c69f0bc.min.js></script> </body> </html>